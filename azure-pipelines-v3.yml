trigger:
  batch: true
  branches:
    include:
    - v3
    - v3-release
pr:
- v3

variables:
- group: devresourcekeyvault
- name: dotnetVersion
  value: 5.0.100
- name: runCodesignValidationInjection
  value: false
- name: NugetSecurityAnalysisWarningLevel
  value: none

jobs:

# Test and deploy on windows
- job: WindowsBuild
  pool:
    vmImage: 'windows-latest'
  steps:

  # Run CredScan
  - task: CredScan@2
    displayName: Security - CredScan
    condition: and(succeeded(), ne(variables['Build.Reason'], 'PullRequest'))
    inputs:
      toolMajorVersion: 'V2'

  # Install .NET Core sdk
  - task: UseDotNet@2
    displayName: 'Install .NET Core sdk $(dotnetVersion)'
    inputs:
      packageType: sdk
      version: $(dotnetVersion)

  # dotnet test
  - powershell: dotnet run
    workingDirectory: test/docfx.RegressionTest
