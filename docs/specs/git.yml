---
# Show git contribution info when userProfile is set to URL
repos:
  https://github.com/testowner/testrepo#master-url-cache:
    - author: Charlie
      email: charlie@contoso.com
      files:
        docs/index.md: |
          ---
          author: charlie
          ---
          Alice creates this. Bob updates this. Charlie becomes author.
    - author: Bob 
      email: bob@contoso.com
      files:
        docs/index.md: |
          Alice creates this. Bob updates this.
    - author: Alice 
      email: alice@contoso.com
      files:
        docs/index.md: |
          Alice creates this.
inputs:
  docfx.yml: |
    gitHub:
      userCache: https://raw.githubusercontent.com/docascode/docfx-test-dependencies/master/user_profile.json
      resolveUsers: true
outputs:
  docs/index.json: |
    {
      "_op_gitContributorInformation":
      {
        "author":
          { "name": "charlie", "profile_url": "https://github.com/charlie", "display_name": "Charlie", "id": "3" },
        "contributors": [
          { "name": "bob", "profile_url": "https://github.com/bob", "display_name": "Bob", "id": "2" },
          { "name": "alice", "profile_url": "https://github.com/alice", "display_name": "Alice", "id": "1" }
        ],
        "update_at": "10/30/2018",
        "updated_at_date_time": "2018-10-30T00:00:00"
      },
      "updated_at": "2018-10-30 12:00 AM"
    }
---
# Show git contribution info when userProfile is set to relative file path
repos:
  https://github.com/testowner/testrepo#master-file-cache:
    - author: Charlie
      email: charlie@contoso.com
      files:
        docs/index.md: |
          ---
          author: charlie
          ---
          Alice creates this. Bob updates this. Charlie becomes author.
    - author: Bob 
      email: bob@contoso.com
      files:
        docs/index.md: |
          Alice creates this. Bob updates this.
    - author: Alice 
      email: alice@contoso.com
      files:
        docs/index.md: |
          Alice creates this.
inputs:
  docfx.yml: |
    gitHub:
      userCache: user_profile.json
      resolveUsers: true
  user_profile.json: |
      { "users": [
          {"name": "Alice", "login": "alice", "id": 1, "emails": ["alice@contoso.com"]},
          {"name": "Bob", "login": "bob", "id": 2, "emails": ["bob@contoso.com"]},
          {"name": "Charlie", "login": "charlie", "id": 3, "emails": ["charlie@contoso.com"]}
        ]
      }
outputs:
  docs/index.json: |
    {
      "_op_gitContributorInformation":
      {
        "author":
          { "name": "charlie", "profile_url": "https://github.com/charlie", "display_name": "Charlie", "id": "3" },
        "contributors": [
          { "name": "bob", "profile_url": "https://github.com/bob", "display_name": "Bob", "id": "2" },
          { "name": "alice", "profile_url": "https://github.com/alice", "display_name": "Alice", "id": "1" }
        ]
      },
      "updated_at": "2018-10-30 12:00 AM"
    }
---
# Specify invalid author in YAML header should log warning
inputs:
  docs/index.md: |
    ---
    author: invalid_user
    ---
    # git-test
  docfx.yml: |
    gitHub:
      userCache: user_profile.json
      resolveUsers: true
  user_profile.json: |
    {
      "users": [
        {"login": "invalid_user"},
      ]
    }
outputs:
  docs/index.json:
  .errors.log: |
    ["warning","author-not-found","Invalid value for author: 'invalid_user' is not a valid GitHub ID","docs/index.md",2,9]
---
# Author should NOT exist in contributors. Author can have no contribution to the file before.
repos:
  https://github.com/testowner/testrepo#master-author:
    - author: Bob 
      email: bob@contoso.com
      files:
        docs/index.md: |
          ---
          author: charlie
          ---
          Alice creates this. Bob updates this, and thinks Charlie should be the author.
    - author: Alice 
      email: alice@contoso.com
      files:
        docs/index.md: |
          Alice creates this.
inputs:
  docfx.yml: |
    gitHub:
      userCache: user_profile.json
      resolveUsers: true
  user_profile.json: |
      { "users": [
          {"name": "Alice", "login": "alice", "id": 1, "emails": ["alice@contoso.com"]},
          {"name": "Bob", "login": "bob", "id": 2, "emails": ["bob@contoso.com"]},
          {"name": "Charlie", "login": "charlie", "id": 3, "emails": ["charlie@contoso.com"]}
        ]
      }
outputs:
  docs/index.json: |
    {
      "_op_gitContributorInformation":
      {
        "author": 
          { "name": "charlie", "profile_url": "https://github.com/charlie", "display_name": "Charlie", "id": "3" },
        "contributors": [
          { "name": "bob", "profile_url": "https://github.com/bob", "display_name": "Bob", "id": "2" },
          { "name": "alice", "profile_url": "https://github.com/alice", "display_name": "Alice", "id": "1" }
        ]
      }
    }
---
# Author is case-insensitive
# Contributors can be excluded, it's case insensitive
repos:
  https://github.com/testowner/testrepo#master-exclude-contributors:
    - author: Charlie
      email: charlie@contoso.com
      files:
        docs/index.md: |
          ---
          author: ChArLiE
          ---
          Alice creates this. Bob updates this. Charlie becomes author.
    - author: Bob 
      email: bob@contoso.com
      files:
        docs/index.md: |
          Alice creates this. Bob updates this.
    - author: Alice 
      email: alice@contoso.com
      files:
        docs/index.md: |
          Alice creates this.
inputs:
  docfx.yml: |
    gitHub:
      userCache: user_profile.json
      resolveUsers: true
    contribution:
      excludedContributors:
        - AlIcE
        - BoB
  user_profile.json: |
      { "users": [
          {"name": "Alice", "login": "alice", "id": 1, "emails": ["alice@contoso.com"]},
          {"name": "Bob", "login": "bob", "id": 2, "emails": ["bob@contoso.com"]},
          {"name": "Charlie", "login": "charlie", "id": 3, "emails": ["charlie@contoso.com"]}
        ]
      }
outputs:
  docs/index.json: |
    {
      "_op_gitContributorInformation":
      {
        "author": 
          { "name": "charlie", "profile_url": "https://github.com/charlie", "display_name": "Charlie", "id": "3" },
        "!contributors": null
      }
    }
---
# Use the earliest contributor as author if author not specified in YAML header
repos:
  https://github.com/testowner/testrepo#master-author-from-contributors:
    - author: Bob 
      email: bob@contoso.com
      files:
        docs/index.md: |
          Alice creates this. Bob updates this.
    - author: Alice 
      email: alice@contoso.com
      files:
        docs/index.md: |
          Alice creates this.
inputs:
  docfx.yml: |
    gitHub:
      userCache: user_profile.json
      resolveUsers: true
  user_profile.json: |
      { "users": [
          {"name": "Alice", "login": "alice", "id": 1, "emails": ["alice@contoso.com"]},
          {"name": "Bob", "login": "bob", "id": 2, "emails": ["bob@contoso.com"]},
        ]
      }
outputs:
  docs/index.json: |
    {
      "_op_gitContributorInformation":
      {
        "author": 
          { "name": "alice", "profile_url": "https://github.com/alice", "display_name": "Alice", "id": "1" },
      }
    }
---
# Author can NOT be excluded if explicitly specified in YAML header, it's case insensitive
repos:
  https://github.com/testowner/testrepo#master-exclude-author-from-yaml-heaer:
    - author: Charlie
      email: charlie@contoso.com
      files:
        docs/index.md: |
          ---
          author: charlie
          ---
          Alice creates this. Bob updates this. Charlie becomes author (but excluded in config).
    - author: Bob 
      email: bob@contoso.com
      files:
        docs/index.md: |
          Alice creates this. Bob updates this.
    - author: Alice 
      email: alice@contoso.com
      files:
        docs/index.md: |
          Alice creates this.
inputs:
  docfx.yml: |
    gitHub:
      userCache: user_profile.json
      resolveUsers: true
    contribution:
      excludedContributors:
        - ChArLiE
  user_profile.json: |
      { "users": [
          {"name": "Alice", "login": "alice", "id": 1, "emails": ["alice@contoso.com"]},
          {"name": "Bob", "login": "bob", "id": 2, "emails": ["bob@contoso.com"]},
          {"name": "Charlie", "login": "charlie", "id": 3, "emails": ["charlie@contoso.com"]}
        ]
      }
outputs:
  docs/index.json: |
    {
      "_op_gitContributorInformation":
      {
        "author":
          { "name": "charlie", "profile_url": "https://github.com/charlie", "display_name": "Charlie", "id": "3" },
        "contributors": [
          { "name": "bob", "profile_url": "https://github.com/bob", "display_name": "Bob", "id": "2" },
          { "name": "alice", "profile_url": "https://github.com/alice", "display_name": "Alice", "id": "1" }
        ]
      },
    }
---
# Author CAN be excluded if implicitly extracted from commit history
repos:
  https://github.com/testowner/testrepo#master-exclude-author-from-commit-history:
    - author: Alice
      email: alice@contoso.com
      files:
        docs/index.md: |
          Alice creates this.
inputs:
  docfx.yml: |
    gitHub:
      userCache: user_profile.json
      resolveUsers: true
    contribution:
      excludedContributors:
        - alice
  user_profile.json: |
      { "users": [{"name": "Alice", "login": "alice", "id": 1, "emails": ["alice@contoso.com"]}] }
outputs:
  docs/index.json: |
    {
      "!author": null,
      "!contributors": null
    }
---
# Show content_git_url, original_content_git_url and gitcommit
repos:
  https://github.com/testowner/testrepo#master-content-git-url:
    - files:
        docs/index.md: Alice creates this.
inputs:
  docfx.yml:
outputs:
  docs/index.json: |
    {
      "content_git_url": "https://github.com/testowner/testrepo/blob/master-content-git-url/docs/index.md",
      "original_content_git_url": "https://github.com/testowner/testrepo/blob/master-content-git-url/docs/index.md",
      "original_content_git_url_template": "{repo}/blob/{branch}/docs/index.md",
      "gitcommit": "https://github.com/testowner/testrepo/blob/e662dbc7c5e582a14b863d6a6a82e495d6272f91/docs/index.md",
    }
---
# Specify editLink repo and branch in config
repos:
  https://github.com/testowner/testrepo#master-edit-link:
    - files:
        docs/index.md: Alice creates this.
inputs:
  docfx.yml: |
    contribution:
      repository: https://github.com/contrib-owner/contrib-repo#contrib-branch
outputs:
  docs/index.json: |
    {
      "content_git_url": "https://github.com/contrib-owner/contrib-repo/blob/contrib-branch/docs/index.md",
      "original_content_git_url": "https://github.com/testowner/testrepo/blob/master-edit-link/docs/index.md",
      "gitcommit": "https://github.com/testowner/testrepo/blob/e662dbc7c5e582a14b863d6a6a82e495d6272f91/docs/index.md",
    }
---
# Use commit's time as updated_at when `updateTimeAsCommitBuildTime` is false
repos:
  https://github.com/testowner/testrepo#master-time-from-commit:
    - files:
        docfx.yml:
        docs/index.md: Alice creates this.
outputs:
  docs/index.json: |
    {
      "updated_at": "2018-10-30 12:00 AM",
    }
---
# Use commit build time as updated_at when `updateTimeAsCommitBuildTime` is true
repos:
  https://github.com/MicrosoftDocs/edge-developer#master:
    - files:
        docfx.yml: |
          updateTimeAsCommitBuildTime: true
        docs/index.md: Alice creates this.
cache:
  history/build_history_0ad81e11-d18b-a417-bd25-94364d004cae_17190aeb-6297-d34d-a48f-a681d3061212.json: |
    {
      "commits": [{ "sha": "7e6344c7275cccec2334ca04b73017bdeb7ecc2a", "built_at": "2019-04-23T00:00:00Z" }]
    }
outputs:
  docs/index.json: |
    {
      "updated_at": "2019-04-23 12:00 AM",
    }
---
# Support git submodule
repo: https://github.com/docascode/docfx-test-dependencies#c70a63e
outputs:
  readme.json: |
    {
      "gitcommit": "https://github.com/docascode/docfx-test-dependencies/blob/c467c848311ccd2550fdb25a77ef26f9d8a33d00/README.md",
      "updated_at": "2018-04-23 03:23 AM"
    }
  docfx-test-submodule/readme.json: |
    {
      "gitcommit": "https://github.com/docascode/docfx-test-submodule/blob/b6601c200859547c7fcd44a44788f77a08576505/README.md",
      "updated_at": "2018-07-18 05:03 AM"
    }
---
# Throw committish-not-found when try to resolve commit id by none-existing branch name
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos: 
  https://github.com/git/repo#live:
    - files:
        docfx.yml: |
          localization:
            bilingual: true
  https://github.com/git/repo.zh-cn#live-none-existing:
    - files:
        a.md:
  https://github.com/git/repo.zh-cn#live-sxs:
    - files:
        a.md:
outputs:
  .errors.log: |
    ["error","committish-not-found","Can't find branch, tag, or commit 'live' for repo *github.com+git+repo.zh-cn*.","a.md"]
---
# Use current repo's branch when edit branch isn't specified in contribution config,
# and contribution config's repository equals to current repo's
repos:
  https://github.com/testowner/testrepo#building-branch:
    - files:
        docs/index.md: Alice creates this.
inputs:
  docfx.yml: |
    contribution:
      repository: https://github.com/testowner/testrepo
outputs:
  docs/index.json: |
    {
      "content_git_url": "https://github.com/testowner/testrepo/blob/building-branch/docs/index.md",
      "original_content_git_url": "https://github.com/testowner/testrepo/blob/building-branch/docs/index.md",
      "gitcommit": "https://github.com/testowner/testrepo/blob/e662dbc7c5e582a14b863d6a6a82e495d6272f91/docs/index.md",
    }
---
# Use current repo's branch when edit branch isn't specified in contribution config,
# even contribution config's repository doesn't equal to current repo's
repos:
  https://github.com/testowner/testrepo#default-building-branch:
    - files:
        docs/index.md: Alice creates this.
inputs:
  docfx.yml: |
    contribution:
      repository: https://github.com/contrib-owner/contrib-repo
outputs:
  docs/index.json: |
    {
      "content_git_url": "https://github.com/contrib-owner/contrib-repo/blob/default-building-branch/docs/index.md",
      "original_content_git_url": "https://github.com/testowner/testrepo/blob/default-building-branch/docs/index.md",
      "gitcommit": "https://github.com/testowner/testrepo/blob/e662dbc7c5e582a14b863d6a6a82e495d6272f91/docs/index.md",
    }
---
# Show (original) content git (branch/commit) url for azure repos
repos:
  https://dev.azure.com/docascode/project/_git/a:
    - files:
        docs/index.md:
inputs:
  docfx.yml: |
    contribution:
      repository: https://github.com/docascode/a
outputs:
  docs/index.json: |
    {
      "content_git_url":"https://github.com/docascode/a/blob/master/docs/index.md",
      "original_content_git_url":"https://dev.azure.com/docascode/project/_git/a?path=/docs/index.md&version=GBmaster&_a=contents",
      "original_content_git_url_template":"{repo}?path=/docs/index.md&version=GB{branch}&_a=contents",
      "gitcommit":"https://dev.azure.com/docascode/project/_git/a/commit/73d1bc95f9df03e553c39cf8c685df09af8d5297?path=/docs/index.md&_a=contents"
    }
---
# Show git contribution info for azure repo
repos:
  https://docascode.visualstudio.com/contribution/_git/a:
    - author: Charlie
      email: charlie@contoso.com
      files:
        docs/index.md: |
          ---
          author: charlie
          ---
          Osmond creates this. Bob updates this. Charlie becomes author.
    - author: Bob 
      email: bob@contoso.com
      files:
        docs/index.md: |
          Osmond creates this. Bob updates this.
    - author: osmondjiang 
      email: xinjiang@microsoft.com
      files:
        docs/index.md: |
          Osmond creates this, without email
inputs:
  docfx.yml: |
    gitHub:
      userCache: user_profile.json
      resolveUsers: true
      authToken: {GITHUB_ACCESS_TOKEN}
    contribution:
      repository: https://github.com/docascode/contribution-test
  user_profile.json: |
      { "users": [
          {"name": "Alice", "login": "alice", "id": 1, "emails": ["alice@contoso.com"]},
          {"name": "Bob", "login": "bob", "id": 2, "emails": ["bob@contoso.com"]},
          {"name": "Charlie", "login": "charlie", "id": 3, "emails": ["charlie@contoso.com"]}
        ]
      }
environments:
  - GITHUB_ACCESS_TOKEN
outputs:
  docs/index.json: |
    {
      "_op_gitContributorInformation":
      {
        "author": 
          { "name": "charlie", "profile_url": "https://github.com/charlie", "display_name": "Charlie", "id": "3" },
        "contributors": [
          { "name": "bob", "profile_url": "https://github.com/bob", "display_name": "Bob", "id": "2" },
          { "name": "OsmondJiang", "profile_url": "https://github.com/OsmondJiang", "display_name": "osmondjiang", "id": "19990166" }
        ]
      },
      "updated_at": "2018-10-30 12:00 AM"
    }
---
# Author and contributors will not be resolved when `github.resolveUsers` == false
repos:
  https://github.com/testowner/testrepo#not-resolve:
    - author: Charlie
      email: charlie@contoso.com
      files:
        docs/index.md: |
          ---
          author: charlie
          ---
          Alice creates this. Bob updates this. Charlie becomes author.
    - author: Bob 
      email: bob@contoso.com
      files:
        docs/index.md: |
          Alice creates this. Bob updates this.
    - author: Alice 
      email: alice@contoso.com
      files:
        docs/index.md: |
          Alice creates this.
inputs:
  docfx.yml: |
    gitHub:
      userCache: user_profile.json
      resolveUsers: false
  user_profile.json: |
      { "users": [
          {"name": "Alice", "login": "alice", "id": 1, "emails": ["alice@contoso.com"]},
          {"name": "Bob", "login": "bob", "id": 2, "emails": ["bob@contoso.com"]},
          {"name": "Charlie", "login": "charlie", "id": 3, "emails": ["charlie@contoso.com"]}
        ]
      }
outputs:
  docs/index.json: |
    {
      "_op_gitContributorInformation": 
      {
        "!author_info": null,
        "!contributors": null,
      },
      "updated_at": "2018-10-30 12:00 AM"
    }
