---
# Show git contribution info when userProfile & commitsTime is set to URL
repos:
  https://github.com/testowner/testrepo#master-url-cache:
    - author: Charlie
      email: charlie@contoso.com
      files:
        docs/index.md: |
          ---
          author: charlie
          ---
          Alice creates this. Bob updates this. Charlie becomes author.
    - author: Bob 
      email: bob@contoso.com
      files:
        docs/index.md: |
          Alice creates this. Bob updates this.
    - author: Alice 
      email: alice@contoso.com
      files:
        docs/index.md: |
          Alice creates this.
inputs:
  docfx.yml: |
    gitHub:
      userCache: https://raw.githubusercontent.com/docascode/docfx-test-dependencies/master/user_profile.json
      resolveUsers: true
    contribution:
      gitCommitsTime: https://raw.githubusercontent.com/docascode/docfx-test-dependencies/master/build_history.json
outputs:
  docs/index.json: |
    {
      "author": 
        { "name": "charlie", "profile_url": "https://github.com/charlie", "display_name": "Charlie", "id": "3" },
      "contributors": [
        { "name": "bob", "profile_url": "https://github.com/bob", "display_name": "Bob", "id": "2" },
        { "name": "alice", "profile_url": "https://github.com/alice", "display_name": "Alice", "id": "1" }
      ],
      "updated_at": "2018-01-01T00:00:00.0000000"
    }
---
# Show git contribution info when userProfile & commitsTime is set to relative file path
repos:
  https://github.com/testowner/testrepo#master-file-cache:
    - author: Charlie
      email: charlie@contoso.com
      files:
        docs/index.md: |
          ---
          author: charlie
          ---
          Alice creates this. Bob updates this. Charlie becomes author.
    - author: Bob 
      email: bob@contoso.com
      files:
        docs/index.md: |
          Alice creates this. Bob updates this.
    - author: Alice 
      email: alice@contoso.com
      files:
        docs/index.md: |
          Alice creates this.
inputs:
  docfx.yml: |
    gitHub:
      userCache: user_profile.json
      resolveUsers: true
    contribution:
      gitCommitsTime: build_history.json
  user_profile.json: |
      { "users": [
          {"name": "Alice", "login": "alice", "id": 1, "emails": ["alice@contoso.com"]},
          {"name": "Bob", "login": "bob", "id": 2, "emails": ["bob@contoso.com"]},
          {"name": "Charlie", "login": "charlie", "id": 3, "emails": ["charlie@contoso.com"]}
        ]
      }
  build_history.json: |
    { "commits": [
        { "sha": "6547e91b51bb7cd49d8fbf71f7c61d14f6a49937", "built_at": "2018-01-01" }
      ]
    }
outputs:
  docs/index.json: |
    {
      "author": 
        { "name": "charlie", "profile_url": "https://github.com/charlie", "display_name": "Charlie", "id": "3" },
      "contributors": [
        { "name": "bob", "profile_url": "https://github.com/bob", "display_name": "Bob", "id": "2" },
        { "name": "alice", "profile_url": "https://github.com/alice", "display_name": "Alice", "id": "1" }
      ],
      "updated_at": "2018-01-01T00:00:00.0000000"
    }
---
# Specify invalid author in YAML header should log warning
inputs:
  docs/index.md: |
    ---
    author: invalid_user
    ---
    # git-test
  docfx.yml: |
    gitHub:
      userCache: user_profile.json
      resolveUsers: true
  user_profile.json: |
    {
      "users": [
        {"login": "invalid_user"},
      ]
    }
outputs:
  docs/index.json:
  build.log: |
    ["warning","github-user-not-found","Cannot find user 'invalid_user' on GitHub","docs/index.md"]
---
# Author should NOT exist in contributors. Author can have no contribution to the file before.
repos:
  https://github.com/testowner/testrepo#master-author:
    - author: Bob 
      email: bob@contoso.com
      files:
        docs/index.md: |
          ---
          author: charlie
          ---
          Alice creates this. Bob updates this, and thinks Charlie should be the author.
    - author: Alice 
      email: alice@contoso.com
      files:
        docs/index.md: |
          Alice creates this.
inputs:
  docfx.yml: |
    gitHub:
      userCache: user_profile.json
      resolveUsers: true
  user_profile.json: |
      { "users": [
          {"name": "Alice", "login": "alice", "id": 1, "emails": ["alice@contoso.com"]},
          {"name": "Bob", "login": "bob", "id": 2, "emails": ["bob@contoso.com"]},
          {"name": "Charlie", "login": "charlie", "id": 3, "emails": ["charlie@contoso.com"]}
        ]
      }
outputs:
  docs/index.json: |
    {
      "author": 
        { "name": "charlie", "profile_url": "https://github.com/charlie", "display_name": "Charlie", "id": "3" },
      "contributors": [
        { "name": "bob", "profile_url": "https://github.com/bob", "display_name": "Bob", "id": "2" },
        { "name": "alice", "profile_url": "https://github.com/alice", "display_name": "Alice", "id": "1" }
      ]
    }
---
# Author is case-insensitive
# Contributors can be excluded, it's case insensitive
repos:
  https://github.com/testowner/testrepo#master-exclude-contributors:
    - author: Charlie
      email: charlie@contoso.com
      files:
        docs/index.md: |
          ---
          author: ChArLiE
          ---
          Alice creates this. Bob updates this. Charlie becomes author.
    - author: Bob 
      email: bob@contoso.com
      files:
        docs/index.md: |
          Alice creates this. Bob updates this.
    - author: Alice 
      email: alice@contoso.com
      files:
        docs/index.md: |
          Alice creates this.
inputs:
  docfx.yml: |
    gitHub:
      userCache: user_profile.json
      resolveUsers: true
    contribution:
      excludedContributors:
        - AlIcE
        - BoB
  user_profile.json: |
      { "users": [
          {"name": "Alice", "login": "alice", "id": 1, "emails": ["alice@contoso.com"]},
          {"name": "Bob", "login": "bob", "id": 2, "emails": ["bob@contoso.com"]},
          {"name": "Charlie", "login": "charlie", "id": 3, "emails": ["charlie@contoso.com"]}
        ]
      }
outputs:
  docs/index.json: |
    {
      "author": 
        { "name": "charlie", "profile_url": "https://github.com/charlie", "display_name": "Charlie", "id": "3" },
      "contributors": []
    }
---
# Use the earliest contributor as author if author not specified in YAML header
repos:
  https://github.com/testowner/testrepo#master-author-from-contributors:
    - author: Bob 
      email: bob@contoso.com
      files:
        docs/index.md: |
          Alice creates this. Bob updates this.
    - author: Alice 
      email: alice@contoso.com
      files:
        docs/index.md: |
          Alice creates this.
inputs:
  docfx.yml: |
    gitHub:
      userCache: user_profile.json
      resolveUsers: true
  user_profile.json: |
      { "users": [
          {"name": "Alice", "login": "alice", "id": 1, "emails": ["alice@contoso.com"]},
          {"name": "Bob", "login": "bob", "id": 2, "emails": ["bob@contoso.com"]},
        ]
      }
outputs:
  docs/index.json: |
    {
      "author": 
        { "name": "alice", "profile_url": "https://github.com/alice", "display_name": "Alice", "id": "1" },
    }
---
# Author can be excluded, it's case insensitive
repos:
  https://github.com/testowner/testrepo#master-autho-case-insensitive:
    - author: Charlie
      email: charlie@contoso.com
      files:
        docs/index.md: |
          ---
          author: charlie
          ---
          Alice creates this. Bob updates this. Charlie becomes author (but excluded in config).
    - author: Bob 
      email: bob@contoso.com
      files:
        docs/index.md: |
          Alice creates this. Bob updates this.
    - author: Alice 
      email: alice@contoso.com
      files:
        docs/index.md: |
          Alice creates this.
inputs:
  docfx.yml: |
    gitHub:
      userCache: user_profile.json
      resolveUsers: true
    contribution:
      excludedContributors:
        - ChArLiE
  user_profile.json: |
      { "users": [
          {"name": "Alice", "login": "alice", "id": 1, "emails": ["alice@contoso.com"]},
          {"name": "Bob", "login": "bob", "id": 2, "emails": ["bob@contoso.com"]},
          {"name": "Charlie", "login": "charlie", "id": 3, "emails": ["charlie@contoso.com"]}
        ]
      }
outputs:
  docs/index.json: |
    {
      "!author": null,
      "contributors": [
        { "name": "bob", "profile_url": "https://github.com/bob", "display_name": "Bob", "id": "2" },
        { "name": "alice", "profile_url": "https://github.com/alice", "display_name": "Alice", "id": "1" }
      ],
    }
---
# Show content_git_url, original_content_git_url and gitcommit
repos:
  https://github.com/testowner/testrepo#master-content-git-url:
    - files:
        docs/index.md: Alice creates this.
inputs:
  docfx.yml:
outputs:
  docs/index.json: |
    {
      "open_to_public_contributors": true,
      "content_git_url": "https://github.com/testowner/testrepo/blob/master-content-git-url/docs/index.md",
      "original_content_git_url": "https://github.com/testowner/testrepo/blob/master-content-git-url/docs/index.md",
      "gitcommit": "https://github.com/testowner/testrepo/blob/e662dbc7c5e582a14b863d6a6a82e495d6272f91/docs/index.md",
    }
---
# Specify editLink repo and branch in config
repos:
  https://github.com/testowner/testrepo#master-edit-link:
    - files:
        docs/index.md: Alice creates this.
inputs:
  docfx.yml: |
    contribution:
      repository: https://github.com/contrib-owner/contrib-repo#contrib-branch
outputs:
  docs/index.json: |
    {
      "content_git_url": "https://github.com/contrib-owner/contrib-repo/blob/contrib-branch/docs/index.md",
      "original_content_git_url": "https://github.com/testowner/testrepo/blob/master-edit-link/docs/index.md",
      "gitcommit": "https://github.com/testowner/testrepo/blob/e662dbc7c5e582a14b863d6a6a82e495d6272f91/docs/index.md",
    }
---
# Don't load git commits when showContributors is set to false
repos:
  https://github.com/testowner/testrepo#master-no-load-commits:
    - files:
        docs/index.md: Alice creates this.
inputs:
  docfx.yml: |
    contribution:
      showContributors: false
outputs:
  docs/index.json: |
    {
      "contributors": [],
      "gitcommit": "https://github.com/testowner/testrepo/blob/e662dbc7c5e582a14b863d6a6a82e495d6272f91/docs/index.md",
    }
---
# Use commit's time when gitCommitsTime file not given
repos:
  https://github.com/testowner/testrepo#master-time-from-commit:
    - time: 2018-01-01T00:00:00Z
      files:
        docs/index.md: Alice creates this.
inputs:
  docfx.yml:
outputs:
  docs/index.json: |
    {
      "updated_at": "2018-01-01T00:00:00Z",
    }
---
# Support git submodule
repo: https://github.com/docascode/docfx-test-dependencies#c70a63e
outputs:
  readme.json: |
    {
      "gitcommit": "https://github.com/docascode/docfx-test-dependencies/blob/c467c848311ccd2550fdb25a77ef26f9d8a33d00/README.md",
      "updated_at": "2018-04-23T03:23:37Z"
    }
  docfx-test-submodule/readme.json: |
    {
      "gitcommit": "https://github.com/docascode/docfx-test-submodule/blob/b6601c200859547c7fcd44a44788f77a08576505/README.md",
      "updated_at": "2018-07-18T05:03:26Z"
    }
---
