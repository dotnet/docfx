---
# Apply moniker range setting in the config to markdown file's output path and output content
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '< netcore-2.0'
      'docs/v2/**': '>= netcore-2.0'
    hostName: docs.com
    basePath: /docs
    routes:
      docs/: .
      docs/v1/: .
      docs/v2/: .
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    Moniker: netcore-1.0, netcore-1.1
  docs/v2/a.md: |
    Moniker: netcore-2.0, netcore-2.1
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  docs/9d4e15fd/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-1.0, netcore-1.1</p>",
      "monikers": ["netcore-1.0", "netcore-1.1"]
    }
  docs/23d205a5/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-2.0, netcore-2.1</p>",
      "monikers": ["netcore-2.0", "netcore-2.1"]
    }
  .publish.json: |
    {
      "files":[
        {"url":"/docs/a","moniker_group":"23d205a5", "config_moniker_range": ">= netcore-2.0" },
        {"url":"/docs/a","moniker_group":"9d4e15fd", "config_moniker_range": "< netcore-2.0" }
      ],
      "moniker_groups": {
        "23d205a5": ["netcore-2.0","netcore-2.1"],
        "9d4e15fd": ["netcore-1.0","netcore-1.1"]
      }
    }
---
# Multiple matched moniker range setting in the config, should use the last one
inputs:
  docfx.yml: |
    monikerRange:
      'docs/**': 'netcore-1.0'
      'docs/v1/**': 'netcore-1.1'
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    Moniker: netcore-1.1
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
      ]
    }
outputs:
  218c13d0/docs/v1/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-1.1</p>",
      "monikers": ["netcore-1.1"]
    }
---
# Apply moniker range setting in the config and yaml header to markdown file's output path and output content
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '< netcore-2.0'
      'docs/v2/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    ---
    monikerRange: '> netcore-1.0'
    ---
    Moniker: netcore-1.1
  docs/v2/a.md: |
    ---
    monikerRange: '<= netcore-2.0'
    ---
    Moniker: netcore-2.0
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  218c13d0/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-1.1</p>",
      "monikers": ["netcore-1.1"],
    }
  4667fedf/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-2.0</p>",
      "monikers": ["netcore-2.0"],
    }
  .publish.json: |
    {
      "files": [
          { "url": "/docs/a", "path": "218c13d0/docs/a.json", "moniker_group": "218c13d0" },
          { "url": "/docs/a", "path": "4667fedf/docs/a.json", "moniker_group": "4667fedf" }
      ],
      "moniker_groups":{
        "218c13d0":["netcore-1.1"],
        "4667fedf":["netcore-2.0"]
      }
    }
---
# Moniker Zone syntax
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '>= netcore-1.0 <= netcore-1.2'
    routes:
      docs/v1/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    Moniker: netcore-1.0, netcore-1.1, netcore-1.2
    ::: moniker range="<= netcore-1.1"
    Moniker: netcore-1.0, netcore-1.1
    ::: moniker-end
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.2", "product_name": ".NET Core" },
      ]
    }
outputs:
  2420f88b/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-1.0, netcore-1.1, netcore-1.2</p><div data-moniker=\"netcore-1.0 netcore-1.1\"><p>Moniker: netcore-1.0, netcore-1.1</p></div>",
      "monikers": ["netcore-1.0", "netcore-1.1", "netcore-1.2"]
    }
---
# Build redirection with moniker info
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '< netcore-2.0'
      'docs/v2/**': '>= netcore-2.0'
    hostName: docs.com
    basePath: /docs
    routes:
      docs/: .
      docs/v1/: .
      docs/v2/: .
    monikerDefinition: monikerDefinition.json
    fileMetadata:
      monikerRange:
        docs/v2/**/*.md: netcore-2.0
  redirections.yml: |
    redirections:
      docs/v1/c.md: /docs/a
      docs/v2/c.md: /docs/b
  docs/v1/a.md: |
  docs/v2/b.md: |
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  docs/9d4e15fd/a.json:
  docs/4667fedf/b.json:
  .publish.json: |
    {
      "files":[
        {"url":"/docs/c","moniker_group":"4667fedf"},
        {"url":"/docs/c","moniker_group":"9d4e15fd"},
        {"url":"/docs/b","moniker_group":"4667fedf"},
        {"url":"/docs/a","moniker_group":"9d4e15fd"}
      ],
      "moniker_groups":{
        "4667fedf":["netcore-2.0"],
        "9d4e15fd":["netcore-1.0","netcore-1.1"]
      }
    }
---
# Redirection file with monikers - document id should be taken to the target file with corresponding version
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': 'netcore-1.0'
      'docs/v2/**': 'netcore-1.1'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
  redirections.yml: |
    renames:
      docs/v1/a-old.md: /docs/a
      docs/v2/a-old.md: /docs/a
      docs/b-old.md: /docs/b
  docs/v1/a.md: |
    Moniker: netcore-1.0
  docs/v2/a.md: |
    Moniker: netcore-1.1
  docs/b.md:
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  136a42ac/docs/a.json: |
    {
      "document_id": "2f5db941-5d87-5c7e-668b-00a1e364cc0e"
    }
  218c13d0/docs/a.json: |
    {
      "document_id": "08d48c30-3997-5171-bec6-5f6650078a1f"
    }
  docs/b.json: |
    {
      "document_id": "f5f11a54-50e3-b65a-bdfd-1cf00b682420"
    }
  .publish.json: |
    {
      "files": [
        { "url": "/docs/a-old", "redirect_url": "/docs/a", "moniker_group": "136a42ac" },
        { "url": "/docs/a-old", "redirect_url": "/docs/a", "moniker_group": "218c13d0" },
        { "url": "/docs/b-old", "redirect_url": "/docs/b" },
        { "url": "/docs/a", "moniker_group": "136a42ac" },
        { "url": "/docs/a", "moniker_group": "218c13d0" },
        { "url": "/docs/b" }
      ],
      "moniker_groups": {
        "218c13d0": ["netcore-1.1"],
        "136a42ac": ["netcore-1.0"]
      }
    }
---
# Redirection file with monikers - document id should be taken to all the target files with corresponding version
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': 'netcore-1.0'
      'docs/v2/**': 'netcore-2.0'
      'docs/v12/**': 'netcore-1.0 || netcore-2.0'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
      docs/v12/: docs/
    monikerDefinition: monikerDefinition.json
  redirections.yml: |
    renames:
      docs/v12/a-old.md: /docs/a
  docs/v1/a.md: |
    Moniker: netcore-1.0
  docs/v2/a.md: |
    Moniker: netcore-2.0
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" }
      ]
    }
outputs:
  136a42ac/docs/a.json: |
    {
      "document_id": "9aad8db9-886c-62db-ad91-a80eb80f89d8"
    }
  4667fedf/docs/a.json: |
    {
      "document_id": "9aad8db9-886c-62db-ad91-a80eb80f89d8"
    }
  .publish.json: |
    {
      "files": [
        { "url": "/docs/a-old", "redirect_url": "/docs/a", "moniker_group": "e2dfe8fd" },
        { "url": "/docs/a", "moniker_group": "136a42ac" },
        { "url": "/docs/a", "moniker_group": "4667fedf" }
      ],
      "moniker_groups": {
        "4667fedf": ["netcore-2.0"],
        "136a42ac": ["netcore-1.0"],
        "e2dfe8fd": [
            "netcore-1.0",
            "netcore-2.0"
        ]
      }
    }
---
# Redirection file with monikers - Redirection url conflict
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': 'netcore-1.0'
      'docs/v2/**': 'netcore-1.1'
      'docs/v12/**': 'netcore-1.0 || netcore-1.1'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
      docs/v12/: docs/
    monikerDefinition: monikerDefinition.json
  redirections.yml: |
    renames:
      docs/v1/a-old.md: /docs/a
      docs/v2/a-old.md: /docs/a
  docs/v12/a.md: |
    Moniker: netcore-1.0, netcore-1.1
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  9d4e15fd/docs/a.json: |
    {
      "document_id": "2f5db941-5d87-5c7e-668b-00a1e364cc0e"
    }
  .publish.json: |
    {
      "files": [
        { "url": "/docs/a-old", "redirect_url": "/docs/a", "moniker_group": "136a42ac" },
        { "url": "/docs/a-old", "redirect_url": "/docs/a", "moniker_group": "218c13d0" },
        { "url": "/docs/a", "moniker_group": "9d4e15fd" },
      ],
      "moniker_groups": {
        "136a42ac": [ "netcore-1.0" ],
        "218c13d0": [ "netcore-1.1" ],
        "9d4e15fd": ["netcore-1.0","netcore-1.1"]
      }
    }
  .errors.log: |
    {"message_severity":"warning","code":"redirection-url-conflict","message":"The '/docs/a' appears twice or more in the redirection mappings.","file":"redirections.yml","line":3,"column":21}
---
# Redirection file with monikers - moniker overlap
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '>= netcore-1.0 <= netcore-1.1'
      'docs/v2/**': '>= netcore-1.1 <= netcore-1.2'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
  redirections.yml: |
    renames:
      docs/v1/a-old.md: /docs/a
    redirections:
      docs/v2/a-old.md: /docs/a
  docs/v1/a.md: |
    Moniker: netcore-1.0, netcore-1.1
  docs/v2/a.md: |
    ---
    monikerRange: netcore-1.2
    ---
    Moniker: netcore-1.2
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.2", "product_name": ".NET Core" },
      ]
    }
outputs:
  9d4e15fd/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-1.0, netcore-1.1</p>"
    }
  b201e604/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-1.2</p>"
    }
  .publish.json: |
    {
      "files": 
      [
        {"url": "/docs/a-old", "moniker_group": "e300a7df", "config_moniker_range": ">= netcore-1.1 <= netcore-1.2", "redirect_url": "/docs/a"},
        {"url": "/docs/a", "path": "9d4e15fd/docs/a.json"},
        {"url": "/docs/a", "path": "b201e604/docs/a.json"},
      ]
    }
  .errors.log: |
    {"message_severity":"warning","code":"publish-url-conflict","message":"Two or more files of the same version('netcore-1.1') publish to the same url '/docs/a-old': 'docs/v1/a-old.md [redirection]<'netcore-1.0', 'netcore-1.1'>', 'docs/v2/a-old.md [redirection]<'netcore-1.1', 'netcore-1.2'>'."}
---
# Two or more documents which don't have moniker or the moniker range is not mutually exclusive from others, publish to the same url
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '<= netcore-2.0'
      'docs/v2/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    Moniker: netcore-1.0, netcore-1.1, netcore-2.0
  docs/v2/a.md: |
    Moniker: netcore-2.0, netcore-2.1
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  f7525be1/docs/a.json:
  .publish.json: |
    {
      "files":
      [
        {"url": "/docs/a", "path": "f7525be1/docs/a.json"}
      ]
    }
  .errors.log: |
    {"message_severity":"warning","code":"publish-url-conflict","message":"Two or more files of the same version('netcore-2.0') publish to the same url '/docs/a': 'docs/v1/a.md<'netcore-1.0', 'netcore-1.1', 'netcore-2.0'>', 'docs/v2/a.md<'netcore-2.0', 'netcore-2.1'>'."}
---
# With moniker range not defined in config, user should not define it in file metadata
inputs:
  docfx.yml: |
    monikerDefinition: monikerDefinition.json
    fileMetadata:
      monikerRange:
        docs/b.md: '> netcore-1.0'
  docs/a.md: |
    ---
    monikerRange: '> netcore-1.0'
    ---
    Moniker: netcore-1.1
  docs/b.md:
  docs/TOC.yml: |
    - name: A
      href: a.md
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  docs/a.json: |
    { "monikers": undefined }
  docs/b.json: |
    { "monikers": undefined }
  docs/toc.json:
  .errors.log: |
    {"message_severity":"suggestion","code":"moniker-range-undefined","message":"Moniker range missing in docfx.yml/docfx.json, user should not define it in file metadata or moniker zone. NOTE: This Suggestion will become a Error on 06/30/2020.","file":"docs/a.md","line":2,"column":15}
    {"message_severity":"suggestion","code":"moniker-range-undefined","message":"Moniker range missing in docfx.yml/docfx.json, user should not define it in file metadata or moniker zone. NOTE: This Suggestion will become a Error on 06/30/2020.","file":"docfx.yml","line":4,"column":16}
---
# With moniker range not defined in config, user should not define it in moniker zone
inputs:
  docfx.yml: |
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    # Title
    ::: moniker range="netcore-1.0"
    Moniker: netcore-1.0
    ::: moniker-end
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" }
      ]
    }
outputs:
  docs/v1/a.json: |
    {
      "monikers": undefined
    }
  .errors.log: |
    {"message_severity":"suggestion","code":"moniker-range-undefined","message":"Moniker range missing in docfx.yml/docfx.json, user should not define it in file metadata or moniker zone. NOTE: This Suggestion will become a Error on 06/30/2020.","file":"docs/v1/a.md","line":2,"column":1}
---
# No intersection of config monikers and file monikers
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '< netcore-2.0'
    routes:
      docs/v1/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    ---
    monikerRange: '> netcore-2.0'
    ---
    Moniker: no intersection
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  .errors.log: |
    {"message_severity":"error","code":"moniker-range-out-of-scope","message":"No moniker intersection between docfx.yml/docfx.json and file metadata. Config moniker range '< netcore-2.0' is 'netcore-1.0', 'netcore-1.1', while file moniker range '> netcore-2.0' is 'netcore-2.1'.","file":"docs/v1/a.md","line":2,"column":15}
---
# No intersection of file level monikers and zone monikers produces empty HTML output
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '<= netcore-1.1'
    routes:
      docs/v1/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    Moniker: netcore-1.0, netcore-1.1
    ::: moniker range="netcore-1.2"
    Moniker: netcore-1.2
    ::: moniker-end
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.2", "product_name": ".NET Core" },
      ]
    }
outputs:
  9d4e15fd/docs/a.json: |
    { "conceptual": "<p>Moniker: netcore-1.0, netcore-1.1</p>" }
  .errors.log: |
    {"message_severity":"warning","code":"moniker-zone-empty","message":"No intersection between zone and file level monikers. The result of zone level range string 'netcore-1.2' is 'netcore-1.2', while file level monikers is 'netcore-1.0', 'netcore-1.1'.","file":"docs/v1/a.md","line":2,"column":1}
---
# Define uid with moniker range, refer to it with valid moniker in the same docset
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '< netcore-2.0'
      'docs/v2/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    ---
    uid: a
    title: netcore
    monikerRange: '> netcore-1.0'
    ---
    Moniker: netcore-1.1
  docs/v2/a.md: |
    ---
    uid: a
    title: netcore
    monikerRange: '<= netcore-2.0'
    ---
    Moniker: netcore-2.0
  docs/b.md: |
    Link to @a?view=netcore-1.1
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  docs/b.json: |
    {
      "conceptual": "<p>Link to <a href=\"a?view=netcore-1.1\">netcore</a></p>",
      "monikers": undefined
    }
  218c13d0/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-1.1</p>",
      "monikers": ["netcore-1.1"]
    }
  4667fedf/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-2.0</p>",
      "monikers": ["netcore-2.0"]
    }
---
# Define same uid with multiple moniker ranges in .md,
# title should be the same
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '< netcore-2.0'
      'docs/v2/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    ---
    uid: a
    title: netcore-1.1
    monikerRange: '> netcore-1.0'
    ---
    Moniker: netcore-1.1
  docs/v2/a.md: |
    ---
    uid: a
    title: netcore-2.0
    monikerRange: '<= netcore-2.0'
    ---
    Moniker: netcore-2.0
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  218c13d0/docs/a.json:
  4667fedf/docs/a.json:
  .errors.log: |
    {"message_severity":"warning","code":"xref-property-conflict","message":"UID 'a' is defined with different names: 'netcore-1.1', 'netcore-2.0'."}
---
# Define same uid with multiple moniker ranges with same name, 
# reference to it without moniker in the same docset, anyone can be taken
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '< netcore-2.0'
      'docs/v2/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    ---
    uid: a
    title: netcore
    monikerRange: '> netcore-1.0'
    ---
    Moniker: netcore-1.1
  docs/v2/a.md: |
    ---
    uid: a
    title: netcore
    monikerRange: '<= netcore-2.0'
    ---
    Moniker: netcore-2.0
  docs/b.md: |
    Link to @a
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  docs/b.json: |
    {
      "conceptual": "<p>Link to <a href=\"a\">netcore</a></p>",
      "monikers": undefined
    }
  218c13d0/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-1.1</p>",
      "monikers": ["netcore-1.1"]
    }
  4667fedf/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-2.0</p>",
      "monikers": ["netcore-2.0"]
    }
---
# Define same uid with overlapping moniker range
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '<= netcore-2.0'
      'docs/v2/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    ---
    uid: a
    title: netcore-1.1, netcore-2.0
    monikerRange: '> netcore-1.0'
    ---
    Moniker: netcore-1.1, netcore-2.0
  docs/v2/a.md: |
    ---
    uid: a
    title: netcore-2.0, netcore-2.1
    ---
    Moniker: netcore-2.0, netcore-2.1
  docs/c.md: Link to @a
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  afb33dd2/docs/a.json:
  docs/c.json: |
    {"conceptual":"<p>Link to <a href=\"a\" data-linktype=\"relative-path\">netcore-1.1, netcore-2.0</a></p>"}
  .errors.log: |
    {"message_severity":"error","code":"moniker-overlapping","message":"Two or more documents with the same uid `a`('docs/v1/a.md', 'docs/v2/a.md') have defined overlapping moniker: 'netcore-2.0'."}
    {"message_severity":"warning","code":"xref-property-conflict","message":"UID 'a' is defined with different names: 'netcore-1.1, netcore-2.0', 'netcore-2.0, netcore-2.1'."}
    {"message_severity":"warning","code":"publish-url-conflict","message":"Two or more files of the same version('netcore-2.0') publish to the same url '/docs/a': 'docs/v1/a.md<'netcore-1.1', 'netcore-2.0'>', 'docs/v2/a.md<'netcore-2.0', 'netcore-2.1'>'."}
  .xrefmap.json: | 
    {"references":[{"uid":"a","name":"netcore-1.1, netcore-2.0"}]}
  .publish.json: |
    {
      "files": 
      [
        {"url": "/docs/a", "path": "afb33dd2/docs/a.json"},
        {"url": "/docs/c"}
      ]
    }
---
# Define uid with moniker range, refer to it with invalid moniker, could fall back to anyone
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '< netcore-2.0'
      'docs/v2/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    ---
    uid: a
    title: netcore
    monikerRange: '> netcore-1.0'
    ---
    Moniker: netcore-1.1
  docs/v2/a.md: |
    ---
    uid: a
    title: netcore
    monikerRange: '<= netcore-2.0'
    ---
    Moniker: netcore-2.0
  docs/b.md: |
    Link @a?view=netcore-1.0
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  docs/b.json: |
    {
      "conceptual": "<p>Link <a href=\"a?view=netcore-1.0\">netcore</a></p>",
      "monikers": undefined
    }
  218c13d0/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-1.1</p>",
      "monikers": ["netcore-1.1"]
    }
  4667fedf/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-2.0</p>",
      "monikers": ["netcore-2.0"]
    }
---
# [skip] Define same uid with and without moniker range
# while refer to it without moniker range, should pick the one without moniker range
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '< netcore-2.0'
      'docs/v2/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    ---
    uid: a
    title: netcore-1.1
    monikerRange: '> netcore-1.0'
    ---
    Moniker: netcore-1.1
  docs/v2/a.md: |
    ---
    uid: a
    title: netcore-2.0
    monikerRange: '<= netcore-2.0'
    ---
    Moniker: netcore-2.0
  docs/b.md: |
    Link to @a
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  docs/b.json: |
    {
      "conceptual": "<p>Link to <a href=\"a\">no version</a></p>",
      "monikers": undefined
    }
  218c13d0/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-1.1</p>",
      "monikers": ["netcore-1.1"]
    }
  4667fedf/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-2.0</p>",
      "monikers": ["netcore-2.0"]
    }
  xrefmap.json: | 
    {"references":[{"uid":"a","href":"https://docs.com/docs/a","name":"netcore-2.0"}]}
---
# Define multiple uid without moniker range, and also uid with moniker range
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '< netcore-2.0'
      'docs/v2/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    ---
    uid: a
    title: netcore-1.1
    monikerRange: '> netcore-1.0'
    ---
    Moniker: netcore-1.1
  docs/v2/a.md: |
    ---
    uid: a
    title: netcore-2.0
    monikerRange: '<= netcore-2.0'
    ---
    Moniker: netcore-2.0
  docs/b.md: |
    ---
    uid: a
    title: b with no version
    ---
    No version
  docs/c.md: |
    Link to @a
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  docs/b.json:
  docs/c.json: |
    {
      "conceptual": "<p>Link to <a href=\"b\" data-linktype=\"relative-path\">b with no version</a></p>",
      "monikers": undefined
    }
  218c13d0/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-1.1</p>",
      "monikers": ["netcore-1.1"]
    }
  4667fedf/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-2.0</p>",
      "monikers": ["netcore-2.0"]
    }
  .xrefmap.json: | 
    {"references":[{"uid":"a","name":"b with no version"}]}
  .errors.log: |
    {"message_severity":"warning","code":"xref-property-conflict","message":"UID 'a' is defined with different names: 'b with no version', 'netcore-1.1', 'netcore-2.0'."}
---
# Build toc with monikers info
inputs:
  docfx.yml: |
    exclude: 'docs/v1/folder/TOC.yml'
    monikerRange:
      'docs/v1/**': '>= netcore-1.0'
    routes:
      docs/v1/: docs/
    monikerDefinition: monikerDefinition.json
    outputPdf: true
  docs/v1/a.md: |
    ---
    monikerRange: netcore-1.1 || netcore-1.0
    uid: a
    ---
    Moniker: netcore-1.0, netcore-1.1
  docs/v1/b.md: |
    ---
    monikerRange: netcore-1.2 || netcore-1.1
    ---
    Moniker: netcore-1.1, netcore-1.2
  docs/v1/TOC.md: |
    ---
    monikerRange: '>= netcore-1.1'
    ---
    # [A](a.md)
    ## [B](b.md)
    ## [Absolute](/c)
    ## [External](http://test.com/test)
    ### [A](xref:a)
    ## Text
    ### [A](a.md)
    ## [Non-versioning](../x.md)
    ### [A](a.md)
  docs/x.md:
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.2", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.3", "product_name": ".NET Core" }
      ]
    }
outputs:
  docs/x.json:
  9d4e15fd/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-1.0, netcore-1.1</p>",
      "monikers": ["netcore-1.0", "netcore-1.1"]
    }
  e300a7df/docs/b.json: |
    {
      "conceptual": "<p>Moniker: netcore-1.1, netcore-1.2</p>",
      "monikers": ["netcore-1.1", "netcore-1.2"]
    }
  8169d1ea/docs/toc.json: |
    {
      "items": [
        {
          "name": "A",
          "href": "a",
          "monikers": undefined,
          "items": [
            { "name": "B", "href": "b", "monikers": ["netcore-1.1", "netcore-1.2"] },
            { "name": "Absolute", "href": "/c", "monikers": undefined },
            {
              "name": "External",
              "href": "http://test.com/test",
              "monikers": undefined,
              "items": [
                { "name": "A", "href": "a", "monikers": ["netcore-1.0", "netcore-1.1"] }
              ]
            },
            {
              "name": "Text",
              "monikers": [ "netcore-1.0", "netcore-1.1" ],
              "items": [
                { "name": "A", "href": "a", "monikers": undefined}
              ]
            },
            { 
              "name": "Non-versioning",
              "href": "x",
              "monikers": undefined,
              "items": [
                { "name": "A", "href": "a", "monikers": ["netcore-1.0", "netcore-1.1"] }
              ]
            },
          ]
        }
      ],
      "metadata": {
        "pdf_absolute_path": "/opbuildpdf/8169d1ea/docs/toc.pdf"
      }
    }
---
# Build toc with monikers info - multiple node with same url
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': 'netcore-1.0'
      'docs/v2/**': 'netcore-2.0'
      'docs/v1-v2/**': 'netcore-1.0 || netcore-2.0'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
      docs/v1-v2/: docs/
    monikerDefinition: '{APP_BASE_PATH}/data/monikers.json'
  docs/v1/a.md: |
    Moniker: netcore-1.0
  docs/v2/a.md: |
    Moniker: netcore-2.0
  docs/v1-v2/TOC.md: |
    # [A-1](../v1/a.md)
    # [A-2](../v2/a.md)
outputs:
  136a42ac/docs/a.json:
  4667fedf/docs/a.json:
  e2dfe8fd/docs/toc.json: |
    {
      "items": [
        { "name": "A-1", "href": "a", "monikers": ["netcore-1.0"] },
        { "name": "A-2", "href": "a", "monikers": ["netcore-2.0"] }
      ]
    }
---
# Build included toc with moniker info
inputs:
  docfx.yml: |
    exclude: 'docs/v1/folder/TOC.yml'
    monikerRange:
      'docs/v1/**': '>= netcore-1.0 <= netcore-1.3'
    routes:
      docs/v1/: docs/
    monikerDefinition: '{APP_BASE_PATH}/data/monikers.json'
  docs/v1/b.md: |
    ---
    monikerRange: netcore-1.0
    ---
    Moniker: netcore-1.0
  docs/v1/c.md: |
    ---
    monikerRange: netcore-1.1
    ---
    Moniker: netcore-1.1
  docs/v1/d.md: |
    ---
    monikerRange: netcore-1.2
    ---
    Moniker: netcore-1.2
  docs/v1/e.md: |
    ---
    monikerRange: netcore-1.3
    ---
    Moniker: netcore-1.3
  docs/v1/TOC.yml: |
    metadata:
      monikerRange: '>= netcore-1.1'
    items:
      - name: Toc ref
        href: folder/TOC.yml
        items:
          - name: D
            href: d.md
      - name: Toc ref with topicHref
        href: folder/TOC.yml
        topicHref: e.md
        items:
          - name: D
            href: d.md
      - name: Toc ref with external link topicHref
        href: folder/TOC.yml
        topicHref: https://hostname/test
        items:
          - name: D
            href: d.md
  docs/v1/folder/TOC.yml: |
    metadata:
      monikerRange: '<= netcore-1.1'
    items:
      - name: B
        href: ../b.md
      - name: C
        href: ../c.md
outputs:
  136a42ac/docs/b.json:
  218c13d0/docs/c.json:
  b201e604/docs/d.json:
  8d1c2563/docs/e.json:
  8169d1ea/docs/toc.json: |
    {
      "items": [
        {
          "name": "Toc ref",
          "monikers": [ "netcore-1.0", "netcore-1.1" ],
          "items": [
            { "name": "B", "href": "b", "monikers": ["netcore-1.0"] },
            { "name": "C", "href": "c", "monikers": ["netcore-1.1"] }
          ]
        },
        {
          "name": "Toc ref with topicHref",
          "href": "e",
          "monikers": [ "netcore-1.0", "netcore-1.1", "netcore-1.3" ],
          "items": [
            { "name": "B", "href": "b", "monikers": ["netcore-1.0"] },
            { "name": "C", "href": "c", "monikers": ["netcore-1.1"] }
          ]
        },
        {
          "name": "Toc ref with external link topicHref",
          "href": "https://hostname/test",
          "monikers": undefined,
          "items": [
            { "name": "B", "href": "b", "monikers": ["netcore-1.0"] },
            { "name": "C", "href": "c", "monikers": ["netcore-1.1"] }
          ]
        }
      ]
    }
---
# Build folder reference toc with moniker info
inputs:
  docfx.yml: |
    exclude: 'docs/v1/folder/TOC.yml'
    monikerRange:
      'docs/v1/**': '>= netcore-1.0 <= netcore-1.3'
    routes:
      docs/v1/: docs/
    monikerDefinition: '{APP_BASE_PATH}/data/monikers.json'
  docs/v1/b.md: |
    ---
    monikerRange: netcore-1.0
    ---
    Moniker: netcore-1.0
  docs/v1/c.md: |
    ---
    monikerRange: netcore-1.1
    ---
    Moniker: netcore-1.1
  docs/v1/d.md: |
    ---
    monikerRange: netcore-1.2
    ---
    Moniker: netcore-1.2
  docs/v1/e.md: |
    ---
    monikerRange: netcore-1.3
    ---
    Moniker: netcore-1.3
  docs/v1/TOC.yml: |
    metadata:
      monikerRange: '>= netcore-1.1'
    items:
      - name: Folder ref
        href: folder/
        items:
          - name: D
            href: d.md
      - name: Folder ref with topicHref
        href: folder/
        topicHref: e.md
        items:
          - name: D
            href: d.md
      - name: Folder ref with external link topicHref
        href: folder/
        topicHref: https://hostname/test
        items:
          - name: D
            href: d.md
  docs/v1/folder/TOC.yml: |
    metadata:
      monikerRange: '<= netcore-1.1'
    items:
      - name: B
        href: ../b.md
      - name: C
        href: ../c.md
outputs:
  136a42ac/docs/b.json:
  218c13d0/docs/c.json:
  b201e604/docs/d.json:
  8d1c2563/docs/e.json:
  8169d1ea/docs/toc.json: |
    {
      "items": [
        {
          "name": "Folder ref",
          "href": "b",
          "monikers": [ "netcore-1.0", "netcore-1.2" ],
          "items": [
            { "name": "D", "href": "d", "monikers": ["netcore-1.2"] }
          ]
        },
        {
          "name": "Folder ref with topicHref",
          "href": "e",
          "monikers": [ "netcore-1.2", "netcore-1.3" ],
          "items": [
            { "name": "D", "href": "d", "monikers": ["netcore-1.2"] }
          ]
        },
        {
          "name": "Folder ref with external link topicHref",
          "href": "https://hostname/test",
          "monikers": undefined,
          "items": [
            { "name": "D", "href": "d", "monikers": ["netcore-1.2"] }
          ]
        }
      ]
    }
---
# Build toc with duplicate monikers
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '>= netcore-1.0'
      'docs/v2/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/TOC.md: |
    # Node
  docs/v2/TOC.md: |
    # Node
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
      ]
    }
outputs:
  e2dfe8fd/docs/toc.json:
  .publish.json: |
    {
      "files":
      [
        {
          "url": "/docs/toc.json",
          "locale": "en-us",
          "path": "e2dfe8fd/docs/toc.json",
        }
      ]
    }
  .errors.log: |
    {"message_severity":"warning","code":"publish-url-conflict","message":"Two or more files of the same version('netcore-2.0') publish to the same url '/docs/toc.json': 'docs/v1/TOC.md<'netcore-1.0', 'netcore-2.0'>', 'docs/v2/TOC.md<'netcore-2.0'>'."}
---
# No intersection of config monikers and file monikers of TOC file
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/TOC.md: |
    ---
    monikerRange: netcore-1.0
    ---
    # Node
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
      ]
    }
outputs:
  .errors.log: |
    {"message_severity":"error","code":"moniker-range-out-of-scope","message":"No moniker intersection between docfx.yml/docfx.json and file metadata. Config moniker range '>= netcore-2.0' is 'netcore-2.0', while file moniker range 'netcore-1.0' is 'netcore-1.0'.","file":"docs/v1/TOC.md","line":2,"column":15}
---
# Build resource file with moniker
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': 'netcore-1.0'
      'docs/v2/**': 'netcore-2.0'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    Moniker: netcore-1.0
    ![image](c.png)
  docs/v2/a.md: |
    Moniker: netcore-2.0
    ![image](c.png)
  docs/v1/c.png:
  docs/v2/c.png:
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
      ]
    }
outputs:
  136a42ac/docs/a.json:
  136a42ac/docs/c.png:
  4667fedf/docs/a.json:
  4667fedf/docs/c.png:
  .publish.json: |
    {
      "files": [
        { "url": "/docs/a", "path": "136a42ac/docs/a.json", "moniker_group": "136a42ac" },
        { "url": "/docs/c.png", "path": "136a42ac/docs/c.png", "moniker_group": "136a42ac" },
        { "url": "/docs/a", "path": "4667fedf/docs/a.json", "moniker_group": "4667fedf" },
        { "url": "/docs/c.png", "path": "4667fedf/docs/c.png", "moniker_group": "4667fedf" },
      ],
      "moniker_groups": {
        "136a42ac": ["netcore-1.0"],
        "4667fedf": ["netcore-2.0"]
      }
    }
---
# Build resource file with moniker conflict
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '<= netcore-1.1'
      'docs/v2/**': '>= netcore-1.1'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    Moniker: netcore-1.0, netcore-1.1
    ![image](c.png)
  docs/v2/a.md: |
    ---
    monikerRange: netcore-1.2
    ---
    Moniker: netcore-1.2
    ![image](c.png)
  docs/v1/c.png:
  docs/v2/c.png:
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.2", "product_name": ".NET Core" }
      ]
    }
outputs:
  e300a7df/docs/c.png:
  9d4e15fd/docs/a.json:
  b201e604/docs/a.json:
  .publish.json: |
    {
      "files": [
          { "url": "/docs/a" },
          { "url": "/docs/a" },
          { "url": "/docs/c.png", "path": "e300a7df/docs/c.png"},
      ]
    }
  .errors.log: |
    {"message_severity":"warning","code":"publish-url-conflict","message":"Two or more files of the same version('netcore-1.1') publish to the same url '/docs/c.png': 'docs/v1/c.png<'netcore-1.0', 'netcore-1.1'>', 'docs/v2/c.png<'netcore-1.1', 'netcore-1.2'>'."}
---
# Invalid moniker definition
inputs:
  docfx.yml: |
    monikerDefinition: monikerDefinition.json
  a.md:
  monikerDefinition.json: |
    { "monikers": [
outputs:
  .errors.log: |
    {"message_severity":"error","code":"json-syntax-error","message":"Unexpected end when deserializing array.","file":"monikerDefinition.json","line":2}
---
# Invalid moniker range in config
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '>= netcore-2.0'
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md:
  monikerDefinition.json: |
    {}
outputs:
  .errors.log: |
    {"message_severity":"error","code":"moniker-range-invalid","message":"Invalid moniker range '>= netcore-2.0': Moniker 'netcore-2.0' is not defined.","file":"docfx.yml","line":2,"column":17}
---
# Invalid moniker range in file
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '>= netcore-1.0'
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    ---
    monikerRange: netcore-1.2
    ---
  docs/v1/b.md: |
    # Invalid Moniker range
    ::: moniker range="<= netcore-1.2"
    Invalid moniker Zone
    ::: moniker-end
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" }
      ]
    }
outputs:
  .errors.log: |
    {"message_severity":"error","code":"moniker-range-invalid","message":"Invalid moniker range 'netcore-1.2': Moniker 'netcore-1.2' is not defined.","file":"docs/v1/a.md","line":2,"column":15}
    {"message_severity":"error","code":"moniker-range-invalid","message":"Invalid moniker range '<= netcore-1.2': Moniker 'netcore-1.2' is not defined.","file":"docs/v1/b.md","line":2,"column":1}
    {"message_severity":"error","code":"moniker-range-out-of-scope","message":"No moniker intersection between docfx.yml/docfx.json and file metadata. Config moniker range '>= netcore-1.0' is 'netcore-1.0', while file moniker range 'netcore-1.2' is ''.","file":"docs/v1/a.md","line":2,"column":15}
    {"message_severity":"warning","code":"moniker-zone-empty","message":"No intersection between zone and file level monikers. The result of zone level range string '<= netcore-1.2' is '', while file level monikers is 'netcore-1.0'.","file":"docs/v1/b.md","line":2,"column":1}
---
# Resolving moniker zone in token should base on root file's moniker
inputs:
  docfx.yml: |
    exclude: "**/includes/**"
    monikerRange:
      'docs/v1/**': '< netcore-2.0'
      'docs/v2/**': '>= netcore-2.0'
    hostName: docs.com
    basePath: /docs
    routes:
      docs/: .
      docs/v1/: .
      docs/v2/: .
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    [!INCLUDE [Include](../includes/token.md)]
  docs/v2/a.md: |
    [!INCLUDE [Include](../includes/token.md)]
  docs/includes/token.md: |
    Moniker: Same with parent
    ::: moniker range=">= netcore-1.1"
    Moniker: >= netcore-1.1
    ::: moniker-end
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  docs/9d4e15fd/a.json: |
    {
      "conceptual": "<p>Moniker: Same with parent</p><div data-moniker=\"netcore-1.1\"><p>Moniker: &gt;= netcore-1.1</p></div>",
      "monikers": ["netcore-1.0", "netcore-1.1"]
    }
  docs/23d205a5/a.json: |
    {
      "conceptual": "<p>Moniker: Same with parent</p><div data-moniker=\"netcore-2.0 netcore-2.1\"><p>Moniker: &gt;= netcore-1.1</p></div>",
      "monikers": ["netcore-2.0", "netcore-2.1"]
    }
  .publish.json: |
    {
      "files":[
        {"url":"/docs/a","moniker_group":"23d205a5"},
        {"url":"/docs/a","moniker_group":"9d4e15fd"}
      ],
      "moniker_groups":{
        "23d205a5":["netcore-2.0","netcore-2.1"],
        "9d4e15fd":["netcore-1.0","netcore-1.1"]
      }
    }
---
# Report a error when there are multiple files publish to same url, some with version, some without
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': 'netcore-1.0'
    hostName: docs.com
    basePath: /docs
    routes:
      docs/: .
      docs/v1/: .
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    ![image](b.png)
  docs/v1/TOC.md:
    # [A](a.md)
  docs/v1/b.png:
  docs/a.md: |
    ![image](b.png)
  docs/TOC.md:
    # [A](a.md)
  docs/b.png:
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" }
      ]
    }
outputs:
  docs/a.json:
  docs/b.png:
  docs/toc.json:
  .publish.json: |
    {
      "files":[
        {"url":"/docs/a","moniker_group":undefined},
        {"url":"/docs/b.png","moniker_group":undefined},
        {"url":"/docs/toc.json","moniker_group":undefined}
      ]
    }
  .errors.log: |
    {"message_severity":"warning","code":"publish-url-conflict","message":"Two or more files publish to the same url '/docs/b.png': 'docs/b.png', 'docs/v1/b.png'."}
    {"message_severity":"warning","code":"publish-url-conflict","message":"Two or more files publish to the same url '/docs/a': 'docs/a.md', 'docs/v1/a.md'."}
    {"message_severity":"warning","code":"publish-url-conflict","message":"Two or more files publish to the same url '/docs/toc.json': 'docs/TOC.md', 'docs/v1/TOC.md'."}
---
# monikers output should be stable
inputs:
  docfx.yml: |
    exclude: "**/includes/**"
    monikerRange:
      'docs/v1/**': 'versioning-2.0 || versioning-1.0'
    hostName: docs.com
    basePath: /docs
    routes:
      docs/v1/: .
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: 
  docs/v1/TOC.md: |
    # [A](a.md)
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "versioning-2.0", "product_name": "Product_A" },
        { "moniker_name": "versioning-1.0", "product_name": "Product_A" }
      ]
    }
outputs:
  docs/f649fb38/a.json:
  docs/f649fb38/toc.json:
  .publish.json: |
    {
      "files":[
        {"url":"/docs/a","moniker_group":"f649fb38"},
        {"url":"/docs/toc.json","moniker_group":"f649fb38"}
      ],
      "moniker_groups":{
        "f649fb38":["versioning-1.0","versioning-2.0"]
      }
    }
---
# Read moniker range from content src/dest and group settings
inputs:
  docfx.yml: |
    content:
    - src: v1
      dest: .
      group: g1
    - src: v2
      dest: .
      group: g2
    groups:
      g1:
        moniker_range: netcore-1.0
      g2:
        moniker_range: netcore-2.0
    monikerDefinition: monikerDefinition.json
  v1/a.md:
  v2/a.md:
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
      ]
    }
outputs:
  136a42ac/a.json: |
    { "monikers": ["netcore-1.0"] }
  4667fedf/a.json: |
    { "monikers": ["netcore-2.0"] }
---
# Allow monikers Config if monikerRange not defined
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/q.md: |
    ---
    monikers: netcore-2.0
    ---
    # Node
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
      ]
    }
outputs:
  4667fedf/docs/q.json: |
    {"monikers":["netcore-2.0"]}
---
# User defined monikers should not outrange moniker range in config
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/TOC.md: |
    ---
    monikers: netcore-1.0
    ---
    # Node
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
      ]
    }
outputs:
  .errors.log: |
    {"message_severity":"error","code":"moniker-range-out-of-scope","message":"No moniker intersection between docfx.yml/docfx.json and file metadata. Config moniker range '>= netcore-2.0' is 'netcore-2.0', while file monikers is 'netcore-1.0'.","file":"docs/v1/TOC.md","line":2,"column":11}
---
# Warn on moniker config duplication
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/TOC.md: |
    ---
    monikers: NETCore-1.0
    monikerRange: netcore-1.0
    ---
    # Node
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
      ]
    }
outputs:
  .errors.log: |
    {"message_severity":"error","code":"moniker-range-out-of-scope","message":"No moniker intersection between docfx.yml/docfx.json and file metadata. Config moniker range '>= netcore-2.0' is 'netcore-2.0', while file moniker range 'netcore-1.0' is 'netcore-1.0'.","file":"docs/v1/TOC.md","line":3,"column":15}
    {"message_severity":"warning","code":"duplicate-moniker-config","message":"Both 'monikers' and 'monikerRange' are defined, 'monikers' is ignored.","file":"docs/v1/TOC.md","line":2,"column":11}
---
# Throw on monikers value invalid
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/TOC.md: |
    ---
    monikers: netcore-1.1
    ---
    # Node
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
      ]
    }
outputs:
  .errors.log: |
    {"message_severity":"error","code":"moniker-range-invalid","message":"Invalid monikers: Moniker 'netcore-1.1' is not defined.","file":"docs/v1/TOC.md","line":2,"column":11}
    {"message_severity":"error","code":"moniker-range-out-of-scope","message":"No moniker intersection between docfx.yml/docfx.json and file metadata. Config moniker range '>= netcore-2.0' is 'netcore-2.0', while file monikers is ''.","file":"docs/v1/TOC.md","line":2,"column":11}
---
# Should take monikerRange as final monikers even it outputs empty
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '>= netcore-1.0'
    routes:
      docs/v1/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/TOC.md: |
    ---
    monikers: netcore-1.0
    monikerRange: '>netcore-1.0 <netcore-1.0'
    ---
    # Node
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
      ]
    }
outputs:
  .errors.log: |
    {"message_severity":"warning","code":"duplicate-moniker-config","message":"Both 'monikers' and 'monikerRange' are defined, 'monikers' is ignored.","file":"docs/v1/TOC.md","line":2,"column":11}
    {"message_severity":"error","code":"moniker-range-out-of-scope","message":"No moniker intersection between docfx.yml/docfx.json and file metadata. Config moniker range '>= netcore-1.0' is 'netcore-1.0', 'netcore-2.0', while file moniker range '>netcore-1.0 <netcore-1.0' is ''.","file":"docs/v1/TOC.md","line":3,"column":15}
---
# Should take monikers as final monikers if user inputs empty string for monikerRange
# and no duplicate-moniker-config warning
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '>= netcore-1.0'
    routes:
      docs/v1/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    ---
    monikers: netcore-1.0
    monikerRange:
    ---
    # Node
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
      ]
    }
outputs:
  136a42ac/docs/a.json: |
    {"monikers":["netcore-1.0"]}
---
# Should warn if user input monikers with array of empty items
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '>= netcore-1.0'
    routes:
      docs/v1/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/TOC.md: |
    ---
    monikers:
      -
    monikerRange: < netcore-2.0
    ---
    # Node
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
      ]
    }
outputs:
  136a42ac/docs/toc.json: |
    {"metadata":{}}
  .errors.log: |
    {"message_severity":"warning","code":"null-array-value","message":"'monikers' contains null value, the null value has been removed.","file":"docs/v1/TOC.md","line":3,"column":4}
    {"message_severity":"warning","code":"duplicate-moniker-config","message":"Both 'monikers' and 'monikerRange' are defined, 'monikers' is ignored."}
---
# Should be OK for reference versioning docset to skip moniker range in config file
inputs:
  docfx.yml: |
    skipMonikerValidation: true
    monikerDefinition: monikerDefinition.json
  docs/a.yml: |
    ### YamlMime:TestData
    metadata:
      monikers: 
      - NETcore-2.0
      - netcore-1.0
  _themes/ContentTemplate/schemas/TestData.schema.json: |
    {
      "properties": {
        "metadata": {
          "properties": {
            "monikers": { "type": "array" }
          }
        }
      }
    }  
  _themes/ContentTemplate/TestData.html.primary.tmpl:
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
      ]
    }
outputs:
  e2dfe8fd/docs/a.json: |
    {"metadata":{"monikers":["netcore-1.0","netcore-2.0"]}}
---
# Group config is ignored with groups missing in docfx.json of v2
inputs:
  docfx.json: |
    {
      "build": 
      {
        "content": [
          {
            "group": "group-1",
            "files": "**.md",
            "src": "docs/v1"
          },
          {
            "group": "group-2",
            "file": "**.md",
            "src": "docs/v2"
          }
        ],
        "dest": "docs",
        "monikerDefinition": "monikerDefinition.json"
      }
    }
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
      ]
    }
  docs/v1/a.md: |
    moniker: netcore-1.0
  docs/v2/a.md: |
    moniker: netcore-2.0
outputs:
  .errors.log: |
    {"message_severity":"warning","code":"output-path-conflict","message":"Two or more files output to the same path 'a.json': 'docs/v1/a.md', 'docs/v2/a.md'."}
  a.json: |
    {"conceptual":"<p>moniker: netcore-2.0</p>"}
---
# Compatible for version in docfx.json of v2
inputs:
  docfx.json: |
    {
      "build": 
      {
        "content": [
          {
            "version": "netcore-1.0",
            "files": "**.md",
            "src": "docs/v1"
          },
          {
            "version": "netcore-2.0",
            "file": "**.md",
            "src": "docs/v2"
          }
        ],
        "dest": "docs",
        "monikerDefinition": "monikerDefinition.json",
        "skipMonikerValidation": true,
      }
    }
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
      ]
    }
  docs/v1/a.md:
  docs/v2/a.md:
outputs:
  136a42ac/a.json: |
    {"monikers":["netcore-1.0"]}
  4667fedf/a.json: |
    {"monikers":["netcore-2.0"]}
---
# Group is ignored when version configured in docfx.json of v2
inputs:
  docfx.json: |
    {
      "build": 
      {
        "content": [
          {
            "version": "netcore-1.0",
            "group": "",
            "files": "**.md",
            "src": "docs/v1"
          },
          {
            "version": "netcore-2.0",
            "file": "**.md",
            "src": "docs/v2"
          }
        ],
        "dest": "docs",
        "monikerDefinition": "monikerDefinition.json",
        "skipMonikerValidation": true,
      }
    }
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
      ]
    }
  docs/v1/a.md:
  docs/v2/a.md:
outputs:
  136a42ac/a.json: |
    {"monikers":["netcore-1.0"]}
  4667fedf/a.json: |
    {"monikers":["netcore-2.0"]}
---
# Support exclude_monikers metadata
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/q.md: |
    ---
    exclude_monikers: netcore-2.0
    monikerRange: '< netcore-4.0'
    ---
    # Node
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-3.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-4.0", "product_name": ".NET Core" },
      ]
    }
outputs:
  439a76d0/docs/q.json: |
    {"monikers":["netcore-3.0"]}
---
# Support replace_monikers metadata
# when it is set, the other moniker related metadatas are ignored
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/q.md: |
    ---
    replace_monikers: netcore-4.0
    ---
    # Node
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-3.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-4.0", "product_name": ".NET Core" },
      ]
    }
outputs:
  b59389ff/docs/q.json: |
    {"monikers":["netcore-4.0"]}
---
# replace_monikers should intersect with the config monikers
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '<= netcore-2.0'
    routes:
      docs/v1/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/q.md: |
    ---
    replace_monikers: netcore-3.0
    ---
    # Node
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-3.0", "product_name": ".NET Core" },
      ]
    }
outputs:
  .errors.log: |
    {"message_severity":"error","log_item_type":"user","code":"moniker-range-out-of-scope","message":"No moniker intersection between docfx.yml/docfx.json and file metadata. Config moniker range '<= netcore-2.0' is 'netcore-1.0', 'netcore-2.0', while file monikers is 'netcore-3.0'.","file":"docs/v1/q.md","line":2,"column":19}
