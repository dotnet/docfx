---
# Apply moniker range setting in the config to markdown file's output path and output content
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '< netcore-2.0'
      'docs/v2/**': '>= netcore-2.0'
    baseUrl: https://docs.com/docs
    routes:
      docs/: .
      docs/v1/: .
      docs/v2/: .
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    Moniker: netcore-1.0, netcore-1.1
  docs/v2/a.md: |
    Moniker: netcore-2.0, netcore-2.1
  docs/a.md: |
    No version
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  docs/9d4e15fd/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-1.0, netcore-1.1</p>",
      "monikers": ["netcore-1.0", "netcore-1.1"]
    }
  docs/23d205a5/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-2.0, netcore-2.1</p>",
      "monikers": ["netcore-2.0", "netcore-2.1"]
    }
  docs/a.json: |
    {
      "conceptual": "<p>No version</p>",
      "!monikers": null
    }
  .publish.json: |
    {
      "files":[
        {"url":"/docs/a","moniker_group":"23d205a5"},
        {"url":"/docs/a","moniker_group":"9d4e15fd"},
        {"url":"/docs/a","!moniker_group":null}
      ],
      "moniker_groups":{
        "23d205a5":["netcore-2.0","netcore-2.1"],
        "9d4e15fd":["netcore-1.0","netcore-1.1"]
      }
    }
---
# Multiple matched moniker range setting in the config, should use the last one
inputs:
  docfx.yml: |
    monikerRange:
      'docs/**': 'netcore-1.0'
      'docs/v1/**': 'netcore-1.1'
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    Moniker: netcore-1.1
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
      ]
    }
outputs:
  218c13d0/docs/v1/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-1.1</p>",
      "monikers": ["netcore-1.1"]
    }
---
# Apply moniker range setting in the config and yaml header to markdown file's output path and output content
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '< netcore-2.0'
      'docs/v2/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    ---
    monikerRange: '> netcore-1.0'
    ---
    Moniker: netcore-1.1
  docs/v2/a.md: |
    ---
    monikerRange: '<= netcore-2.0'
    ---
    Moniker: netcore-2.0
  docs/a.md: |
    No version
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  docs/a.json: |
    {
      "conceptual": "<p>No version</p>",
      "!monikers": null,
    }
  218c13d0/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-1.1</p>",
      "monikers": ["netcore-1.1"],
    }
  4667fedf/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-2.0</p>",
      "monikers": ["netcore-2.0"],
    }
  .publish.json: |
    {
      "files": [
          { "url": "/docs/a", "path": "218c13d0/docs/a.json", "moniker_group": "218c13d0" },
          { "url": "/docs/a", "path": "4667fedf/docs/a.json", "moniker_group": "4667fedf" },
          { "url": "/docs/a", "path": "docs/a.json", "!moniker_group": null },
      ],
      "moniker_groups":{
        "218c13d0":["netcore-1.1"],
        "4667fedf":["netcore-2.0"]
      }
    }
---
# Moniker Zone syntax
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '>= netcore-1.0 <= netcore-1.2'
    routes:
      docs/v1/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    Moniker: netcore-1.0, netcore-1.1, netcore-1.2
    ::: moniker range="<= netcore-1.1"
    Moniker: netcore-1.0, netcore-1.1
    ::: moniker-end
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.2", "product_name": ".NET Core" },
      ]
    }
outputs:
  2420f88b/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-1.0, netcore-1.1, netcore-1.2</p><div data-moniker=\"netcore-1.0 netcore-1.1\"><p>Moniker: netcore-1.0, netcore-1.1</p></div>",
      "monikers": ["netcore-1.0", "netcore-1.1", "netcore-1.2"]
    }
---
# Redirection file with monikers
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '>= netcore-1.0 <= netcore-1.1'
      'docs/v2/**': '> netcore-1.1 <= netcore-1.3'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
    redirections:
      docs/v1/a-old.md: /docs/a1
    redirectionsWithoutId:
      docs/v2/a-old.md: /docs/a2
  docs/v1/a.md: |
    Moniker: netcore-1.0, netcore-1.1
  docs/v2/a.md: |
    Moniker: netcore-1.2, netcore-1.3
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.2", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.3", "product_name": ".NET Core" },
      ]
    }
outputs:
  9d4e15fd/docs/a.json: |
    {
      "document_id": "e6bc2b27-51df-e84a-768d-3008b0540975",
      "conceptual": "<p>Moniker: netcore-1.0, netcore-1.1</p>",
      "monikers": ["netcore-1.0", "netcore-1.1"]
    }
  f961cd88/docs/a.json: |
    {
      "document_id": "977a62e2-6380-388e-e785-819686caac32",
      "conceptual": "<p>Moniker: netcore-1.2, netcore-1.3</p>",
      "monikers": ["netcore-1.2", "netcore-1.3"]
    }
  .publish.json: |
    {
      "files": [
        { "url": "/docs/a-old", "redirect_url": "/docs/a1", "moniker_group": "9d4e15fd" },
        { "url": "/docs/a-old", "redirect_url": "/docs/a2", "moniker_group": "f961cd88" },
        { "url": "/docs/a", "moniker_group": "9d4e15fd" },
        { "url": "/docs/a", "moniker_group": "f961cd88" },
      ],
      "moniker_groups": {
        "f961cd88": ["netcore-1.2","netcore-1.3"],
        "9d4e15fd": ["netcore-1.0","netcore-1.1"]
      }
    }
---
# Redirection file with monikers range overlap
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '>= netcore-1.0 <= netcore-1.1'
      'docs/v2/**': '>= netcore-1.1 <= netcore-1.2'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
    redirections:
      docs/v1/a-old.md: /docs/a
    redirectionsWithoutId:
      docs/v2/a-old.md: /docs/a
  docs/v1/a.md: |
    Moniker: netcore-1.0, netcore-1.1
  docs/v2/a.md: |
    ---
    monikerRange: netcore-1.2
    ---
    Moniker: netcore-1.2
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.2", "product_name": ".NET Core" },
      ]
    }
outputs:
  9d4e15fd/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-1.0, netcore-1.1</p>",
      "monikers": ["netcore-1.0", "netcore-1.1"]
    }
  b201e604/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-1.2</p>",
      "monikers": ["netcore-1.2"]
    }
  .errors.log: |
    ["error","publish-url-conflict","Two or more files of the same version('netcore-1.1') publish to the same url '/docs/a-old': 'docs/v1/a-old.md <redirection>', 'docs/v2/a-old.md <redirection>'"]
---
# Two or more documents which don't have moniker or the moniker range is not mutually exclusive from others, publish to the same url
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '<= netcore-2.0'
      'docs/v2/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    Moniker: netcore-1.0, netcore-1.1, netcore-2.0
  docs/v2/a.md: |
    Moniker: netcore-2.0, netcore-2.1
  docs/a.md: |
    No version
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  .errors.log: |
    ["error","publish-url-conflict","Two or more files of the same version('netcore-2.0') publish to the same url '/docs/a': 'docs/a.md', 'docs/v1/a.md', 'docs/v2/a.md'"]
---
# With moniker range not defined in config, user should not define it in file metadata
inputs:
  docfx.yml: |
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    ---
    monikerRange: '> netcore-1.0'
    ---
    Moniker: netcore-1.1
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  docs/v1/a.json:
  .errors.log: |
    ["warning","moniker-config-missing","Moniker range missing in docfx.yml/docfx.json, user should not define it in file metadata or moniker zone.","docs/v1/a.md"]
---
# With moniker range not defined in config, user should not define it in moniker zone
inputs:
  docfx.yml: |
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    ::: moniker range="netcore-1.0"
    Moniker: netcore-1.0
    ::: moniker-end
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" }
      ]
    }
outputs:
  docs/v1/a.json:
  .errors.log: |
    ["warning","moniker-config-missing","Moniker range missing in docfx.yml/docfx.json, user should not define it in file metadata or moniker zone.","docs/v1/a.md"]
---
# No intersection of config monikers and file monikers
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '< netcore-2.0'
    routes:
      docs/v1/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    ---
    monikerRange: '> netcore-2.0'
    ---
    Moniker: no intersection
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  docs/a.json:
  .errors.log: |
    ["warning","empty-monikers","No moniker intersection between docfx.yml/docfx.json and file metadata. Config moniker range '< netcore-2.0' is 'netcore-1.0', 'netcore-1.1', while file moniker range '> netcore-2.0' is 'netcore-2.1'","docs/v1/a.md"]
---
# No intersection of file level monikers and zone monikers
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '<= netcore-1.1'
    routes:
      docs/v1/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    Moniker: netcore-1.0, netcore-1.1
    ::: moniker range="netcore-1.2"
    Moniker: netcore-1.2
    ::: moniker-end
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.2", "product_name": ".NET Core" },
      ]
    }
outputs:
  9d4e15fd/docs/a.json:
  .errors.log: |
    ["warning","empty-monikers","No intersection between zone and file level monikers. The result of zone level range string 'netcore-1.2' is 'netcore-1.2', while file level monikers is 'netcore-1.0', 'netcore-1.1'.","docs/v1/a.md"]
---
# Define uid with moniker range, refer to it with valid moniker in the same docset
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '< netcore-2.0'
      'docs/v2/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    ---
    uid: a
    title: netcore
    monikerRange: '> netcore-1.0'
    ---
    Moniker: netcore-1.1
  docs/v2/a.md: |
    ---
    uid: a
    title: netcore
    monikerRange: '<= netcore-2.0'
    ---
    Moniker: netcore-2.0
  docs/a.md: |
    No version
  docs/b.md: |
    Link to @a?view=netcore-1.1
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  docs/b.json: |
    {
      "conceptual": "<p>Link to <a href=\"a?view=netcore-1.1\">netcore</a></p>",
      "!monikers": null
    }
  docs/a.json: |
    {
      "conceptual": "<p>No version</p>",
      "!monikers": null
    }
  218c13d0/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-1.1</p>",
      "monikers": ["netcore-1.1"]
    }
  4667fedf/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-2.0</p>",
      "monikers": ["netcore-2.0"]
    }
---
# Define same uid with multiple moniker ranges in .md,
# title should be the same
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '< netcore-2.0'
      'docs/v2/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    ---
    uid: a
    title: netcore-1.1
    monikerRange: '> netcore-1.0'
    ---
    Moniker: netcore-1.1
  docs/v2/a.md: |
    ---
    uid: a
    title: netcore-2.0
    monikerRange: '<= netcore-2.0'
    ---
    Moniker: netcore-2.0
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  218c13d0/docs/a.json:
  4667fedf/docs/a.json:
  .errors.log: |
    ["warning","xref-property-conflict","UID 'a' is defined with different names: 'netcore-1.1', 'netcore-2.0'"]
---
# Define same uid with multiple moniker ranges with same name, 
# reference to it without moniker in the same docset, anyone can be taken
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '< netcore-2.0'
      'docs/v2/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    ---
    uid: a
    title: netcore
    monikerRange: '> netcore-1.0'
    ---
    Moniker: netcore-1.1
  docs/v2/a.md: |
    ---
    uid: a
    title: netcore
    monikerRange: '<= netcore-2.0'
    ---
    Moniker: netcore-2.0
  docs/a.md: |
    No version
  docs/b.md: |
    Link to @a
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  docs/b.json: |
    {
      "conceptual": "<p>Link to <a href=\"a\">netcore</a></p>",
      "!monikers": null
    }
  docs/a.json: |
    {
      "conceptual": "<p>No version</p>",
      "!monikers": null
    }
  218c13d0/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-1.1</p>",
      "monikers": ["netcore-1.1"]
    }
  4667fedf/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-2.0</p>",
      "monikers": ["netcore-2.0"]
    }
---
# Define same uid with overlapping moniker range
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '<= netcore-2.0'
      'docs/v2/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    ---
    uid: a
    title: netcore-1.1, netcore-2.0
    monikerRange: '> netcore-1.0'
    ---
    Moniker: netcore-1.1, netcore-2.0
  docs/v2/a.md: |
    ---
    uid: a
    title: netcore-2.0, netcore-2.1
    ---
    Moniker: netcore-2.0, netcore-2.1
  docs/c.md: Link to @a
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  docs/c.json: |
    {"conceptual":"<p>Link to <a href=\"a\" data-linktype=\"relative-path\">netcore-1.1, netcore-2.0</a></p>"}
  .errors.log: |
    ["warning","moniker-overlapping","Two or more documents have defined overlapping moniker: 'netcore-2.0'"]
    ["warning","xref-property-conflict","UID 'a' is defined with different names: 'netcore-1.1, netcore-2.0', 'netcore-2.0, netcore-2.1'"]
    ["error","publish-url-conflict","Two or more files of the same version('netcore-2.0') publish to the same url '/docs/a': 'docs/v1/a.md', 'docs/v2/a.md'"]
  xrefmap.json: | 
    {"references":[{"uid":"a","name":"netcore-1.1, netcore-2.0"}]}
---
# Define uid with moniker range, refer to it with invalid moniker, could fall back to anyone
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '< netcore-2.0'
      'docs/v2/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    ---
    uid: a
    title: netcore
    monikerRange: '> netcore-1.0'
    ---
    Moniker: netcore-1.1
  docs/v2/a.md: |
    ---
    uid: a
    title: netcore
    monikerRange: '<= netcore-2.0'
    ---
    Moniker: netcore-2.0
  docs/b.md: |
    Link @a?view=netcore-1.0
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  docs/b.json: |
    {
      "conceptual": "<p>Link <a href=\"a?view=netcore-1.0\">netcore</a></p>",
      "!monikers": null
    }
  218c13d0/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-1.1</p>",
      "monikers": ["netcore-1.1"]
    }
  4667fedf/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-2.0</p>",
      "monikers": ["netcore-2.0"]
    }
---
# [skip] Define same uid with and without moniker range
# while refer to it without moniker range, should pick the one without moniker range
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '< netcore-2.0'
      'docs/v2/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    ---
    uid: a
    title: netcore-1.1
    monikerRange: '> netcore-1.0'
    ---
    Moniker: netcore-1.1
  docs/v2/a.md: |
    ---
    uid: a
    title: netcore-2.0
    monikerRange: '<= netcore-2.0'
    ---
    Moniker: netcore-2.0
  docs/a.md: |
    ---
    uid: a
    title: no version
    ---
    No version
  docs/b.md: |
    Link to @a
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  docs/b.json: |
    {
      "conceptual": "<p>Link to <a href=\"a\">no version</a></p>",
      "!monikers": null
    }
  docs/a.json: |
    {
      "conceptual": "<p>No version</p>",
      "!monikers": null
    }
  218c13d0/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-1.1</p>",
      "monikers": ["netcore-1.1"]
    }
  4667fedf/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-2.0</p>",
      "monikers": ["netcore-2.0"]
    }
  xrefmap.json: | 
    {"references":[{"uid":"a","href":"https://docs.com/docs/a","name":"netcore-2.0"}]}
---
# Define multiple uid without moniker range, and also uid with moniker range
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '< netcore-2.0'
      'docs/v2/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    ---
    uid: a
    title: netcore-1.1
    monikerRange: '> netcore-1.0'
    ---
    Moniker: netcore-1.1
  docs/v2/a.md: |
    ---
    uid: a
    title: netcore-2.0
    monikerRange: '<= netcore-2.0'
    ---
    Moniker: netcore-2.0
  docs/a.md: |
    ---
    uid: a
    title: no version
    ---
    No version
  docs/b.md: |
    ---
    uid: a
    title: b with no version
    ---
    No version
  docs/c.md: |
    Link to @a
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.1", "product_name": ".NET Core" }
      ]
    }
outputs:
  docs/b.json:
  docs/c.json: |
    {
      "conceptual": "<p>Link to <a href=\"a\" data-linktype=\"relative-path\">no version</a></p>",
      "!monikers": null
    }
  docs/a.json: |
    {
      "conceptual": "<p>No version</p>",
      "!monikers": null
    }
  218c13d0/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-1.1</p>",
      "monikers": ["netcore-1.1"]
    }
  4667fedf/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-2.0</p>",
      "monikers": ["netcore-2.0"]
    }
  xrefmap.json: | 
    {"references":[{"uid":"a","name":"no version"}]}
  .errors.log: |
    ["warning","uid-conflict","UID 'a' is defined in more than one file: 'docs/a.md', 'docs/b.md'"]
    ["warning","xref-property-conflict","UID 'a' is defined with different names: 'b with no version', 'netcore-1.1', 'netcore-2.0', 'no version'"]
---
# Build toc with monikers info
inputs:
  docfx.yml: |
    exclude: 'docs/v1/folder/TOC.yml'
    monikerRange:
      'docs/v1/**': '>= netcore-1.0'
    routes:
      docs/v1/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    ---
    monikerRange: netcore-1.0 || netcore-1.1
    uid: a
    ---
    Moniker: netcore-1.0, netcore-1.1
  docs/v1/b.md: |
    ---
    monikerRange: netcore-1.1 || netcore-1.2
    ---
    Moniker: netcore-1.1, netcore-1.2
  docs/v1/TOC.md: |
    ---
    monikerRange: '>= netcore-1.1'
    ---
    # [A](a.md)
    ## [B](b.md)
    ## [C](/c)
    ## [D](http://test.com/test)
    ### [A](xref:a)
    ## E
    ### [A](a.md)
    ### [B](b.md)
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.2", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.3", "product_name": ".NET Core" }
      ]
    }
outputs:
  9d4e15fd/docs/a.json: |
    {
      "conceptual": "<p>Moniker: netcore-1.0, netcore-1.1</p>",
      "monikers": ["netcore-1.0", "netcore-1.1"]
    }
  e300a7df/docs/b.json: |
    {
      "conceptual": "<p>Moniker: netcore-1.1, netcore-1.2</p>",
      "monikers": ["netcore-1.1", "netcore-1.2"]
    }
  8169d1ea/docs/toc.json: |
    {
      "items": [
        {
          "name": "A",
          "href": "a",
          "items": [
            { "name": "B", "href": "b", "monikers": ["netcore-1.1", "netcore-1.2"] },
            { "name": "C", "href": "/c", "monikers": ["netcore-1.1", "netcore-1.2", "netcore-1.3"] },
            { 
              "name": "D",
              "href": "http://test.com/test",
              "monikers": ["netcore-1.0", "netcore-1.1", "netcore-1.2", "netcore-1.3"],
              "items": [
                { "name": "A", "href": "a", "monikers": ["netcore-1.0", "netcore-1.1"] }
              ]
            },
            {
              "name": "E",
              "monikers": [ "netcore-1.0", "netcore-1.1", "netcore-1.2" ],
              "items": [
                { "name": "A", "href": "a", "monikers": [ "netcore-1.0", "netcore-1.1" ] },
                { "name": "B", "href": "b", "monikers": [ "netcore-1.1", "netcore-1.2"] },
              ]
            }
          ],
          "monikers": ["netcore-1.0", "netcore-1.1", "netcore-1.2", "netcore-1.3"]
        }
      ],
      "metadata": {"monikers": ["netcore-1.1", "netcore-1.2", "netcore-1.3" ]}
    }
---
# Build toc with monikers info - multiple node with same url
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': 'netcore-1.0'
      'docs/v2/**': 'netcore-2.0'
      'docs/v1-v2/**': 'netcore-1.0 || netcore-2.0'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
      docs/v1-v2/: docs/
    monikerDefinition: https://raw.githubusercontent.com/docascode/docfx-test-dependencies/master/monikerDefinition
  docs/v1/a.md: |
    Moniker: netcore-1.0
  docs/v2/a.md: |
    Moniker: netcore-2.0
  docs/v1-v2/TOC.md: |
    # [A-1](../v1/a.md)
    # [A-2](../v2/a.md)
outputs:
  136a42ac/docs/a.json: |
  4667fedf/docs/a.json: |
  e2dfe8fd/docs/toc.json: |
    {
      "items": [
        { "name": "A-1", "href": "a", "monikers": ["netcore-1.0"] },
        { "name": "A-2", "href": "a", "monikers": ["netcore-2.0"] }
      ],
      "metadata": { "monikers": [ "netcore-1.0", "netcore-2.0" ]}
    }
---
# Build included toc with moniker info
inputs:
  docfx.yml: |
    exclude: 'docs/v1/folder/TOC.yml'
    monikerRange:
      'docs/v1/**': '>= netcore-1.0 <= netcore-1.3'
    routes:
      docs/v1/: docs/
    monikerDefinition: '{APP_BASE_PATH}/data/monikers.json'
  docs/v1/b.md: |
    ---
    monikerRange: netcore-1.0
    ---
    Moniker: netcore-1.0
  docs/v1/c.md: |
    ---
    monikerRange: netcore-1.1
    ---
    Moniker: netcore-1.1
  docs/v1/d.md: |
    ---
    monikerRange: netcore-1.2
    ---
    Moniker: netcore-1.2
  docs/v1/e.md: |
    ---
    monikerRange: netcore-1.3
    ---
    Moniker: netcore-1.3
  docs/v1/TOC.yml: |
    metadata:
      monikerRange: '>= netcore-1.1'
    items:
      - name: Toc ref
        href: folder/TOC.yml
        items:
          - name: D
            href: d.md
      - name: Toc ref with topicHref
        href: folder/TOC.yml
        topicHref: e.md
        items:
          - name: D
            href: d.md
  docs/v1/folder/TOC.yml: |
    metadata:
      monikerRange: '<= netcore-1.1'
    items:
      - name: B
        href: ../b.md
      - name: C
        href: ../c.md
outputs:
  136a42ac/docs/b.json:
  218c13d0/docs/c.json:
  b201e604/docs/d.json:
  8d1c2563/docs/e.json:
  8169d1ea/docs/toc.json: |
    {
      "items": [
        {
          "name": "Toc ref",
          "monikers": [ "netcore-1.0", "netcore-1.1" ],
          "items": [
            { "name": "B", "href": "b", "monikers": ["netcore-1.0"] },
            { "name": "C", "href": "c", "monikers": ["netcore-1.1"] }
          ]
        },
        {
          "name": "Toc ref with topicHref",
          "href": "e",
          "monikers": [ "netcore-1.0", "netcore-1.1", "netcore-1.3" ],
          "items": [
            { "name": "B", "href": "b", "monikers": ["netcore-1.0"] },
            { "name": "C", "href": "c", "monikers": ["netcore-1.1"] }
          ]
        }
      ],
      "metadata": { "monikers": ["netcore-1.1", "netcore-1.2", "netcore-1.3" ] }
    }
---
# Build folder reference toc with moniker info
inputs:
  docfx.yml: |
    exclude: 'docs/v1/folder/TOC.yml'
    monikerRange:
      'docs/v1/**': '>= netcore-1.0 <= netcore-1.3'
    routes:
      docs/v1/: docs/
    monikerDefinition: '{APP_BASE_PATH}/data/monikers.json'
  docs/v1/b.md: |
    ---
    monikerRange: netcore-1.0
    ---
    Moniker: netcore-1.0
  docs/v1/c.md: |
    ---
    monikerRange: netcore-1.1
    ---
    Moniker: netcore-1.1
  docs/v1/d.md: |
    ---
    monikerRange: netcore-1.2
    ---
    Moniker: netcore-1.2
  docs/v1/e.md: |
    ---
    monikerRange: netcore-1.3
    ---
    Moniker: netcore-1.3
  docs/v1/TOC.yml: |
    metadata:
      monikerRange: '>= netcore-1.1'
    items:
      - name: Folder ref
        href: folder/
        items:
          - name: D
            href: d.md
      - name: Folder ref with topicHref
        href: folder/
        topicHref: e.md
        items:
          - name: D
            href: d.md
  docs/v1/folder/TOC.yml: |
    metadata:
      monikerRange: '<= netcore-1.1'
    items:
      - name: B
        href: ../b.md
      - name: C
        href: ../c.md
outputs:
  136a42ac/docs/b.json:
  218c13d0/docs/c.json:
  b201e604/docs/d.json:
  8d1c2563/docs/e.json:
  8169d1ea/docs/toc.json: |
    {
      "items": [
        {
          "name": "Folder ref",
          "href": "b",
          "monikers": [ "netcore-1.0", "netcore-1.2" ],
          "items": [
            { "name": "D", "href": "d", "monikers": ["netcore-1.2"] }
          ]
        },
        {
          "name": "Folder ref with topicHref",
          "href": "e",
          "monikers": [ "netcore-1.2", "netcore-1.3" ],
          "items": [
            { "name": "D", "href": "d", "monikers": ["netcore-1.2"] }
          ]
        }
      ],
      "metadata": { "monikers": ["netcore-1.1", "netcore-1.2", "netcore-1.3" ] }
    }
---
# Build toc with duplicate monikers
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '>= netcore-1.0'
      'docs/v2/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/TOC.md: |
    # Node
  docs/v2/TOC.md: |
    # Node
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
      ]
    }
outputs:
  .errors.log: |
    ["error","publish-url-conflict","Two or more files of the same version('netcore-2.0') publish to the same url '/docs/toc.json': 'docs/v1/TOC.md', 'docs/v2/TOC.md'"]
---
# No intersection of config monikers and file monikers of TOC file
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '>= netcore-2.0'
    routes:
      docs/v1/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/TOC.md: |
    ---
    monikerRange: netcore-1.0
    ---
    # Node
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
      ]
    }
outputs:
  docs/toc.json:
  .errors.log: |
    ["warning","empty-monikers","No moniker intersection between docfx.yml/docfx.json and file metadata. Config moniker range '>= netcore-2.0' is 'netcore-2.0', while file moniker range 'netcore-1.0' is 'netcore-1.0'","docs/v1/TOC.md"]
---
# Build resource file with moniker
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '>= netcore-1.0'
    routes:
      docs/v1/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    ---
    monikerRange: netcore-1.0
    ---
    Moniker: netcore-1.0
    ![image](c.png)
  docs/a.md: |
    No version
    ![image](c.png)
  docs/v1/c.png:
  docs/v1/b.png:
  docs/c.png:
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
      ]
    }
outputs:
  136a42ac/docs/a.json:
  9d4e15fd/docs/c.png:
  docs/a.json:
  docs/c.png:
  .publish.json: |
    {
      "files": [
        { "url": "/docs/a", "path": "136a42ac/docs/a.json", "moniker_group": "136a42ac" },
        { "url": "/docs/c.png", "path": "9d4e15fd/docs/c.png", "moniker_group": "9d4e15fd" },
        { "url": "/docs/a", "path": "docs/a.json", "!moniker_group": null },
        { "url": "/docs/c.png", "path": "docs/c.png", "!moniker_group": null }
      ],
      "moniker_groups": {
        "136a42ac": ["netcore-1.0"],
        "9d4e15fd": ["netcore-1.0","netcore-1.1"]
      }
    }
---
# Build resource file with moniker conflict
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '<= netcore-1.1'
      'docs/v2/**': '>= netcore-1.1'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    Moniker: netcore-1.0, netcore-1.1
    ![image](c.png)
  docs/v2/a.md: |
    ---
    monikerRange: netcore-1.2
    ---
    Moniker: netcore-1.2
    ![image](c.png)
  docs/v1/c.png:
  docs/v1/b.png:
  docs/v2/c.png:
  docs/v2/b.png:
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.2", "product_name": ".NET Core" }
      ]
    }
outputs:
  9d4e15fd/docs/a.json:
  b201e604/docs/a.json:
  .publish.json: |
    {
      "files": [
          { "url": "/docs/a" },
          { "url": "/docs/a" }
      ]
    }
  .errors.log: |
    ["error","publish-url-conflict","Two or more files of the same version('netcore-1.1') publish to the same url '/docs/c.png': 'docs/v1/c.png', 'docs/v2/c.png'"]
---
# Invalid moniker definition
inputs:
  docfx.yml: |
    monikerDefinition: monikerDefinition.json
  a.md:
  monikerDefinition.json: |
    { "monikers": [
outputs:
  .errors.log: |
    ["error","json-syntax-error","Unexpected end when deserializing array.","monikerDefinition.json",2]
---
# Invalid moniker range in config
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '>= netcore-2.0'
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md:
  monikerDefinition.json: |
    {}
outputs:
  .errors.log: |
    ["error","moniker-range-invalid","Invalid moniker range: '>= netcore-2.0': Moniker `netcore-2.0` is not defined","docfx.yml",2,17]
---
# Invalid moniker range in file
inputs:
  docfx.yml: |
    monikerRange:
      'docs/v1/**': '>= netcore-1.0'
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    ---
    monikerRange: netcore-1.2
    ---
  docs/v1/b.md: |
    # Invalid Moniker range
    ::: moniker range="<= netcore-1.2"
    Invalid moniker Zone
    ::: moniker-end
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" }
      ]
    }
outputs:
  .errors.log: |
    ["error","moniker-range-invalid","Invalid moniker range: 'netcore-1.2': Moniker `netcore-1.2` is not defined","docs/v1/a.md",2,15]
    ["error","moniker-range-invalid","Invalid moniker range: '<= netcore-1.2': Moniker `netcore-1.2` is not defined","docs/v1/b.md",2,1]
