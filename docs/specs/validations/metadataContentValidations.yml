---
# Check git merge conflict marker
inputs:
  docfx.yml:
  docs/a.md: |
    <<<<<<< HEAD
    foo
    =======
    bar
    >>>>>>> cb1abc6bd98cfc84317f8aa95a7662815417802d
outputs:
  docs/a.json:
  .errors.log: |
    {"message_severity":"suggestion","code":"merge-conflict","message":"File contains merge conflict markers. NOTE: This Suggestion will become a Warning on 06/30/2020.","file":"docs/a.md","line":1,"column":1}
---
# Ignore git merge conflict marker inside code blocks
inputs:
  docfx.yml:
  docs/a.md: |
    a

    ```markdown
    <<<<<<< HEAD
    ...
    =======
    ...
    >>>>>>> 1d82c7efe18f86136247fb366df5030843199c19
    ```
outputs:
  docs/a.json:
---
# Remove object form metadata from publish.json
inputs:
  docfx.yml: |
    globalMetadata:
      key1: {}
    fileMetadata:
      key2:
        '**/*':
          - a: 1
  a.md:
outputs:
  a.json: |
    { "key1": {}, "key2": [{ "a": 1 }] }
  .publish.json: |
    {
      "files": [{ "url": "/a", "key1": undefined, "key2": undefined }]
    }
---
# Additional metadata validation from external JSON schema
inputs:
  docfx.yml: |
    metadataSchema: schema.json
    globalMetadata:
      key1: []
    fileMetadata:
      key2:
        '**/*': XNAGameStudio
  schema.json: |
    {
      "properties":{
        "key1": { "type": "string" },
        "key2": { "type": "string", "enum": ["VS", "MSDN"] },
        "key3": { "type": "integer" }
      }
    }
  a.md: |
    ---
    key3: net462
    ---
outputs:
  a.json: |
    {
      "key1": [],
      "key2": "XNAGameStudio",
      "key3": "net462"
    }
  .errors.log: |
    {"message_severity":"warning","code":"unexpected-type","message":"Expected type 'String' but got 'Array'.","file":"docfx.yml","line":3,"column":9}
    {"message_severity":"warning","code":"invalid-value","message":"Invalid value for 'key2': 'XNAGameStudio'.","file":"docfx.yml","line":6,"column":13}
    {"message_severity":"warning","code":"unexpected-type","message":"Expected type 'Integer' but got 'String'.","file":"a.md","line":2,"column":7}
---
# Report missing-attribute at file level when yaml header missing
inputs:
  docfx.yml: |
    metadataSchema: schema.json
  schema.json: |
    { "required": ["a"] }
  a.md:
  b.md: |
    ---
    ---
outputs:
  a.json:
  b.json:
  .errors.log: |
    {"message_severity":"warning","code":"missing-attribute","message":"Missing required attribute: 'a'.","file":"a.md","line":1,"column":1}
    {"message_severity":"warning","code":"missing-attribute","message":"Missing required attribute: 'a'.","file":"b.md","line":1,"column":1}
---
# Allow multiple metadata schema definitions
inputs:
  docfx.yml: |
    metadataSchema:
      - schema1.json
      - schema2.json
  schema1.json: |
    { "required": ["a"] }
  schema2.json: |
    { "properties": { "key": { "type": "string" } } }
  a.md: |
    ---
    key: []
    ---
outputs:
  a.json:
  .errors.log: |
    {"message_severity":"warning","code":"missing-attribute","message":"Missing required attribute: 'a'.","file":"a.md","line":2,"column":1}
    {"message_severity":"warning","code":"unexpected-type","message":"Expected type 'String' but got 'Array'.","file":"a.md","line":2,"column":6}
---
# Validate each metadata schema individually for multiple metadata schema definitions
inputs:
  docfx.yml: |
    metadataSchema:
      - schema1.json
      - schema2.json
  schema1.json: |
    { "required": ["a"], "properties": { "key": { "type": "string" } } }
  schema2.json: |
    { "required": ["b"], "properties": { "key": { "type": "array" } } }
  a.md: |
    ---
    key: 1
    ---
outputs:
  a.json:
  .errors.log: |
    {"message_severity":"warning","code":"missing-attribute","message":"Missing required attribute: 'a'.","file":"a.md","line":2,"column":1}
    {"message_severity":"warning","code":"unexpected-type","message":"Expected type 'String' but got 'Integer'.","file":"a.md","line":2,"column":6}
    {"message_severity":"warning","code":"missing-attribute","message":"Missing required attribute: 'b'.","file":"a.md","line":2,"column":1}
    {"message_severity":"warning","code":"unexpected-type","message":"Expected type 'Array' but got 'Integer'.","file":"a.md","line":2,"column":6}
---
# Json schema microsoft alias rule: Mute error, when no connection with Graph API
inputs:
  docfx.yml: |
    metadataSchema: schema.json
  schema.json: |
    { 
      "properties":
      { 
        "ms.author":
        { 
          "microsoftAlias": 
          {
            "allowedDLs":[]
          }
        }
      } 
    }
  a.md: |
    ---
    ms.author: over123
    ---
outputs:
  a.json: |
    { "ms.author": "over123" }
---
# Json schema microsoft alias rule: The author is in the allow list
os: windows
inputs:
  docfx.yml: |
    metadataSchema: schema.json
    microsoftGraphClientSecret: {MICROSOFT_GRAPH_CLIENT_SECRET}
  schema.json: |
    { 
      "properties":
      { 
        "ms.author":
        { 
          "microsoftAlias": 
          {
            "allowedDLs":["amlstudiodocs", "over123"]
          }
        }
      } 
    }
  a.md: |
    ---
    ms.author: over123
    ---
environments:
  - MICROSOFT_GRAPH_CLIENT_SECRET
outputs:
  a.json: |
    { "ms.author": "over123" }
---
# Json schema microsoft alias rule: The author is in the cache
os: windows
inputs:
  docfx.yml: |
    metadataSchema: schema.json
    microsoftGraphClientSecret: {MICROSOFT_GRAPH_CLIENT_SECRET}
  schema.json: |
    { 
      "properties":
      { 
        "ms.author":
        { 
          "microsoftAlias": 
          {
            "allowedDLs":[]
          }
        }
      } 
    }
  a.md: |
    ---
    ms.author: over123
    ---
cache:
  msgraph-users.json: |
    { 
      "items": [{ "alias": "over123", "id": "1" }]
    }
environments:
  - MICROSOFT_GRAPH_CLIENT_SECRET
outputs:
  a.json: |
    { "ms.author": "over123" }
---
# Json schema microsoft alias rule: Missing author in the cache
os: windows
inputs:
  docfx.yml: |
    metadataSchema: schema.json
    microsoftGraphClientSecret: {MICROSOFT_GRAPH_CLIENT_SECRET}
  schema.json: |
    { 
      "properties":
      { 
        "ms.author":
        { 
          "microsoftAlias": 
          {
            "allowedDLs":[]
          }
        }
      } 
    }
  a.md: |
    ---
    ms.author: over123
    ---
cache:
  msgraph-users.json: |
    { 
      "items": [{ "alias": "over123" }]
    }
environments:
  - MICROSOFT_GRAPH_CLIENT_SECRET
outputs:
  a.json:
  .errors.log: |
    {"message_severity":"warning","code":"ms-alias-invalid","message":"Invalid value for 'ms.author', 'over123' is not a valid Microsoft alias.","file":"a.md","line":2,"column":12}
---
# Json schema microsoft alias rule: The author is valid with graph call
os: windows
inputs:
  docfx.yml: |
    metadataSchema: schema.json
    microsoftGraphClientSecret: {MICROSOFT_GRAPH_CLIENT_SECRET}
  schema.json: |
    { 
      "properties":
      { 
        "ms.author":
        { 
          "microsoftAlias": 
          {
            "allowedDLs":[]
          }
        }
      } 
    }
  a.md: |
    ---
    ms.author: yufeih
    ---
environments:
  - MICROSOFT_GRAPH_CLIENT_SECRET
outputs:
  a.json: |
    { "ms.author": "yufeih" }
---
# Json schema microsoft alias rule: The author is invalid with graph call
os: windows
inputs:
  docfx.yml: |
    metadataSchema: schema.json
    microsoftGraphClientSecret: {MICROSOFT_GRAPH_CLIENT_SECRET}
  schema.json: |
    { 
      "properties":
      { 
        "ms.author":
        { 
          "microsoftAlias": 
          {
            "allowedDLs":[]
          }
        }
      } 
    }
  a.md: |
    ---
    ms.author: abc1234cba
    ---
environments:
  - MICROSOFT_GRAPH_CLIENT_SECRET
outputs:
  a.json:
  .errors.log: |
    {"message_severity":"warning","code":"ms-alias-invalid","message":"Invalid value for 'ms.author', 'abc1234cba' is not a valid Microsoft alias.","file":"a.md","line":2,"column":12}
---
# Content validation end to end scenario 
inputs:
  docfx.yml: |
    markdownValidationRules: rules.json
  rules.json: |
    {
      "headings": {
        "name": "Headings",
        "description": "Validates H1 and other heading content",
        "aliases": null,
        "rules": [
          {
            "type": "H1Missing",
            "message": "H1 is required. Use a single hash (#) followed by a space to create your top-level heading.",
            "exclusions": [ "toc", "includes", "hubpage", "landingpage" ],
            "severity": "WARNING",
            "code": "h1-missing"
          }
        ]
      }
    }
  a.md: |
    This is test.
outputs:
  a.json:
  .errors.log: |
    {"message_severity":"warning","code":"h1-missing","message":"H1 is required. Use a single hash (#) followed by a space to create your top-level heading.","file":"a.md","line":1}
---
# Validate included markdown files within Yaml file
inputs:
  docfx.yml: |
    markdownValidationRules: rules.json
  rules.json: |
    {
      "headings": {
        "name": "Headings",
        "description": "Validates H1 and other heading content",
        "aliases": null,
        "rules": [
          {
            "type": "H1Missing",
            "message": "H1 is required. Use a single hash (#) followed by a space to create your top-level heading.",
            "exclusions": [],
            "severity": "WARNING",
            "code": "h1-missing"
          }
        ]
      }
    }
  docs/a.yml: |
    #YamlMime:YamlDocument
    documentType: LandingData
    title: my title
    content: |
      [!include[](b.md)]
  docs/b.md: |
    This is test.
outputs:
  docs/a.json: |
    {
      "title": "my title"
    }
  docs/b.json:
  .errors.log: |
    {"message_severity":"warning","code":"h1-missing","message":"H1 is required. Use a single hash (#) followed by a space to create your top-level heading.","file":"docs/b.md","line":1}
---
# Skip content validation for yaml files
inputs:
  docfx.yml: |
    markdownValidationRules: rules.json
  rules.json: |
    {
      "headings": {
        "name": "Headings",
        "description": "Validates H1 and other heading content",
        "aliases": null,
        "rules": [
          {
            "type": "H1Missing",
            "message": "H1 is required. Use a single hash (#) followed by a space to create your top-level heading.",
            "exclusions": [],
            "severity": "WARNING",
            "code": "h1-missing"
          }
        ]
      }
    }
  docs/a.yml: |
    #YamlMime:YamlDocument
    documentType: LandingData
    title: my title
    abstract:
      description: this is test.
outputs:
  docs/a.json: |
    {
      "title": "my title"
    }
---
# Json schema docset unique: the attribute value must be unique within docset
inputs:
  docfx.yml: |
    metadataSchema: schema.json
  schema.json: |
    {
      "docsetUnique": [ "title", "description"]
    }
  a.md: |
    ---
    title: title1
    description: description1
    ---
  b.md: |
    ---
    description: description1
    title: title2
    ---
outputs:
  a.json:
  b.json:
  .errors.log: |
    {"message_severity":"suggestion","code":"duplicate-attribute","message":"Attribute 'description' with value 'description1' is duplicated in 'a.md(3,14)', 'b.md(2,14)'.","file":"b.md","line":2,"column":14}
    {"message_severity":"suggestion","code":"duplicate-attribute","message":"Attribute 'description' with value 'description1' is duplicated in 'a.md(3,14)', 'b.md(2,14)'.","file":"a.md","line":3,"column":14}
---
# Json schema docset unique: null/empty values are not in-scope
inputs:
  docfx.yml: |
    metadataSchema: schema.json
  schema.json: |
    {
      "docsetUnique": [ "title", "description"]
    }
  a.md: |
    ---
    title: null
    description:
    ---
  b.md: |
    ---
    description:
    title: null
    ---
outputs:
  a.json:
  b.json:
---
# Json schema docset unique: global metadata and file metadata
inputs:
  docfx.yml: |
    metadataSchema: schema.json
    globalMetadata:
      description: abc
  schema.json: |
    {
      "docsetUnique": ["description"]
    }
  a.md: |
    ---
    description: abc
    ---
  b.md:
outputs:
  a.json:
  b.json:
  .errors.log: |
    {"message_severity":"suggestion","code":"duplicate-attribute","message":"Attribute 'description' with value 'abc' is duplicated in 'a.md(2,14)', 'docfx.yml(3,16)'.","file":"a.md","line":2,"column":14}
    {"message_severity":"suggestion","code":"duplicate-attribute","message":"Attribute 'description' with value 'abc' is duplicated in 'a.md(2,14)', 'docfx.yml(3,16)'.","file":"docfx.yml","line":3,"column":16}
---
# Json schema length rule: the length of string must be in range of MinLength and MaxLength
inputs:
  docfx.yml: |
    metadataSchema: schema.json
  schema.json: |
    { 
      "properties":
      { 
        "description": {
          "type": [
            "string",
            "null"
          ],
          "minLength": 2,
          "maxLength": 10
        }
      }
    }
  a.md: |
    ---
    description: a
    ---
  b.md: |
    ---
    description: a long description
    ---
outputs:
  a.json:
  b.json:
  .errors.log: |
    {"message_severity":"warning","code":"string-length-invalid","message":"String 'description' is too short: 1 characters. Length should be >= 2.","file":"a.md","line":2,"column":14}
    {"message_severity":"warning","code":"string-length-invalid","message":"String 'description' is too long: 18 characters. Length should be <= 10.","file":"b.md","line":2,"column":14}
---
# Content validation - H1 unique
inputs:
  docfx.yml: |
    markdownValidationRules: rules.json
  rules.json: |
    {
      "headings": {
        "name": "Headings",
        "description": "Validates H1 and other heading content",
        "aliases": null,
        "rules": [
          {
            "type": "H1Unique",
            "message": "H1 '{0}' is duplicated with other articles: '{1}'",
            "code": "duplicate-h1",
            "severity": "SUGGESTION",
            "exclusions": [
              "includes",
              "landingPage",
              "hubPage",
              "toc"
            ],
            "excludedDocfxVersions": [
              "v2"
            ]
          }
        ]
      }
    }
  a.md: |
    # Title 1
  b.md: |
    # Title 1
  c.md: |
    # Title 2
outputs:
  a.json:
  b.json:
  c.json:
  .errors.log: |
    {"message_severity":"suggestion","log_item_type":"user","code":"duplicate-h1","message":"H1 'Title 1' is duplicated with other articles: 'a.md, b.md'","file":"b.md","line":1,"end_line":1,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"duplicate-h1","message":"H1 'Title 1' is duplicated with other articles: 'a.md, b.md'","file":"a.md","line":1,"end_line":1,"column":1,"end_column":1}
---
# Content validation - Publish Url - max level
# Validation is only worked in the conceptual page
inputs:
  docfx.yml: |
    monikerRange:
      'v1/**': '< netcore-2.0'
      'v2/**': '>= netcore-2.0'
    markdownValidationRules: rules.json
    basePath: /docs
    routes:
      v1/: folder/
      v2/: folder/
      folder0/: folder/
    monikerDefinition: monikerDefinition.json
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
      ]
    }
  redirections.yml: |
    redirections:
      folder0/folder1/folder2/c.md: "docs/folder/folder1/c"
  rules.json: |
    {
      "publishurls": {
        "name": "PublishUrls",
        "description": "Validates publish urls",
        "aliases": null,
        "rules": [
          {
            "type": "MaxLevel",
            "message": "Article URL '{0}' is '{1}' levels deep. For SEO, URLs should be '{2}' levels or fewer.",
            "code": "path-too-deep",
            "severity": "SUGGESTION",
            "exclusions": [
              "includes",
              "landingPage",
              "hubPage",
              "toc",
              "redirection"
            ],
            "excludedDocfxVersions": [
              "v2"
            ],
            "maxLevel": 4
          }
        ]
      }
    }
  folder0/folder1/folder2/index.md:  
  v1/folder1/folder2/a.md: |
    Moniker: netcore-1.0
  v2/folder1/folder2/a.md: |
    Moniker: netcore-2.0
  folder0/folder1/folder2/TOC.md:
  folder0/b.md: '![](folder1/folder2/image.png)'
  folder0/folder1/folder2/image.png:
outputs:
  docs/folder/folder1/folder2/index.json:
  docs/136a42ac/folder/folder1/folder2/a.json: 
  docs/4667fedf/folder/folder1/folder2/a.json: 
  docs/folder/folder1/folder2/toc.json:
  docs/folder/b.json: |
    {"conceptual": "<p><img src=\"folder1/folder2/image.png\" alt=\"\" data-linktype=\"relative-path\"></p>"}
  docs/folder/folder1/folder2/image.png:
  .errors.log: |
    {"message_severity":"suggestion","code":"path-too-deep","message":"Article URL '/docs/folder/folder1/folder2/' is '5' levels deep. For SEO, URLs should be '4' levels or fewer.","file":"folder0/folder1/folder2/index.md"}
    {"message_severity":"suggestion","code":"path-too-deep","message":"Article URL '/docs/folder/folder1/folder2/a' is '5' levels deep. For SEO, URLs should be '4' levels or fewer.","file":"v1/folder1/folder2/a.md"}
    {"message_severity":"suggestion","code":"path-too-deep","message":"Article URL '/docs/folder/folder1/folder2/a' is '5' levels deep. For SEO, URLs should be '4' levels or fewer.","file":"v2/folder1/folder2/a.md"}
---
# Content validation - Publish Url - segment uniqueness
# Validation is only worked in the conceptual page
inputs:
  docfx.yml: |
    monikerRange:
      'v1/**': '< netcore-2.0'
      'v2/**': '>= netcore-2.0'
    markdownValidationRules: rules.json
    basePath: /docs
    routes:
      v1/: folder/
      v2/: folder/
      folder0/: folder/
    monikerDefinition: monikerDefinition.json
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
      ]
    }
  redirections.yml: |
    redirections:
      folder0/duplicatedword/duplicatedword/c.md: "docs/folder/folder1/c"
  rules.json: |
    {
      "publishurls": {
        "name": "PublishUrls",
        "description": "Validates publish urls",
        "aliases": null,
        "rules": [
          {
            "type": "SegmentUnique",
            "message": "Article URL '{0}' contains duplicated text '{1}'. For SEO, article URLs should not contain duplication.",
            "code": "path-duplication",
            "severity": "SUGGESTION",
            "exclusions": [
              "inclusion",
              "landingpage",
              "hubpage",
              "toc",
              "redirection"
            ],
            "excludedDocfxVersions": [
              "v2"
            ]
          }
        ]
      }
    }
  folder0/duplicatedword/duplicatedword/index.md: '![](./image.png)'
  v1/duplicatedword/folder1/DuplicatedWord.md: |
    Moniker: netcore-1.0
  v2/duplicatedword/folder1/DuplicatedWord.md: |
    Moniker: netcore-2.0
  folder0/duplicatedword/duplicatedword/TOC.md:
  folder0/duplicatedword/duplicatedword/image.png:
  folder0/duplicated-base-path/docs/a.md:
outputs:
  docs/folder/duplicatedword/duplicatedword/index.json:
  docs/136a42ac/folder/duplicatedword/folder1/duplicatedword.json: 
  docs/4667fedf/folder/duplicatedword/folder1/duplicatedword.json: 
  docs/folder/duplicatedword/duplicatedword/toc.json:
  docs/folder/duplicatedword/duplicatedword/image.png:
  docs/folder/duplicated-base-path/docs/a.json:
  .errors.log: |
    {"message_severity":"suggestion","code":"path-duplication","message":"Article URL '/docs/folder/duplicatedword/duplicatedword/' contains duplicated text 'duplicatedword'. For SEO, article URLs should not contain duplication.","file":"folder0/duplicatedword/duplicatedword/index.md"}
    {"message_severity":"suggestion","code":"path-duplication","message":"Article URL '/docs/folder/duplicatedword/folder1/duplicatedword' contains duplicated text 'duplicatedword'. For SEO, article URLs should not contain duplication.","file":"v1/duplicatedword/folder1/DuplicatedWord.md"}
    {"message_severity":"suggestion","code":"path-duplication","message":"Article URL '/docs/folder/duplicatedword/folder1/duplicatedword' contains duplicated text 'duplicatedword'. For SEO, article URLs should not contain duplication.","file":"v2/duplicatedword/folder1/DuplicatedWord.md"}
    {"message_severity":"suggestion","code":"path-duplication","message":"Article URL '/docs/folder/duplicated-base-path/docs/a' contains duplicated text 'docs'. For SEO, article URLs should not contain duplication.","file":"folder0/duplicated-base-path/docs/a.md"}
---
# Validate user html
inputs:
  docfx.yml:
  a.md: |
    <H2 id="head" TITLE="HEAD"></H2>
    <BUTTON>click</BUTTON>
    <img height="docs"></img>
    <h1 height="docs"></h1>
    <div onclick="alert();" data-source="docs"></div>
outputs:
  a.json:
  .errors.log: |
    {"message_severity":"info","code":"disallowed-html","message":"HTML tag 'H2' isn't allowed. Disallowed HTML poses a security risk and must be replaced with approved Docs Markdown syntax.","file":"a.md","line":1,"column":2}
    {"message_severity":"info","code":"disallowed-html","message":"HTML tag 'BUTTON' isn't allowed. Disallowed HTML poses a security risk and must be replaced with approved Docs Markdown syntax.","file":"a.md","line":2,"column":2}
    {"message_severity":"info","code":"disallowed-html","message":"HTML tag 'h1' isn't allowed. Disallowed HTML poses a security risk and must be replaced with approved Docs Markdown syntax.","file":"a.md","line":4,"column":2}
    {"message_severity":"info","code":"disallowed-html","message":"HTML attribute 'onclick' on tag 'div' isn't allowed. Disallowed HTML poses a security risk and must be replaced with approved Docs Markdown syntax.","file":"a.md","line":5,"column":6}
---
# Content Validation - Setex Headings
inputs:
  docfx.yml: |
    markdownValidationRules: rules.json
    exclude: b.md
  rules.json: |
    {
      "headings": {
        "name": "Headings",
        "description": "Validates H1 and other heading content",
        "aliases": null,
        "rules": [
          {
            "type": "SetexHeadings",
            "message": "Bad {0} format. Use hashes to create H1(#) or H2(##)",
            "code": "headings-with-underline",
            "severity": "SUGGESTION",
            "exclusions": [
              "landingPage",
              "hubPage",
              "toc"
            ],
            "excludedDocfxVersions": [
              "v2"
            ]
          }
        ]
      }
    }
  a.md: |
    # Title 1 With Hashe
    ## Title 2 With Hashes

    Title 1
    =======

    Title 2
    -------

    Multiple Title2 Line 1
    Multiple Title2 Line 2
    -------

    # Title With Hash and underline
    ======

        Not A title 1
    ======

    Not A Title 2
        ------

    [!include[](b.md)]
  b.md: |
    Title 2
    ------
outputs:
  a.json:
  .errors.log: |
    {"message_severity":"suggestion","log_item_type":"user","code":"headings-with-underline","message":"Bad H1 'Title 1' format. Use hashes to create H1(#) or H2(##)","file":"a.md","line":5,"end_line":5,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"headings-with-underline","message":"Bad H2 'Title 2' format. Use hashes to create H1(#) or H2(##)","file":"a.md","line":8,"end_line":8,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"headings-with-underline","message":"Bad H2 'Multiple Title2 Line 1\nMultiple Title2 Line 2' format. Use hashes to create H1(#) or H2(##)","file":"a.md","line":12,"end_line":12,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"headings-with-underline","message":"Bad H2 'Title 2' format. Use hashes to create H1(#) or H2(##)","file":"b.md","line":2,"end_line":2,"column":1,"end_column":1}
---
# Content Validation - Skip Level
inputs:
  docfx.yml: |
    markdownValidationRules: rules.json
    exclude:
      - b.md
      - c.md
      - d.md
      - e.md
      - f.md
  rules.json: |
    {
      "headings": {
        "name": "Headings",
        "description": "Validates H1 and other heading content",
        "aliases": null,
        "rules": [
          {
            "type": "SkipLevel",
            "message": "Skipped heading: {0} followed by heading: {1}. Headings must increment with no skipped levels",
            "code": "heading-skipped",
            "severity": "SUGGESTION",
            "exclusions": [
              "includes",
              "landingPage",
              "hubPage",
              "toc"
            ],
            "excludedDocfxVersions": [
              "v2"
            ]
          }
        ]
      }
    }
  a.md: |
    # Title 1-1
    ### Title 3

    # Title 1-2
    [!include[](b.md)]

    [!include[](b.md)]
    ##### Title 5

    [!include[](b.md)]
    [!include[](c.md)]

    [!include[](d.md)]

    [!include[](e.md)]

    [!include[](f.md)]
    ## Title 2
  normal-1.md: |
    # Title 1-3
    ## Title 2
    ### Title 3
    # Title 1-4
  normal-2.md: |
    ### Title 3
    # Title 1-4
  b.md: |
    ### Title 3-b
  c.md: |
    ##### Title 5-c
  d.md: |
    ### Title 3-d
    ##### Title 5-d
  e.md: |
    [!include[](b.md)]
    [!include[](c.md)]

    [!include[](d.md)]
  f.md:
outputs:
  a.json:
  normal-1.json:
  normal-2.json:
  .errors.log: |
    {"message_severity":"suggestion","log_item_type":"user","code":"heading-skipped","message":"Skipped heading: H1 'Title 1-1' followed by heading: H3 'Title 3'. Headings must increment with no skipped levels","file":"a.md","line":2,"end_line":2,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"heading-skipped","message":"Skipped heading: H1 'Title 1-2' followed by heading: H3 'Title 3-b'(a.md(5,1) -> b.md). Headings must increment with no skipped levels","file":"a.md","line":5,"end_line":5,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"heading-skipped","message":"Skipped heading: H3 'Title 3-b'(a.md(7,1) -> b.md) followed by heading: H5 'Title 5'. Headings must increment with no skipped levels","file":"a.md","line":8,"end_line":8,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"heading-skipped","message":"Skipped heading: H3 'Title 3-b'(a.md(10,1) -> b.md) followed by heading: H5 'Title 5-c'(a.md(11,1) -> c.md). Headings must increment with no skipped levels","file":"a.md","line":11,"end_line":11,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"heading-skipped","message":"Skipped heading: H3 'Title 3-d'(a.md(13,1) -> d.md) followed by heading: H5 'Title 5-d'(a.md(13,1) -> d.md(2,1)). Headings must increment with no skipped levels","file":"d.md","line":2,"end_line":2,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"heading-skipped","message":"Skipped heading: H3 'Title 3-b'(a.md(15,1) -> e.md -> b.md) followed by heading: H5 'Title 5-c'(a.md(15,1) -> e.md(2,1) -> c.md). Headings must increment with no skipped levels","file":"e.md","line":2,"end_line":2,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"heading-skipped","message":"Skipped heading: H3 'Title 3-d'(a.md(15,1) -> e.md(4,1) -> d.md) followed by heading: H5 'Title 5-d'(a.md(15,1) -> e.md(4,1) -> d.md(2,1)). Headings must increment with no skipped levels","file":"d.md","line":2,"end_line":2,"column":1,"end_column":1}
---
# Content validation - h1 in inclusion
inputs:
  docfx.yml: |
    markdownValidationRules: rules.json
    exclude:
      - b.md
      - c.md
  rules.json: |
    {
      "headings": {
        "name": "Headings",
        "description": "Validates H1 and other heading content",
        "aliases": null,
        "rules": [
          {
            "type": "InclusionH1",
            "message": "H1 headings aren't allowed in included files. Every parent file should have an H1.",
            "code": "h1-in-include",
            "severity": "SUGGESTION",
            "exclusions": [
              "landingPage",
              "hubPage",
              "toc"
            ],
            "excludedDocfxVersions": [
              "v2"
            ]
          }
        ]
      }
    }
  a.md: |
    # H1 -a
    [!include[](b.md)]
  b.md: |
    # H1 -b
    [!include[](c.md)]
  c.md: |
    # H1 -c
    ------
outputs:
  a.json:
  .errors.log: |
    {"message_severity":"suggestion","log_item_type":"user","code":"h1-in-include","message":"H1 headings aren't allowed in included files. Every parent file should have an H1.","file":"b.md","line":1,"end_line":1,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"h1-in-include","message":"H1 headings aren't allowed in included files. Every parent file should have an H1.","file":"c.md","line":1,"end_line":1,"column":1,"end_column":1}
---
# Content Validation - EmptyHeadings
inputs:
  docfx.yml: |
    markdownValidationRules: rules.json
    exclude: b.md
  rules.json: |
    {
      "headings": {
        "name": "Headings",
        "description": "Validates H1 and other heading content",
        "aliases": null,
        "rules": [
          {
            "type": "HeadingEmpty",
            "message": "Empty {0}. Headings must have content.",
            "code": "heading-empty",
            "severity": "SUGGESTION",
            "exclusions": [
              "landingpage",
              "hubpage",
              "toc"
            ],
            "excludedDocfxVersions": [
              "v2"
            ]
          }
        ]
      }
    }
  a.md: |
    Empty headings
    ## 
    ###
    #### <!-- comments -->
    #####            
    Ignore empty h1
    # 
    Headings below are not empty.
    ##### <img src="image.png" alt="xxx"/>
    ###### &nbsp;
    ###### &#160;
    ###### <a href="image.png"></a>
    ###### <a href="image.png"> &nbsp; </a>
    ###### <div><a href="image.png"> &nbsp; </a><div>
    ###### <span>abc</span>
    ###### <a href="image.png">abc</a>
    [!include[](b.md)]
  b.md: |
    ## 
  image.png:
outputs:
  a.json:
  image.png:
  .errors.log: |
    {"message_severity":"suggestion","log_item_type":"user","code":"heading-empty","message":"Empty H2. Headings must have content.","file":"a.md","line":2,"end_line":2,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"heading-empty","message":"Empty H3. Headings must have content.","file":"a.md","line":3,"end_line":3,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"heading-empty","message":"Empty H4 '<!-- comments -->'. Headings must have content.","file":"a.md","line":4,"end_line":4,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"heading-empty","message":"Empty H5. Headings must have content.","file":"a.md","line":5,"end_line":5,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"heading-empty","message":"Empty H2. Headings must have content.","file":"b.md","line":1,"end_line":1,"column":1,"end_column":1}
---
# Content validation - no content between headings
inputs:
  docfx.yml: |
    markdownValidationRules: rules.json
    exclude:
      - b.md
      - c.md
  rules.json: |
    {
      "headings": {
        "name": "Headings",
        "description": "Validates H1 and other heading content",
        "aliases": null,
        "rules": [
          {
            "type": "NoContent",
            "message": "{0} contains no content. Add content or remove the unused heading.",
            "code": "heading-no-content",
            "severity": "SUGGESTION",
            "exclusions": [
              "includes",
              "landingpage",
              "hubpage",
              "toc"
            ],
            "excludedDocfxVersions": [
              "v2"
            ]
          }
        ]
      }
    }
  a.md: |
    # H1 -a
    ## H2-1 -a
          
                
    ## H2-2 -a
    some content
    ### H3 -a
    <!-- comments -->

    [!include[](b.md)]
    #### H4 -a

  b.md: |
    ### H3-1 -b
    ### H3-2 -b
    [!include[](c.md)]
    ### H3-3 -b
    [!include[](c.md)]
    ## H2 -b
    [!include[](c.md)]
    abc
  c.md: |
    some content
    ## H2 -c
    ------
outputs:
  a.json:
  .errors.log: |
    {"message_severity":"suggestion","log_item_type":"user","code":"heading-no-content","message":"H2 'H2-1 -a' contains no content. Add content or remove the unused heading.","file":"a.md","line":2,"end_line":2,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"heading-no-content","message":"H3 'H3 -a' contains no content. Add content or remove the unused heading.","file":"a.md","line":7,"end_line":7,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"heading-no-content","message":"H3 'H3-1 -b'(a.md(10,1) -> b.md) contains no content. Add content or remove the unused heading.","file":"b.md","line":1,"end_line":1,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"heading-no-content","message":"H2 'H2 -c'(a.md(10,1) -> b.md(5,1) -> c.md(2,1)) contains no content. Add content or remove the unused heading.","file":"c.md","line":2,"end_line":2,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"heading-no-content","message":"H4 'H4 -a' contains no content. Add content or remove the unused heading.","file":"a.md","line":11, "end_line":11,"column":1,"end_column":1}
---
# Content validation - indented lines within triple-colon syntax is OK for code-block-indented
inputs:
  docfx.yml: |
    markdownValidationRules: rules.json
  rules.json: |
    {
      "codeBlocks": {
        "name": "CodeBlocks",
        "description": "Validates code block content",
        "aliases": null,
        "rules": [
          {
            "type": "CodeBlockIndented",
            "message": "Indented code blocks aren't allowed. Use a Markdown code block surrounded by triple colons.",
            "code": "code-block-indented",
            "severity": "SUGGESTION",
            "exclusions": [
              "toc"
            ],
            "excludedDocfxVersions": [
              "v2"
            ]
          }
        ]
      }
    }
  a.md: |
    :::image type="complex" source="image.png" alt-text="triple-colon test":::
         intented line
    :::image-end:::

         intented line2
outputs:
  a.json:
  .errors.log: |
    {"message_severity":"warning","log_item_type":"user","code":"file-not-found","message":"Invalid file link: 'image.png'.","file":"a.md","line":1,"end_line":1,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"code-block-indented","message":"Indented code blocks aren't allowed. Use a Markdown code block surrounded by triple colons.","file":"a.md","line":5,"end_line":5,"column":0,"end_column":0}
---
#Content validation - h1-not-first in docs zone
inputs:
  docfx.yml: |
    markdownValidationRules: rules.json
  rules.json: |
    {
      "headings": {
        "name": "Headings",
        "description": "Validates H1 and other heading content",
        "aliases": null,
        "rules": [
          {
            "type": "H1NotFirst",
            "message": "Markdown content is not allowed before H1.",
            "code": "h1-not-first",
            "severity": "WARNING",
            "exclusions": [
              "includes",
              "landingpage",
              "hubpage"
            ],
            "excludedDocfxVersions": [
              "v2"
            ]
          }
        ]
      }
    }
  a.md: |
    ::: zone target="docs"
    # Tutorial: Copy data to Azure Data Box via SMB
    ::: zone-end

    ::: zone target = "chromeless"
    # Copy data to Azure Data Box
    ::: zone-end
  b.md: |
    ::: zone target="chromeless"
    # Copy data to Azure Data Box
    ::: zone-end

    ::: zone target = "docs"
    # Tutorial: Copy data to Azure Data Box via SMB
    ::: zone-end
  c.md: |
    ::: zone target="chromeless"
    # Copy data to Azure Data Box
    ::: zone-end

    This is paragraph

    ::: zone target = "docs"
    # Tutorial: Copy data to Azure Data Box via SMB
    ::: zone-end
  d.md: |
    ## This is H2

    ::: zone target = "docs"
    # Tutorial: Copy data to Azure Data Box via SMB
    ::: zone-end

    ::: zone target = "chromeless"
    # Copy data to Azure Data Box
    ::: zone-end
  e.md: |
    # This is H1

    ::: zone target = "docs"
    # Tutorial: Copy data to Azure Data Box via SMB
    ::: zone-end

    ::: zone target = "chromeless"
    # Copy data to Azure Data Box
    ::: zone-end
  f.md: |
    ::: zone target = "docs"
    This is paragraph
    # Tutorial: Copy data to Azure Data Box via SMB
    ::: zone-end
  g.md: |
    ::: zone target = "chromeless"
    This is paragraph
    # Tutorial: Copy data to Azure Data Box via SMB
    ::: zone-end
  h.md: |
    ::: image type="complex" source="../media/buttonElementWithRenderers.png" alt-text="test":::
        Indented line withon triple-colon syntax
    ::: image-end:::
  i.md: |
    ::: zone
    # Tutorial: Copy data to Azure Data Box via SMB
    ::: zone-end
  j.md: |
    ::: zone pivot = "test"
    # Tutorial: Copy data to Azure Data Box via SMB
    ::: zone-end
outputs:
  a.json:
  b.json:
  c.json:
  d.json:
  e.json:
  f.json:
  g.json:
  h.json:
  j.json:
  .errors.log: |
    {"message_severity":"error","log_item_type":"user","code":"invalid-zone","message":"Either target or privot must be specified.","file":"i.md","line":1,"end_line":1,"column":1,"end_column":1}
    {"message_severity":"warning","log_item_type":"user","code":"h1-not-first","message":"Markdown content is not allowed before H1.","file":"i.md","line":0,"end_line":0,"column":0,"end_column":0}
    {"message_severity":"warning","log_item_type":"user","code":"h1-not-first","message":"Markdown content is not allowed before H1.","file":"d.md","line":0,"end_line":0,"column":0,"end_column":0}
    {"message_severity":"warning","log_item_type":"user","code":"h1-not-first","message":"Markdown content is not allowed before H1.","file":"f.md","line":0,"end_line":0,"column":0,"end_column":0}
    {"message_severity":"warning","log_item_type":"user","code":"file-not-found","message":"Invalid file link: '../media/buttonElementWithRenderers.png'.","file":"h.md","line":1,"end_line":1,"column":1,"end_column":1}
    {"message_severity":"warning","log_item_type":"user","code":"h1-not-first","message":"Markdown content is not allowed before H1.","file":"h.md","line":0,"end_line":0,"column":0,"end_column":0}
    {"message_severity":"warning","log_item_type":"user","code":"h1-not-first","message":"Markdown content is not allowed before H1.","file":"c.md","line":4,"end_line":4,"column":0,"end_column":0}
---
#Content validation - h1-missing in docs zone
inputs:
  docfx.yml: |
    markdownValidationRules: rules.json
  rules.json: |
    {
      "headings": {
        "name": "Headings",
        "description": "Validates H1 and other heading content",
        "aliases": null,
        "rules": [
          {
            "type": "H1Missing",
            "message": "H1 is required. Use a single hash (#) followed by a space to create your top-level heading",
            "code": "h1-missing",
            "severity": "SUGGESTION",
            "exclusions": [
              "includes",
              "landingpage",
              "hubpage",
              "toc"
            ],
            "excludedDocfxVersions": [
              "v2"
            ]
          }
        ]
      }
    }
  a.md: |
    ::: zone target="docs"
    # H1 heading text\r\n
    ::: zone-end
  b.md: |
    ::: zone target="docs"
    #H1heading
    ::: zone-end
  c.md: |
    ::: zone target="docs"
    ::: zone-end
  d.md: |
    ::: zone
    # H1heading
    ::: zone-end
  e.md: |
    ::: zone target="chromeless"
    # H1 heading text
    ::: zone-end
outputs:
  a.json:
  b.json:
  c.json:
  e.json:
  .errors.log: |
    {"message_severity":"error","log_item_type":"user","code":"invalid-zone","message":"Either target or privot must be specified.","file":"d.md","line":1,"end_line":1,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"h1-missing","message":"H1 is required. Use a single hash (#) followed by a space to create your top-level heading","file":"c.md","line":1,"end_line":1,"column":0,"end_column":0}
    {"message_severity":"suggestion","log_item_type":"user","code":"h1-missing","message":"H1 is required. Use a single hash (#) followed by a space to create your top-level heading","file":"e.md","line":1,"end_line":1,"column":0,"end_column":0}
---
#Content validation - h1 in zone
inputs:
  docfx.yml: |
    markdownValidationRules: rules.json
  rules.json: |
    {
      "headings": {
        "name": "Headings",
        "description": "Validates H1 and other heading content",
        "aliases": null,
        "rules": [
          {
            "type": "H1InZone",
            "message": "H1 in zone '{0}'. H1 is only allowed in Docs zones.",
            "code": "h1-in-zone",
            "severity": "SUGGESTION",
            "exclusions": [
              "includes",
              "landingpage",
              "hubpage",
              "toc"
            ],
            "excludedDocfxVersions": [
              "v2"
            ]
          }
        ]
      }
    }
  a.md: |
    ::: zone target= "docs"
    # Tutorial: Copy data to Azure Data Box via SMB
    ::: zone-end

    ::: zone target = "chromeless"
    # Copy data to Azure Data Box
    ::: zone-end

    ::: zone target = "pdf"
    # Copy data to Azure Data Box
    ::: zone-end

    ::: zone pivot = "test"
    # Copy data to Azure Data Box
    ::: zone-end

    ::: zone target = "docs"
    #Tutorial: Copy data to Azure Data Box via SMB
    ::: zone-end

    ::: zone target = "chromeless"
    #Copy data to Azure Data Box
    ::: zone-end

    ::: zone target = "chromeless"
    ::: zone-end

    ::: zone target = "chromeless"
    ## This is h2
    ::: zone-end

    ::: zone target = "chromeless"
    # This is h1
    #This is h1
    ::: zone-end
outputs:
  a.json:
  .errors.log: |
    {"message_severity":"suggestion","log_item_type":"user","code":"h1-in-zone","message":"H1 in zone 'target=chromeless'. H1 is only allowed in Docs zones.","file":"a.md","line":6,"end_line":6,"column":0,"end_column":0}
    {"message_severity":"suggestion","log_item_type":"user","code":"h1-in-zone","message":"H1 in zone 'target=pdf'. H1 is only allowed in Docs zones.","file":"a.md","line":10,"end_line":10,"column":0,"end_column":0}
    {"message_severity":"suggestion","log_item_type":"user","code":"h1-in-zone","message":"H1 in zone 'pivot'. H1 is only allowed in Docs zones.","file":"a.md","line":14,"end_line":14,"column":0,"end_column":0}
    {"message_severity":"suggestion","log_item_type":"user","code":"h1-in-zone","message":"H1 in zone 'target=chromeless'. H1 is only allowed in Docs zones.","file":"a.md","line":22,"end_line":22,"column":0,"end_column":0}
    {"message_severity":"suggestion","log_item_type":"user","code":"h1-in-zone","message":"H1 in zone 'target=chromeless'. H1 is only allowed in Docs zones.","file":"a.md","line":33,"end_line":33,"column":0,"end_column":0}
    {"message_severity":"suggestion","log_item_type":"user","code":"h1-in-zone","message":"H1 in zone 'target=chromeless'. H1 is only allowed in Docs zones.","file":"a.md","line":34,"end_line":34,"column":0,"end_column":0}
---
#Content validation - multiple-h1s in docs zone
inputs:
  docfx.yml: |
    markdownValidationRules: rules.json
  rules.json: |
    {
      "headings": {
        "name": "Headings",
        "description": "Validates H1 and other heading content",
        "aliases": null,
        "rules": [
          {
            "type": "H1Multiples",
            "message": "Multiple H1s are not allowed. You can only have one top-level heading",
            "code": "multiple-h1s",
            "severity": "SUGGESTION",
            "exclusions": [
              "includes",
              "landingpage",
              "hubpage",
              "toc"
            ],
            "excludedDocfxVersions": [
              "v2"
            ]
          }
        ]
      }
    }
  a.md: |
    a.md: |
    ::: zone target="docs"
    # H1 heading text
    ::: zone-end
  b.md: |
    ::: zone target="docs"
    # H1 heading text
    #H1 heading text dup
    ::: zone-end
  c.md: |
    ::: zone target="chromeless"
    # H1 heading text
    #H1 heading dup
    ::: zone-end
  d.md: |
    ::: zone pivot = "test"
    # H1 Heading text
    # H1 heading text 2
    ::: zone-end
  e.md: |
    ::: zone target="docs"
    # H1 heading text
    # H1 heading dup
    ::: zone-end
  f.md: |
    ::: zone target="docs"
    # H1 heading text
    ::: zone-end
    ::: zone target="chromeless"
    # H1 heading text
    ::: zone-end
  g.md: |
    # H1 heading
    ::: zone target="docs"
    # H1 heading text
    ::: zone-end
  h.md: |
    #H1 heading
    ::: zone target="docs"
    # H1 heading text
    ::: zone-end
  i.md: |
    # H1 heading
    ::: zone target="chromeless"
    # H1 heading text
    ::: zone-end
  j.md: |
    # H1 heading
    ::: zone pivot="test"
    # H1 heading text
    ::: zone-end
outputs:
  a.json:
  b.json:
  c.json:
  d.json:
  e.json:
  f.json:
  g.json:
  h.json:
  i.json:
  j.json:
  .errors.log: |
    {"message_severity":"suggestion","log_item_type":"user","code":"multiple-h1s","message":"Multiple H1s are not allowed. You can only have one top-level heading","file":"b.md","line":3,"end_line":3,"column":0,"end_column":0}
    {"message_severity":"suggestion","log_item_type":"user","code":"multiple-h1s","message":"Multiple H1s are not allowed. You can only have one top-level heading","file":"h.md","line":3,"end_line":3,"column":0,"end_column":0}
    {"message_severity":"suggestion","log_item_type":"user","code":"multiple-h1s","message":"Multiple H1s are not allowed. You can only have one top-level heading","file":"g.md","line":3,"end_line":3,"column":0,"end_column":0}
    {"message_severity":"suggestion","log_item_type":"user","code":"multiple-h1s","message":"Multiple H1s are not allowed. You can only have one top-level heading","file":"e.md","line":3,"end_line":3,"column":0,"end_column":0}
---
# Canonial Version Only H1 Unique Check
inputs:
  docfx.yml: |
    markdownValidationRules: rules.json
    monikerRange:
      'docs/v1/**': '>= netcore-1.0 <= netcore-1.2'
    routes:
      docs/v1/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    ::: moniker range="<= netcore-1.1"
    # h1
    ::: moniker-end
    ::: moniker range="<= netcore-1.2"
    # h1
    ::: moniker-end
  docs/v1/b.md: |
    # h1
    ::: moniker range="<= netcore-1.2"
    # h1
    ::: moniker-end
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.2", "product_name": ".NET Core" },
      ]
    }
  rules.json: |
    {
      "headings": {
        "name": "Headings",
        "description": "Validates H1 and other heading content",
        "aliases": null,
        "rules": [
          {
            "type": "H1Unique",
            "message": "H1 '{0}' is duplicated with other articles: '{1}'",
            "code": "duplicate-h1",
            "severity": "SUGGESTION",
            "exclusions": [
              "includes",
              "landingPage",
              "hubPage",
              "toc"
            ],
            "excludedDocfxVersions": [
              "v2"
            ],
            "canonicalVersionOnly": true
          }
        ]
      }
    }
outputs:
  .errors.log: |
    {"message_severity":"suggestion","log_item_type":"user","code":"duplicate-h1","message":"H1 'h1' is duplicated with other articles: 'docs/v1/a.md(5,1), docs/v1/b.md, docs/v1/b.md(3,1)'","file":"docs/v1/a.md","line":5,"end_line":5,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"duplicate-h1","message":"H1 'h1' is duplicated with other articles: 'docs/v1/a.md(5,1), docs/v1/b.md, docs/v1/b.md(3,1)'","file":"docs/v1/b.md","line":3,"end_line":3,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"duplicate-h1","message":"H1 'h1' is duplicated with other articles: 'docs/v1/a.md(5,1), docs/v1/b.md, docs/v1/b.md(3,1)'","file":"docs/v1/b.md","line":1,"end_line":1,"column":1,"end_column":1}
  2420f88b/docs/a.json:
  2420f88b/docs/b.json:
---
# Canonial Version Only H1 Unique Check with Inclusion
inputs:
  docfx.yml: |
    exclude:
      - docs/v1/token1.md
      - docs/v1/token2.md
    markdownValidationRules: rules.json
    monikerRange:
      'docs/v1/**': '>= netcore-1.0 <= netcore-1.2'
    routes:
      docs/v1/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    [!include[](token2.md)]
  docs/v1/b.md: |
    # h1
    ::: moniker range="<= netcore-1.2"
    [!include[](token1.md)]
    ::: moniker-end
    ::: moniker range="<= netcore-1.1"
    [!include[](token1.md)]
    ::: moniker-end
  docs/v1/token1.md: |
    # h1
  docs/v1/token2.md: |
    ::: moniker range="<= netcore-1.1"
    # h1
    ::: moniker-end
    ::: moniker range="<= netcore-1.2"
    # h1
    ::: moniker-end
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.2", "product_name": ".NET Core" },
      ]
    }
  rules.json: |
    {
      "headings": {
        "name": "Headings",
        "description": "Validates H1 and other heading content",
        "aliases": null,
        "rules": [
          {
            "type": "H1Unique",
            "message": "H1 '{0}' is duplicated with other articles: '{1}'",
            "code": "duplicate-h1",
            "severity": "SUGGESTION",
            "exclusions": [
              "includes",
              "landingPage",
              "hubPage",
              "toc"
            ],
            "excludedDocfxVersions": [
              "v2"
            ],
            "canonicalVersionOnly": true
          }
        ]
      }
    }
outputs:
  .errors.log: |
    {"message_severity":"suggestion","log_item_type":"user","code":"duplicate-h1","message":"H1 'h1' is duplicated with other articles: 'docs/v1/b.md, docs/v1/token1.md, docs/v1/token2.md(5,1)'","file":"docs/v1/token1.md","line":1,"end_line":1,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"duplicate-h1","message":"H1 'h1' is duplicated with other articles: 'docs/v1/b.md, docs/v1/token1.md, docs/v1/token2.md(5,1)'","file":"docs/v1/b.md","line":1,"end_line":1,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"duplicate-h1","message":"H1 'h1' is duplicated with other articles: 'docs/v1/b.md, docs/v1/token1.md, docs/v1/token2.md(5,1)'","file":"docs/v1/token2.md","line":5,"end_line":5,"column":1,"end_column":1}
  2420f88b/docs/a.json:
  2420f88b/docs/b.json:
---
# Canonial Version Only H1 Unique Check with Inclusion
# multiple-versioning file cases
# invalid moniker zone is treated as non-versioning
inputs:
  docfx.yml: |
    exclude:
      - docs/v1/token1.md
      - docs/v1/token2.md
      - docs/v1/token3.md
    markdownValidationRules: rules.json
    monikerRange:
      'docs/v1/**': '< netcore-1.2'
      'docs/v2/**': '>= netcore-1.2'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
  docs/v1/a.md: |
    [!include[](token2.md)]
  docs/v1/b.md: |
    # h1
    ::: moniker range="<= netcore-1.2"
    [!include[](token1.md)]
    ::: moniker-end
    ::: moniker range="< netcore-1.1"
    [!include[](token1.md)]
    ::: moniker-end
  docs/v2/b.md: |
    # h1
    ::: moniker range="<= netcore-2.0"
    [!include[](../v1/token1.md)]
    ::: moniker-end
    ::: moniker range="<= netcore-1.2"
    [!include[](../v1/token1.md)]
    ::: moniker-end
    [!include[](../v1/token3.md)]
  docs/v1/token1.md: |
    # h1
  docs/v1/token2.md: |
    ::: moniker range="< netcore-1.1"
    # h1
    ::: moniker-end
    ::: moniker range="<= netcore-1.2"
    # h1
    ::: moniker-end
  docs/v1/token3.md: |
    ::: moniker range="< netcore-1.1"
    # h1
    ::: moniker-end
    ::: moniker range="<= netcore-1.2"
    # h1
    ::: moniker-end
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.2", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
      ]
    }
  rules.json: |
    {
      "headings": {
        "name": "Headings",
        "description": "Validates H1 and other heading content",
        "aliases": null,
        "rules": [
          {
            "type": "H1Unique",
            "message": "H1 '{0}' is duplicated with other articles: '{1}'",
            "code": "duplicate-h1",
            "severity": "SUGGESTION",
            "exclusions": [
              "includes",
              "landingPage",
              "hubPage",
              "toc"
            ],
            "excludedDocfxVersions": [
              "v2"
            ],
            "canonicalVersionOnly": true
          }
        ]
      }
    }
outputs:
  .errors.log: |
    {"message_severity":"suggestion","log_item_type":"user","code":"duplicate-h1","message":"H1 'h1' is duplicated with other articles: 'docs/v1/token1.md, docs/v1/token2.md(5,1), docs/v2/b.md'","file":"docs/v1/token1.md","line":1,"end_line":1,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"duplicate-h1","message":"H1 'h1' is duplicated with other articles: 'docs/v1/token1.md, docs/v1/token2.md(5,1), docs/v2/b.md'","file":"docs/v2/b.md","line":1,"end_line":1,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"duplicate-h1","message":"H1 'h1' is duplicated with other articles: 'docs/v1/token1.md, docs/v1/token2.md(5,1), docs/v2/b.md'","file":"docs/v1/token2.md","line":5,"end_line":5,"column":1,"end_column":1}
    {"message_severity":"warning","log_item_type":"user","code":"moniker-zone-empty","message":"No intersection between zone and file level monikers. The result of zone level range string '< netcore-1.1' is 'netcore-1.0', while file level monikers is 'netcore-1.2', 'netcore-2.0'.","file":"docs/v1/token3.md","line":1,"end_line":1,"column":1,"end_column":1}
  9d4e15fd/docs/a.json:
  9d4e15fd/docs/b.json:
  976da3a9/docs/b.json:
---
# Canonial Version Only Metadata Validation
inputs:
  docfx.yml: |
    metadataSchema: schema.json
    monikerRange:
      'docs/v1/**': '< netcore-1.2'
      'docs/v2/**': '>= netcore-1.2'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
    globalMetadata:
      layout: conceptual
  docs/v1/a.md: |
    ---
    title: t
    description: a
    ---
  docs/v1/b.md: |
    ---
    title: t
    description: b
    ---
  docs/v2/b.md: |
    ---
    title: t
    description: c
    ---
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.2", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
      ]
    }
  schema.json: |
    {
      "docsetUnique": [ "title"],
      "properties": {
          "description": {
              "type": [
                "string",
                "null"
              ],
              "minLength": 2,
              "maxLength": 10
          },
          "title": {
              "type": [
                "string",
                "null"
              ],
              "minLength": 2,
              "maxLength": 10
          }
      },
      "customRules": {
          "title": {
              "duplicate-attribute": {
                  "severity": "suggestion",
                  "code": "duplicate-title-within-docset",
                  "canonicalVersionOnly": true,
                  "additionalMessage": "Title must be unique within a docset."
                },
                "string-length-invalid": {
                    "severity": "suggestion",
                    "code": "description-bad-length"
                  }
          },
          "description": {
              "string-length-invalid": {
                  "severity": "suggestion",
                  "code": "description-bad-length",
                  "canonicalVersionOnly": true
              }
          }
      },
    }
outputs:
  .errors.log: |
    {"message_severity":"suggestion","log_item_type":"user","code":"description-bad-length","message":"String 'title' is too short: 1 characters. Length should be >= 2.","file":"docs/v1/a.md","line":2,"end_line":2,"column":8,"end_column":9}
    {"message_severity":"suggestion","log_item_type":"user","code":"description-bad-length","message":"String 'title' is too short: 1 characters. Length should be >= 2.","file":"docs/v1/b.md","line":2,"end_line":2,"column":8,"end_column":9}
    {"message_severity":"suggestion","log_item_type":"user","code":"description-bad-length","message":"String 'title' is too short: 1 characters. Length should be >= 2.","file":"docs/v2/b.md","line":2,"end_line":2,"column":8,"end_column":9}
    {"message_severity":"suggestion","log_item_type":"user","code":"description-bad-length","message":"String 'description' is too short: 1 characters. Length should be >= 2.","file":"docs/v1/a.md","line":3,"end_line":3,"column":14,"end_column":15}
    {"message_severity":"suggestion","log_item_type":"user","code":"description-bad-length","message":"String 'description' is too short: 1 characters. Length should be >= 2.","file":"docs/v2/b.md","line":3,"end_line":3,"column":14,"end_column":15}
    {"message_severity":"suggestion","log_item_type":"user","code":"duplicate-title-within-docset","message":"Attribute 'title' with value 't' is duplicated in 'docs/v1/a.md(2,8)', 'docs/v2/b.md(2,8)'. Title must be unique within a docset.","file":"docs/v2/b.md","line":2,"end_line":2,"column":8,"end_column":9}
    {"message_severity":"suggestion","log_item_type":"user","code":"duplicate-title-within-docset","message":"Attribute 'title' with value 't' is duplicated in 'docs/v1/a.md(2,8)', 'docs/v2/b.md(2,8)'. Title must be unique within a docset.","file":"docs/v1/a.md","line":2,"end_line":2,"column":8,"end_column":9}
  9d4e15fd/docs/a.json:
  9d4e15fd/docs/b.json:
  976da3a9/docs/b.json:
---
# title unique check
inputs:
  docfx.yml: |
    markdownValidationRules: rules.json
    fileMetadata:
      titleSuffix:
        'a/*.md': Product A
        'b/*.md': Product B
  rules.json: |
    {
      "title": {
        "rules": [
          {
            "type": "TitleUnique",
            "message": "Title '{0}' is duplicated with other articles: '{1}'",
            "code": "duplicate-titles",
            "severity": "SUGGESTION",
            "exclusions": [
              "includes",
              "landingPage",
              "hubPage",
              "toc"
            ],
            "excludedDocfxVersions": [
              "v2"
            ]
          }
        ]
      }
    }
  a/a.md: |
    ---
    title: title 1
    ---
  a/b.md: |
    ---
    title: title 1
    ---
  a/c.md: |
    # title 1
  a/d.md: |
    ---
    title: title 2
    ---
    # title 1
  b/a.md: |
    ---
    title: title 1
    ---
  c.md: |
    ---
    title: title 1
    ---
  d.md: |
    # title 1
outputs:
  a/a.json:
  a/b.json:
  a/c.json:
  a/d.json:
  b/a.json:
  c.json:
  d.json:
  .errors.log: |
    {"message_severity":"suggestion","log_item_type":"user","code":"duplicate-titles","message":"Title 'title 1 - Product A' is duplicated with other articles: 'a/a.md(2,8), a/b.md(2,8), a/c.md'","file":"a/a.md","line":2,"end_line":2,"column":8,"end_column":15}
    {"message_severity":"suggestion","log_item_type":"user","code":"duplicate-titles","message":"Title 'title 1 - Product A' is duplicated with other articles: 'a/a.md(2,8), a/b.md(2,8), a/c.md'","file":"a/b.md","line":2,"end_line":2,"column":8,"end_column":15}
    {"message_severity":"suggestion","log_item_type":"user","code":"duplicate-titles","message":"Title 'title 1 - Product A' is duplicated with other articles: 'a/a.md(2,8), a/b.md(2,8), a/c.md'","file":"a/c.md","line":1,"end_line":1,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"duplicate-titles","message":"Title 'title 1' is duplicated with other articles: 'c.md(2,8), d.md'","file":"c.md","line":2,"end_line":2,"column":8,"end_column":15}
    {"message_severity":"suggestion","log_item_type":"user","code":"duplicate-titles","message":"Title 'title 1' is duplicated with other articles: 'c.md(2,8), d.md'","file":"d.md","line":1,"end_line":1,"column":1,"end_column":1}
---
# Canonial Version title unique check
inputs:
  docfx.yml: |
    markdownValidationRules: rules.json
    globalMetadata:
      titleSuffix: Product
    monikerRange:
      'docs/v1/**': '< netcore-1.2'
      'docs/v2/**': '>= netcore-1.2'
    routes:
      docs/v1/: docs/
      docs/v2/: docs/
    monikerDefinition: monikerDefinition.json
  monikerDefinition.json: |
    {
      "monikers": [
        { "moniker_name": "netcore-1.0", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.1", "product_name": ".NET Core" },
        { "moniker_name": "netcore-1.2", "product_name": ".NET Core" },
        { "moniker_name": "netcore-2.0", "product_name": ".NET Core" },
      ]
    }
  rules.json: |
    {
      "title": {
        "rules": [
          {
            "type": "TitleUnique",
            "message": "Title '{0}' is duplicated with other articles: '{1}'",
            "code": "duplicate-titles",
            "severity": "SUGGESTION",
            "canonicalVersionOnly" : true,
            "exclusions": [
              "includes",
              "landingPage",
              "hubPage",
              "toc"
            ],
            "excludedDocfxVersions": [
              "v2"
            ]
          }
        ]
      }
    }
  docs/v1/a.md: |
    ---
    title: title 1
    ---
  docs/v1/b.md: |
    ---
    title: title 1
    ---
  docs/v2/b.md: |
    ---
    title: title 1
    ---
  docs/v2/c.md: |
    ---
    title: title 1
    ---
outputs:
  976da3a9/docs/b.json:
  976da3a9/docs/c.json:
  9d4e15fd/docs/a.json:
  9d4e15fd/docs/b.json:
  .errors.log: |
    {"message_severity":"suggestion","log_item_type":"user","code":"duplicate-titles","message":"Title 'title 1 - Product' is duplicated with other articles: 'docs/v1/a.md(2,8), docs/v2/b.md(2,8), docs/v2/c.md(2,8)'","file":"docs/v2/b.md","line":2,"end_line":2,"column":8,"end_column":15}
    {"message_severity":"suggestion","log_item_type":"user","code":"duplicate-titles","message":"Title 'title 1 - Product' is duplicated with other articles: 'docs/v1/a.md(2,8), docs/v2/b.md(2,8), docs/v2/c.md(2,8)'","file":"docs/v2/c.md","line":2,"end_line":2,"column":8,"end_column":15}
    {"message_severity":"suggestion","log_item_type":"user","code":"duplicate-titles","message":"Title 'title 1 - Product' is duplicated with other articles: 'docs/v1/a.md(2,8), docs/v2/b.md(2,8), docs/v2/c.md(2,8)'","file":"docs/v1/a.md","line":2,"end_line":2,"column":8,"end_column":15}
---
# Content Validation - dup image alt text
inputs:
  docfx.yml: |
    markdownValidationRules: rules.json
  rules.json: |
    {
      "images": {
        "rules": [
          {
            "name": "Images",
            "type": "ImageAltTextDuplicated",
            "message": "Alt text '{0}' is duplicated. Within an article, alt text must be unique.",
            "code": "image-alt-text-duplicated",
            "severity": "SUGGESTION",
            "exclusions": [
              "includes",
              "landingPage",
              "hubPage",
              "toc"
            ],
            "excludedDocfxVersions": [
              "v2"
            ]
          }
        ]
      }
    }
  pig1.jpg:
  pig2.jpg:
  a.md: |
    :::image type="content" source="pig1.jpg" alt-text="test alt text":::

    :::image source="pig2.jpg" alt-text="test alt text":::

    :::image source="pig1.jpg" alt-text="unique alt text":::

    :::image type="complex" source="pig1.jpg" alt-text="test alt text1" loc-scope="azure"::: 
    text
    :::image-end:::

    :::image type="complex" source="pig2.jpg" alt-text="test alt text1" loc-scope="azure"::: 
    text
    :::image-end:::
outputs:
  a.json:
  pig1.jpg:
  pig2.jpg:
  .errors.log: |
    {"message_severity":"suggestion","log_item_type":"user","code":"image-alt-text-duplicated","message":"Alt text 'test alt text' is duplicated. Within an article, alt text must be unique.","file":"a.md","line":1,"end_line":1,"column":0,"end_column":0}
    {"message_severity":"suggestion","log_item_type":"user","code":"image-alt-text-duplicated","message":"Alt text 'test alt text' is duplicated. Within an article, alt text must be unique.","file":"a.md","line":3,"end_line":3,"column":0,"end_column":0}
    {"message_severity":"suggestion","log_item_type":"user","code":"image-alt-text-duplicated","message":"Alt text 'test alt text1' is duplicated. Within an article, alt text must be unique.","file":"a.md","line":7,"end_line":7,"column":0,"end_column":0}
    {"message_severity":"suggestion","log_item_type":"user","code":"image-alt-text-duplicated","message":"Alt text 'test alt text1' is duplicated. Within an article, alt text must be unique.","file":"a.md","line":11,"end_line":11,"column":0,"end_column":0}
---
# Hidden PR only validation rule result
inputs:
  docfx.yml: |
    markdownValidationRules: rules.json
    metadataSchema: schema.json
    customRules:
      h1-missing: warning
      heading-empty: warning
  schema.json: |
    {
      "required": ["title"],
      "properties": {
          "description": {
              "type": [
                "string",
                "null"
              ],
              "minLength": 2,
              "maxLength": 10
          },
          "title": {
              "type": [
                "string",
                "null"
              ],
              "minLength": 2,
              "maxLength": 10
          }
      },
      "customRules": {
          "title": {
              "string-length-invalid": {
                  "severity": "suggestion",
                  "code": "title-bad-length",
                  "pullRequestOnly": false
              },
              "missing-attribute": {
                  "severity": "suggestion",
                  "code": "title-missing",
                  "additionalMessage": "Add a title string to show in search engine results."
              },
          },
          "description": {
              "string-length-invalid": {
                  "severity": "suggestion",
                  "code": "description-bad-length",
                  "pullRequestOnly": true
              }
          }
      },
    }
  rules.json: |
    {
      "headings": {
        "rules": [
          {
            "type": "H1Missing",
            "message": "H1 is required. Use a single hash (#) followed by a space to create your top-level heading.",
            "exclusions": [ "toc", "includes", "hubpage", "landingpage" ],
            "severity": "SUGGESTION",
            "code": "h1-missing"
          },
          {
            "type": "H1NotFirst",
            "message": "Markdown content is not allowed before H1.",
            "code": "h1-not-first",
            "severity": "SUGGESTION",
            "exclusions": [ "includes", "landingpage", "hubpage" ],
            "excludedDocfxVersions": [
              "v2"
            ] ,
            "pullRequestOnly": false
          },
          {
            "type": "HeadingEmpty",
            "message": "Empty {0}. Headings must have content.",
            "code": "heading-empty",
            "severity": "SUGGESTION",
            "exclusions": [ "landingpage", "hubpage", "toc" ],
            "excludedDocfxVersions": [
              "v2"
            ],
            "pullRequestOnly": true
          },
          {
            "type": "NoContent",
            "message": "{0} contains no content. Add content or remove the unused heading.",
            "code": "heading-no-content",
            "severity": "SUGGESTION",
            "exclusions": [
              "includes",
              "landingpage",
              "hubpage",
              "toc"
            ],
            "excludedDocfxVersions": [
              "v2"
            ],
            "pullRequestOnly": true
          }
        ]
      }
    }
  a.md: |
    ---
    title: too long title
    description: too long description
    ---
  b.md: |
    Some thing
    # heading1
    ## 
outputs:
  a.json:
  b.json:
  .errors.log: |
    {"message_severity":"suggestion","log_item_type":"user","code":"title-missing","message":"Missing required attribute: 'title'. Add a title string to show in search engine results.","file":"b.md","line":1,"end_line":1,"column":1,"end_column":1}
    {"message_severity":"suggestion","log_item_type":"user","code":"description-bad-length","message":"String 'description' is too long: 20 characters. Length should be <= 10.","file":"a.md","line":3,"end_line":3,"column":14,"end_column":34,"pull_request_only":true}
    {"message_severity":"suggestion","log_item_type":"user","code":"title-bad-length","message":"String 'title' is too long: 14 characters. Length should be <= 10.","file":"a.md","line":2,"end_line":2,"column":8,"end_column":22}
    {"message_severity":"warning","log_item_type":"user","code":"h1-missing","message":"H1 is required. Use a single hash (#) followed by a space to create your top-level heading.","file":"a.md","line":7,"end_line":7,"column":0,"end_column":0}
    {"message_severity":"suggestion","log_item_type":"user","code":"h1-not-first","message":"Markdown content is not allowed before H1.","file":"b.md","line":0,"end_line":0,"column":0,"end_column":0}
    {"message_severity":"warning","log_item_type":"user","code":"heading-empty","message":"Empty H2. Headings must have content.","file":"b.md","line":3,"end_line":3,"column":1,"end_column":1,"pull_request_only":true}
    {"message_severity":"suggestion","log_item_type":"user","code":"heading-no-content","message":"H2 contains no content. Add content or remove the unused heading.","file":"b.md","line":3,"end_line":3,"column":1,"end_column":1,"pull_request_only":true}

