---
# Check git merge conflict marker
inputs:
  docfx.yml:
  docs/toc.md: |
    <<<<<<< HEAD
    foo
    =======
    bar
    >>>>>>> cb1abc6bd98cfc84317f8aa95a7662815417802d
  docs/a.md: |
    baz
    <<<<<<< HEAD
    foo
    =======
    bar
    >>>>>>> cb1abc6bd98cfc84317f8aa95a7662815417802d
outputs:
  .errors.log: |
    ["error","merge-conflict","File contains merge conflict","docs/toc.md",1,1]
    ["error","merge-conflict","File contains merge conflict","docs/a.md",2,1]
---
# Metadata value must be scalar or scalar array
inputs:
  docfx.yml: |
    globalMetadata:
      key1: {}
    fileMetadata:
      key2:
        '**/*':
          - a: 1
  a.md:
outputs:
  .errors.log: |
    ["error","invalid-metadata-type","Metadata 'key1' can only be a scalar value or string array","docfx.yml",2,9]
    ["error","invalid-metadata-type","Metadata 'key2' can only be a scalar value or string array","docfx.yml",6,7]
---
# Additional metadata validation from external JSON schema
inputs:
  docfx.yml: |
    metadataSchema: schema.json
    globalMetadata:
      key1: []
    fileMetadata:
      key2:
        '**/*': XNAGameStudio
  schema.json: |
    {
      "properties":{
        "key1": { "type": "string" },
        "key2": { "type": "string", "enum": ["VS", "MSDN"] },
        "key3": { "type": "integer" }
      }
    }
  a.md: |
    ---
    key3: net462
    ---
outputs:
  a.json: |
    {
      "key1": [],
      "key2": "XNAGameStudio",
      "key3": "net462"
    }
  .errors.log: |
    ["warning","unexpected-type","Expect type 'String' but got 'Array'","docfx.yml",3,9]
    ["warning","undefined-value","Value 'XNAGameStudio' is not accepted. Valid values: 'MSDN', 'VS'","docfx.yml",6,13]
    ["warning","unexpected-type","Expect type 'Integer' but got 'String'","a.md",2,7]
---
# Allow multiple metadata schema definitions
inputs:
  docfx.yml: |
    metadataSchema:
      - schema1.json
      - schema2.json
  schema1.json: |
    { "required": ["a"] }
  schema2.json: |
    { "properties": { "key": { "type": "string" } } }
  a.md: |
    ---
    key: []
    ---
outputs:
  a.json:
  .errors.log: |
    ["warning","field-required","Missing required field 'a'","a.md",2,1]
    ["warning","unexpected-type","Expect type 'String' but got 'Array'","a.md",2,6]
---
# Json schema microsoft alias rule: The author is in the allow list
inputs:
  docfx.yml: |
    metadataSchema:
      - schema.json
  schema.json: |
    { 
      "properties":
      { 
        "ms.author":
        { 
          "microsoftAlias": 
          {
            "allowedDLs":["amlstudiodocs", "o365devx"]
          }
        }
      } 
    }
  a.md: |
    ---
    ms.author: o365devx
    ---
outputs:
  a.json: |
    { "ms.author": "o365devx" }
---
# Json schema microsoft alias rule: The author is not in the allow list and without graph call
inputs:
  docfx.yml: |
    metadataSchema:
      - schema.json
  schema.json: |
    { 
      "properties":
      { 
        "ms.author":
        { 
          "microsoftAlias": 
          {
            "allowedDLs":["amlstudiodocs", "o365devx"]
          }
        }
      } 
    }
  a.md: |
    ---
    ms.author: over123
    ---
outputs:
  a.json:
  .errors.log: |
    ["warning","ms-alias-invalid","Invalid value for 'ms.author', 'over123' is not a valid Microsoft alias","a.md",2,12]
---
# Json schema microsoft alias rule: The author is in the cache
inputs:
  docfx.yml: |
    metadataSchema:
      - schema.json
  schema.json: |
    { 
      "properties":
      { 
        "ms.author":
        { 
          "microsoftAlias": 
          {
            "allowedDLs":[]
          }
        }
      } 
    }
  a.md: |
    ---
    ms.author: yazhao
    ---
cache:
  microsoft-graph.json: |
    { 
      "aliases":
      [
        {
          "alias": "yazhao",
          "expiry": "4019-06-09T19:39:07.9918016Z"
        },
        {
          "alias": "zikun",
          "expiry": "2019-06-08T01:40:33.1981669Z"
        }
      ]
    }
outputs:
  a.json: |
    { "ms.author": "yazhao" }
---
# Json schema microsoft alias rule: The author information has expired and without graph call 
inputs:
  docfx.yml: |
    metadataSchema:
      - schema.json
  schema.json: |
    { 
      "properties":
      { 
        "ms.author":
        { 
          "microsoftAlias": 
          {
            "allowedDLs":[]
          }
        }
      } 
    }
  a.md: |
    ---
    ms.author: zikun
    ---
cache:
  microsoft-graph.json: |
    { 
      "aliases":
      [
        {
          "alias": "yazhao",
          "expiry": "4019-06-09T19:39:07.9918016Z"
        },
        {
          "alias": "zikun",
          "expiry": "2019-06-08T01:40:33.1981669Z"
        }
      ]
    }
outputs:
  a.json:
  .errors.log: |
    ["warning","ms-alias-invalid","Invalid value for 'ms.author', 'zikun' is not a valid Microsoft alias","a.md",2,12]
---
# Json schema microsoft alias rule: The author is valid with graph call 
inputs:
  docfx.yml: |
    metadataSchema:
      - schema.json
    jsonSchema:
      microsoftGraphClientSecret: {MICROSOFT_GRAPH_CLIENT_SECRET}
  schema.json: |
    { 
      "properties":
      { 
        "ms.author":
        { 
          "microsoftAlias": 
          {
            "allowedDLs":[]
          }
        }
      } 
    }
  a.md: |
    ---
    ms.author: yazhao
    ---
environments:
  - MICROSOFT_GRAPH_CLIENT_SECRET
outputs:
  a.json: |
    { "ms.author": "yazhao" }
---
# Json schema microsoft alias rule: The author is invalid with graph call 
inputs:
  docfx.yml: |
    metadataSchema:
      - schema.json
    jsonSchema:
      microsoftGraphClientSecret: {MICROSOFT_GRAPH_CLIENT_SECRET}
  schema.json: |
    { 
      "properties":
      { 
        "ms.author":
        { 
          "microsoftAlias": 
          {
            "allowedDLs":[]
          }
        }
      } 
    }
  a.md: |
    ---
    ms.author: abc1234cba
    ---
environments:
  - MICROSOFT_GRAPH_CLIENT_SECRET
outputs:
  a.json:
  .errors.log: |
    ["warning","ms-alias-invalid","Invalid value for 'ms.author', 'abc1234cba' is not a valid Microsoft alias","a.md",2,12]
---
