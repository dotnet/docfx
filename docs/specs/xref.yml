---
# Unknown xrefs are output as is with a warning
inputs:
  docfx.yml:
  docs/a.md: Link to <xref:a>
outputs:
  docs/a.json: |
    { "content": "<p>Link to &lt;xref:a&gt;</p>" }
  build.log: |
    ["warning","uid-not-found","Cannot find uid 'a' using xref '<xref:a>'","docs/a.md",1,9]
---
# Unknown xrefs using @ syntax are output as is with a informational message
inputs:
  docfx.yml:
  docs/a.md: Link to @a
outputs:
  docs/a.json: |
    { "content": "<p>Link to @a</p>" }
  build.log: |
    ["info","at-uid-not-found","Cannot find uid 'a' using xref '@a'","docs/a.md",1,10]
---
# Restore xref map from configured url and use the map for resolving
# hostname should be removed if docset sharing the same one
inputs:
  docfx.yml: |
    baseUrl: https://docs.microsoft.com
    xref: xrefmap.json
  docs/a.md: Link to @System.String
  xrefmap.json: |
    {
      "references":[{
          "uid": "System.String",
          "name": "String",
          "fullName": "System.String",
          "href": "https://docs.microsoft.com/en-us/dotnet/api/system.string",
          "nameWithType": "System.String"
      }]
    }
outputs:
  docs/a.json: |
    { "content": "<p>Link to <a href=\"/en-us/dotnet/api/system.string\">String</a></p>\n"}
---
# Restore xref map from configured url and use the YAML file for resolving
inputs:
  docfx.yml: |
    xref: 
      - xrefmap.yml
  docs/a.md: Link to @System.String
  xrefmap.yml: |
    references:
      - uid: System.String
        name: String
        fullName: System.String
        href: https://docs.microsoft.com/en-us/dotnet/api/system.string
        nameWithType: System.String
outputs:
  docs/a.json: |
    { "content": "<p>Link to <a href=\"https://docs.microsoft.com/en-us/dotnet/api/system.string\">String</a></p>\n"}
---
# Define uid in conceptual, resolve it
inputs:
  docfx.yml:
  docs/a.md: |
    ---
    title: Title from yaml header a
    uid: a
    ---
  docs/b.md: |
    ---
    title: Title from yaml header b
    uid: b
    ---
  docs/c.md: Link to @a
outputs:
  docs/c.json: | 
    {"content":"<p>Link to <a href=\"a\">Title from yaml header a</a></p>\n"}
  docs/a.json:
  docs/b.json:
  xrefmap.json: | 
    {
      "references":[
        {
          "uid": "a",
          "href": "https://docs.com/docs/a",
          "name": "Title from yaml header a"
        },
        {
          "uid": "b",
          "href": "https://docs.com/docs/b",
          "name": "Title from yaml header b"
        }
      ]
    }
  .dependencymap.json: |
    {
      "dependencies": {
          "docs/c.md": [
              {
                  "source": "docs/a.md",
                  "type": "uidInclusion"
              }
          ]
      }
    }
---
# Define uid in SDP
# Resolve xref with display property in conceptual document
# Resolve xref with non-existing display property, display name
inputs:
  docfx.yml:
  docs/a.json: |
    {
      "$schema": "https://raw.githubusercontent.com/dotnet/docfx/v3/schemas/TestData.json",
      "uid": "a",
      "name": "test",
      "fullName": "test.test",
      "description": "a.description"
    }
  docs/c.md: |
    Link to <xref:a?displayProperty=fullName>
    Link to @a?displayProperty=fullName
    Link to <xref:a?displayProperty=notExisting>
outputs:
  docs/c.json: | 
    {"content":"<p>Link to <a href=\"a.json\">test.test</a>\nLink to <a href=\"a.json\">test.test</a>\nLink to <a href=\"a.json\">test</a></p>\n"}
  docs/a.json:
  xrefmap.json: | 
    {"references":[{"uid":"a","href":"https://docs.com/docs/a.json"}]}
  .dependencymap.json: |
    {
      "dependencies": {
          "docs/c.md": [
              {
                  "source": "docs/a.json",
                  "type": "uidInclusion"
              }
          ]
      }
    }
---
# Define duplicate uid in conceptual and SDP 
# should output error and uid cannot be resolved
inputs:
  docfx.yml:
  docs/a.yml: |
    #YamlMime:TestData
    uid: a
  docs/b.json: |
    {
      "$schema": "https://raw.githubusercontent.com/dotnet/docfx/v3/schemas/TestData.json",
      "uid": "a"
    }
  docs/c.md: Link to @a
outputs:
  docs/a.json:
  docs/b.json: 
  docs/c.json: |
    {"content":"<p>Link to @a</p>\n"}
  build.log: |
    ["error","uid-conflict","Two or more documents have defined the same Uid 'a': docs/a.yml,docs/b.json"]
    ["info","at-uid-not-found","Cannot find uid 'a' using xref '@a'","docs/c.md",1,10]
  xrefmap.json: | 
    {"!references":null}
---
# Resolve xref in SDP
inputs:
  docfx.yml:
  docs/a.json: |
    {
      "$schema": "https://raw.githubusercontent.com/dotnet/docfx/v3/schemas/TestData.json",
      "uid": "a",
      "name": "test",
      "fullName": "test.test",
      "description": "a.description"
    }
  docs/b.json: | 
    {
      "$schema": "https://raw.githubusercontent.com/dotnet/docfx/v3/schemas/TestData.json",
      "xref": "a"
    }
outputs:
  docs/a.json:
  docs/b.json: | 
    {
      "content": {"xref": "a.json"}
    }
  xrefmap.json: | 
    {"references":[{"uid":"a","href":"https://docs.com/docs/a.json"}]}
  .dependencymap.json: |
    {
      "dependencies": {
          "docs/b.json": [
              {
                  "source": "docs/a.json",
                  "type": "uidInclusion"
              }
          ]
      }
    }
---
# Define uid with error
inputs:
  docfx.yml:
  docs/a.json: |
    {
      "$schema": "https://raw.githubusercontent.com/dotnet/docfx/v3/schemas/TestData.json",
      "uid": "a",
      "name": "test",
      "fullName": "test.test",
      "description":
    }
  docs/b.json: | 
    {
      "$schema": "https://raw.githubusercontent.com/dotnet/docfx/v3/schemas/TestData.json",
      "xref": "a"
    }
outputs:
  docs/b.json: | 
    { "content": {"!xref": null}}
  build.log: |
    ["error","json-syntax-error","Unexpected character encountered while parsing value: }.","docs/a.json",7]
    ["warning","uid-not-found","Cannot find uid 'a' using xref 'a'","docs/b.json",3,13]
  xrefmap.json: | 
    {"!references":null}
---
# support multiple uids in the same array in one SDP
inputs:
  docfx.yml:
  docs/a.yml: |
    #YamlMime:TestData
    uid: a
    description: description for a
    data:
      uid: a.data
      description: description for a.data
    array:
      - uid: a.b
        description: description for a.b
        array:
          - uid: a.b.d
            description: description for a.b.d
          - uid: a.b.e
            description: description for a.b.e
      - uid: a.c
        description: description for a.c
  docs/b.md: Link to @a.b
outputs:
  docs/a.json:
  docs/b.json: |
    {"content": "<p>Link to <a href=\"a.json#a_b\">a.b</a></p>\n"}
  xrefmap.json: |
    {
      "references": [{
        "uid": "a",
        "href": "https://docs.com/docs/a.json",
        "description": "description for a"
      }, 
      {
        "uid": "a.b",
        "href": "https://docs.com/docs/a.json#a_b",
        "description": "description for a.b"
      },
      {
        "uid": "a.b.d",
        "href": "https://docs.com/docs/a.json#a_b_d",
        "description": "description for a.b.d"
      },
      {
        "uid": "a.b.e",
        "href": "https://docs.com/docs/a.json#a_b_e",
        "description": "description for a.b.e"
      }, 
      {
        "uid": "a.c",
        "href": "https://docs.com/docs/a.json#a_c",
        "description": "description for a.c"
      },
      {
        "uid": "a.data",
        "href": "https://docs.com/docs/a.json#a_data",
        "description": "description for a.data"
      }]
    }
---
# uid conflict in one SDP
inputs:
  docfx.yml:
  docs/a.json: |
    {
      "$schema": "https://raw.githubusercontent.com/dotnet/docfx/v3/schemas/TestData.json",
      "uid": "a",
      "data": 
      { 
        "uid": "a"
      }
    }
outputs:
  docs/a.json:
  build.log: |
    ["error","uid-conflict","The same Uid 'a' has been defined multiple times in the same file","docs/a.json"]
  xrefmap.json: |
    {"references":[{"uid":"a","href":"https://docs.com/docs/a.json"}]}
---
# uid conflict in non-root level and another SDP
inputs:
  docfx.yml:
  docs/a.json: |
    {
      "$schema": "https://raw.githubusercontent.com/dotnet/docfx/v3/schemas/TestData.json",
      "uid": "a",
      "data": 
      { 
        "uid": "b"
      }
    }
  docs/b.json: |
    {
      "$schema": "https://raw.githubusercontent.com/dotnet/docfx/v3/schemas/TestData.json",
      "uid": "b"
    }
outputs:
  docs/a.json:
  docs/b.json:
  build.log: |
    ["error","uid-conflict","Two or more documents have defined the same Uid 'b': docs/a.json,docs/b.json"]
  xrefmap.json: |
    {"references":[{"uid":"a","href":"https://docs.com/docs/a.json"}]}
---
# Xref property field which supports markdown content
inputs:
  docfx.yml:
  docs/a.json: |
    {
      "$schema": "https://raw.githubusercontent.com/dotnet/docfx/v3/schemas/TestData.json",
      "uid": "a",
      "summary": "    Hello `docfx`!"
    }
outputs:
  docs/a.json:
  xrefmap.json: | 
    {"references":[{"uid":"a","href":"https://docs.com/docs/a.json","summary":"<pre><code>Hello `docfx`!\n</code></pre>\n"}]}
---
# Xref property field which supports inline markdown content
inputs:
  docfx.yml:
  docs/a.json: |
    {
      "$schema": "https://raw.githubusercontent.com/dotnet/docfx/v3/schemas/TestData.json",
      "uid": "a",
      "inlineDescription": "    Hello `docfx`!"
    }
outputs:
  docs/a.json:
  xrefmap.json: | 
    {"references":[{"uid":"a","href":"https://docs.com/docs/a.json","inlineDescription":"Hello <code>docfx</code>!"}]}
---
# Xref property field with dependecy
inputs:
  docfx.yml:
  docs/a.json: |
    {
      "$schema": "https://raw.githubusercontent.com/dotnet/docfx/v3/schemas/TestData.json",
      "uid": "a",
      "inlineDescription": "[!INCLUDE[B](b.md)]"
    }
  docs/b.md: |
    Hello `docfx`!
outputs:
  docs/a.json:
  docs/b.json:
  xrefmap.json: | 
    {"references":[{"uid":"a","href":"https://docs.com/docs/a.json","inlineDescription":"Hello <code>docfx</code>!"}]}
---
# Refer to uid with hashtag
inputs:
  docfx.yml:
  docs/a.md: |
    ---
    title: Title from yaml header a
    uid: a
    ---
  docs/b.md: | 
    Link to <xref:a#bookmark>
    Link to @a#bookmark
outputs:
  docs/a.json:
  docs/b.json: |
    { "content": "<p>Link to <a href=\"a#bookmark\">Title from yaml header a</a>\nLink to <a href=\"a#bookmark\">Title from yaml header a</a></p>" }
---
# Refer to uid with encoded content, it should be decoded and then resolved
inputs:
  docfx.yml:
  docs/a.md: |
    ---
    title: Title from yaml header a
    uid: a*
    ---
  docs/b.md: | 
    Link to <xref:a%2A>
    Link to @a%2A
    Link to @a*
    Link to @"a*"
    Link to @"a%2A"
outputs:
  docs/a.json:
  docs/b.json: |
    { "content": "<p>Link to <a href=\"a\">Title from yaml header a</a>\nLink to <a href=\"a\">Title from yaml header a</a>\nLink to <a href=\"a\">Title from yaml header a</a>\nLink to <a href=\"a\">Title from yaml header a</a>\nLink to <a href=\"a\">Title from yaml header a</a></p>" }
---
# Refer to uid within link
inputs:
  docfx.yml:
  docs/a.md: |
    ---
    title: Title from yaml header a
    fullName: full name
    uid: a
    ---
  docs/b.md: | 
    Link to [title](xref:a?displayProperty=fullName#bookmark)
outputs:
  docs/a.json:
  docs/b.json: |
    { "content": "<p>Link to <a href=\"a#bookmark\">title</a></p>" }
---
# Refer to uid within link, uid not found
inputs:
  docfx.yml:
  docs/a.md: |
    ---
    title: Title from yaml header a
    uid: a
    ---
  docs/b.md: | 
    Link to [title](xref:c#bookmark)
outputs:
  docs/a.json:
  docs/b.json: |
    { "content": "<p>Link to <a href=\"xref:c#bookmark\">title</a></p>" }
  build.log: |
    ["warning","uid-not-found","Cannot find uid 'c' using xref 'c#bookmark'","docs/b.md",1,9]
---
# Markdown inclusion with xref reference
inputs:
  docfx.yml:
  docs/a.md: a [!INCLUDE[](1/b.md)]
  docs/1/b.md: Link to @c
  docs/c.md: |
    ---
    title: Title from yaml header c
    uid: c
    ---
outputs:
  docs/a.json: |
    { "content": "<p>a Link to <a href=\"c\">Title from yaml header c</a></p>" }
  docs/1/b.json: |
    { "content": "<p>Link to <a href=\"../c\">Title from yaml header c</a></p>" }
  docs/c.json:
---
# Markdown inclusion with xref reference of link
inputs:
  docfx.yml:
  docs/a.md: a [!INCLUDE[](1/b.md)]
  docs/1/b.md: |
    Link to [title](xref:c)
  docs/c.md: |
    ---
    title: Title from yaml header c
    uid: c
    ---
outputs:
  docs/a.json: |
    { "content": "<p>a Link to <a href=\"c\">title</a></p>" }
  docs/1/b.json: |
    { "content": "<p>Link to <a href=\"../c\">title</a></p>" }
  docs/c.json:
---
# Markdown and SDP non-cyclic xref reference
inputs:
  docfx.yml:
  docs/a.md: |
    ---
    title: Title from yaml header a
    uid: a
    ---
    Link to @b?displayProperty=summary
  docs/b.json: | 
    {
      "$schema": "https://raw.githubusercontent.com/dotnet/docfx/v3/schemas/TestData.json",
      "uid": "b",
      "name": "name for b",
      "description": "description for b",
      "summary": "Link to @a?displayProperty=summary",
    }
outputs:
  docs/a.json:
  docs/b.json: |
    { "content":{"name":"name for b","description":"description for b"} }
---
# SDP non-cyclic xref reference should be resolved
# whose display properties are plain text
inputs:
  docfx.yml:
  docs/a.json: |
    {
      "$schema": "https://raw.githubusercontent.com/dotnet/docfx/v3/schemas/TestData.json",
      "uid": "a",
      "name": "name for a",
      "inlineDescription": "description for a",
      "summary": "Link to @b?displayProperty=inlineDescription",
    }
  docs/b.json: |
    {
      "$schema": "https://raw.githubusercontent.com/dotnet/docfx/v3/schemas/TestData.json",
      "uid": "b",
      "name": "name for b",
      "inlineDescription": "description for b",
      "summary": "Link to @a",
    }
outputs:
  docs/a.json: |
    {
      "content": 
      {
        "name": "name for a",
        "summary": "<p>Link to <a href=\"b.json\">description for b</a></p>\n",
        "inlineDescription": "description for a",
        "uid": "a"
      }
    }
  docs/b.json: |
    {
      "content": 
      {
        "name": "name for b",
        "summary": "<p>Link to <a href=\"a.json\">name for a</a></p>\n",
        "inlineDescription": "description for b",
        "uid": "b"
      }
    }
---
# SDP cyclic xref reference whose display properties referring to another uid
# a.json -> b.json -> a.json && b.json -> a.json -> b.json
inputs:
  docfx.yml:
  docs/a.json: |
    {
      "$schema": "https://raw.githubusercontent.com/dotnet/docfx/v3/schemas/TestData.json",
      "uid": "a",
      "name": "name for a",
      "inlineDescription": "description for a",
      "summary": "Link to @b?displayProperty=summary",
    }
  docs/b.json: |
    {
      "$schema": "https://raw.githubusercontent.com/dotnet/docfx/v3/schemas/TestData.json",
      "uid": "b",
      "name": "name for b",
      "inlineDescription": "description for b",
      "summary": "Link to @a?displayProperty=summary",
    }
  docs/c.json: |
    {
      "$schema": "https://raw.githubusercontent.com/dotnet/docfx/v3/schemas/TestData.json",
      "uid": "c",
      "name": "name for c",
      "inlineDescription": "description for c",
      "summary": "Link to @a",
    }
outputs:
  docs/c.json: |
    {"content":{"name":"name for c","summary":"<p>Link to <a href=\"a.json\">name for a</a></p>\n","inlineDescription":"description for c","uid":"c"}}
  build.log: |
    ["error","circular-reference","Found circular reference: 'docs/a.json' --> 'docs/b.json' --> 'docs/a.json'","docs/a.json"]
    ["error","circular-reference","Found circular reference: 'docs/b.json' --> 'docs/a.json' --> 'docs/b.json'","docs/b.json"]
---
# SDP cyclic xref reference whose display properties referring to another uid
# b.json -> c.json -> b.json && b.json -> c.json -> b.json && c.json -> b.json -> c.json
inputs:
  docfx.yml:
  docs/a.json: |
    {
      "$schema": "https://raw.githubusercontent.com/dotnet/docfx/v3/schemas/TestData.json",
      "uid": "a",
      "name": "name for a",
      "inlineDescription": "description for a",
      "summary": "Link to @b?displayProperty=summary",
    }
  docs/b.json: |
    {
      "$schema": "https://raw.githubusercontent.com/dotnet/docfx/v3/schemas/TestData.json",
      "uid": "b",
      "name": "name for b",
      "inlineDescription": "description for b",
      "summary": "Link to @c?displayProperty=summary",
    }
  docs/c.json: |
    {
      "$schema": "https://raw.githubusercontent.com/dotnet/docfx/v3/schemas/TestData.json",
      "uid": "c",
      "name": "name for c",
      "inlineDescription": "description for c",
      "summary": "Link to @b?displayProperty=summary",
    }
outputs:
  build.log: | 
    ["error","circular-reference","Found circular reference: 'docs/c.json' --> 'docs/b.json' --> 'docs/c.json'","docs/c.json"]
    ["error","circular-reference","Found circular reference: 'docs/b.json' --> 'docs/c.json' --> 'docs/b.json'","docs/b.json"]
    ["error","circular-reference","Found circular reference: 'docs/a.json' --> 'docs/b.json' --> 'docs/c.json' --> 'docs/b.json'","docs/a.json"]
---
# SDP cyclic xref reference to itself
inputs:
  docfx.yml:
  docs/a.json: |
    {
      "$schema": "https://raw.githubusercontent.com/dotnet/docfx/v3/schemas/TestData.json",
      "uid": "a",
      "name": "name for a",
      "inlineDescription": "description for a",
      "summary": "Link to @a?displayProperty=summary",
    }
outputs:
  build.log: |
    ["error","circular-reference","Found circular reference: 'docs/a.json' --> 'docs/a.json'","docs/a.json"]
---
# SDP non-cyclic xref reference, whose property references can be resolved
inputs:
  docfx.yml:
  docs/a.json: |
    {
      "$schema": "https://raw.githubusercontent.com/dotnet/docfx/v3/schemas/TestData.json",
      "uid": "a",
      "name": "name for a",
      "inlineDescription": "Link to @b?displayProperty=inlineDescription",
      "summary": "Link to @b?displayProperty=summary",
    }
  docs/b.json: |
    {
      "$schema": "https://raw.githubusercontent.com/dotnet/docfx/v3/schemas/TestData.json",
      "uid": "b",
      "name": "name for b",
      "inlineDescription": "Link to @a?displayProperty=name",
      "summary": "Link to @a?displayProperty=inlineDescription",
    }
outputs:
  docs/a.json:
  docs/b.json:
---
# input json file is not object
inputs:
  docfx.yml:
  docs/a.json: |
    1
outputs:
  build.log: |
    ["error","schema-not-found","Unknown schema ''","docs/a.json",1,1]
---
# support <xref href="uid"></xref>
inputs:
  docfx.yml:
  docs/a.md: |
    str <xref href="c"></xref>
    str <xref href="d" data-raw-source="@mention"></xref>
    some text
    str <xref href="d" data-raw-html="@higher" data-raw-source="@mention"></xref>
    multiple xref <xref href="e" data-raw-source="@mentione"></xref> some text <xref href="f" data-raw-source="@mentionf"></xref>
    <p>
      <xref href="e" data-raw-source="@mentione" />
      some text
      <xref href="f" data-raw-source="mentionf" />
    </p>
  docs/c.md: |
    ---
    title: Title from yaml header c
    uid: c
    ---
outputs:
  docs/a.json: |
    {"content" : "<p>str <a href='c'>Title from yaml header c</a>\nstr @mention\nsome text\nstr @higher\nmultiple xref @mentione some text @mentionf</p>\n<p>\n  @mentione\n  some text\n  mentionf\n</p>\n"}
  docs/c.json:
  build.log: |
    ["info","at-uid-not-found","Cannot find uid 'd' using xref '<xref href=\"d\" data-raw-source=\"@mention\">'","docs/a.md",2,12]
    ["info","at-uid-not-found","Cannot find uid 'd' using xref '<xref href=\"d\" data-raw-html=\"@higher\" data-raw-source=\"@mention\">'","docs/a.md",4,12]
    ["info","at-uid-not-found","Cannot find uid 'e' using xref '<xref href=\"e\" data-raw-source=\"@mentione\">'","docs/a.md",5,12]
    ["info","at-uid-not-found","Cannot find uid 'f' using xref '<xref href=\"f\" data-raw-source=\"@mentionf\">'","docs/a.md",5,12]
    ["info","at-uid-not-found","Cannot find uid 'e' using xref '<p>\n  <xref href=\"e\" data-raw-source=\"@mentione\" />\n  some text\n  <xref href=\"f\" data-raw-source=\"mentionf\" />\n</p>'","docs/a.md",6,18]
    ["warning","uid-not-found","Cannot find uid 'f' using xref '<p>\n  <xref href=\"e\" data-raw-source=\"@mentione\" />\n  some text\n  <xref href=\"f\" data-raw-source=\"mentionf\" />\n</p>'","docs/a.md",6,78]
