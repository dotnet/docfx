# restore loc repo with dependencies 1
locale: zh-cn
repos:
  https://docs.com/restore1#master:
    - files:
        docfx.yml: |
          dependencies:
            restore-child: https://docs.com/restore-child1#child
  https://docs.com/restore-child1#child:
    - files:
        docs/child.md:
  https://docs.com/restore1.zh-cn#master:
    - files:
        docfx.yml: |
          dependencies:
            restore-child: https://docs.com/restore-child1#child
        docs/loc.md: |
          [link to restore-child](~/restore-child/docs/child.md)
outputs:
  docs/loc.json:
  .errors.log: |
    {"message_severity":"warning","code":"link-out-of-scope","message":"File 'restore-child/docs/child.md [restore-child]' referenced by link '~/restore-child/docs/child.md' will not be built because it is not included in build scope","file":"docs/loc.md","line":1,"column":1}
---
# restore loc repo with dependencies 2
# [bilingual]
locale: zh-cn
repos:
  https://docs.com/restore2#master:
    - files:
        docfx.yml: |
          dependencies:
            restore-child: https://docs.com/restore-child2#child
  https://docs.com/restore2.zh-cn#master-sxs:
    - files:
        docfx.yml: |
          dependencies:
            restore-child: https://docs.com/restore-child2#child
        docs/loc.md: |
          [link to restore-child](~/restore-child/docs/child.md)
  https://docs.com/restore2.zh-cn#master:
    - files:
        docs/loc.md:
  https://docs.com/restore-child2#child:
    - files:
        docs/child.md:
outputs:
  docs/loc.json:
  .errors.log: |
    {"message_severity":"warning","code":"link-out-of-scope","message":"File 'restore-child/docs/child.md [restore-child]' referenced by link '~/restore-child/docs/child.md' will not be built because it is not included in build scope","file":"docs/loc.md","line":1,"column":1}
---
# edit url convention without source locale 1
locale: zh-cn
repos: 
  https://docfx.com/edit-url1#live:
    - files:
        docfx.yml: |
          editRepositoryUrl: https://github.com/dotnet/docfx
  https://docfx.com/edit-url1.zh-cn#live:
    - files:
        docfx.yml: |
          editRepositoryUrl: https://github.com/dotnet/docfx
        docs/a.md:
outputs:
  docs/a.json: |
    { "content_git_url": "*dotnet/docfx.zh-cn/blob/live/*"}
---
# edit url convention with source locale 1
locale: zh-cn
repos: 
  https://docfx.com/edit-url3#live:
    - files:
        docfx.yml: |
          editRepositoryUrl: https://github.com/dotnet/docfx.en-us
  https://docfx.com/edit-url3.zh-cn#live:
    - files:
        docfx.yml: |
          editRepositoryUrl: https://github.com/dotnet/docfx.en-us
        docs/a.md:
outputs:
  docs/a.json: |
    { "content_git_url": "*dotnet/docfx.en-us.zh-cn/blob/live/*"}
---
# loc file contributor info 1
locale: zh-cn
repos: 
  https://github.com/c/contribution1#master:
    - files:
        docfx.yml:
  https://github.com/c/contribution1.zh-cn#master:
    - files:
        docfx.yml:
        docs/a.md:
outputs:
  docs/a.json: |
    {
      "content_git_url": "https://github.com/c/contribution1.zh-cn/blob/master/docs/a.md",
      "original_content_git_url": "https://github.com/c/contribution1.zh-cn/blob/master/docs/a.md",
      "gitcommit": "https://github.com/c/contribution1.zh-cn/blob/81c533a0b7cc78260c82fb4e3b878f66158a9aca/docs/a.md"
    }
---
# loc file contributor info 4
# bilingual
locale: zh-cn
repos: 
  https://github.com/c/contribution4#master:
    - files:
        docfx.yml:
  https://github.com/c/contribution4.zh-cn#master-sxs:
    - files:
        docfx.yml:
        docs/a.md:
  https://github.com/c/contribution4.zh-cn#master:
    - files:
        docs/a.md:
outputs:
  docs/a.json: |
    {
      "content_git_url":"https://github.com/c/contribution4.zh-cn/blob/master/docs/a.md",
      "original_content_git_url":"https://github.com/c/contribution4.zh-cn/blob/master-sxs/docs/a.md",
      "gitcommit":"https://github.com/c/contribution4.zh-cn/blob/81c533a0b7cc78260c82fb4e3b878f66158a9aca/docs/a.md"
    }
---
# loc page link and content fallback 1
locale: zh-cn
repos:
  https://docs.com/page-fallback1#master:
    - files:
        docfx.yml:
        docs/b.md: |
          [link in a](a.md)
  https://docs.com/page-fallback1.zh-cn#master:
    - files:
        docfx.yml:
        docs/a.md: |
          [link in b](b.md)
          [!include[](b.md)]
outputs:
  docs/a.json: |
    { "conceptual":"<p><a href=\"b\">link in b</a></p>\n<p><a href=\"a\">link in a</a></p>\n"}
---
# loc resource fallback 1
locale: zh-cn
repos:
  https://docs.com/resource-fallback1#master:
    - files:
        docs/b.png:
        docfx.yml:
  https://docs.com/resource-fallback1.zh-cn#master:
    - files:
        docfx.yml:
        docs/a.md: |
          [link to b](b.png)
outputs:
  docs/a.json: |
    { "conceptual":"<p><a href=\"b.png\">link to b</a></p>"}
---
# loc resource fallback 3
# bilingual
locale: zh-cn
repos:
  https://docs.com/resource-fallback3#master:
    - files:
        docs/b.png:
        docfx.yml:
  https://docs.com/resource-fallback3.zh-cn#master-sxs:
    - files:
        docfx.yml:
        docs/a.md: |
          [link to b](b.png)
  https://docs.com/resource-fallback3.zh-cn#master:
    - files:
        docs/a.md:
outputs:
  docs/a.json: |
    { "conceptual":"<p><a href=\"b.png\">link to b</a></p>"}
---
# loc build with TOC map, loc TOC has higher priority
locale: zh-cn
repos:
  https://docs.com/toc1#master:
    - files:
        docs/TOC.md: |
          # [reference a](a.md)
        docs/b/TOC.md: |
          # [reference b](../b.md)
        docfx.yml:
  https://docs.com/toc1.zh-cn#master:
    - files:
        docfx.yml:
        docs/a.md:
        docs/b.md:
        docs/TOC.md: |
          # [reference a](a.md)
          # [reference b](b.md)
outputs:
  docs/a.json: |
    {"_tocRel": "toc.json"}
  docs/b.json: |
    {"_tocRel": "toc.json"}
  docs/toc.json: |
    {"items": [{"name": "reference a", "href": "a"},{"name": "reference b", "href": "b"}]}
---
# loc build with mixed toc map
locale: zh-cn
repos:
  https://docs.com/toc2#master:
    - files:
        docs/a/a.md:
        docs/b/TOC.md: |
          # [reference b](b.md)
        docfx.yml:
  https://docs.com/toc2.zh-cn#master:
    - files:
        docfx.yml:
        docs/a/TOC.md: |
          # [reference a](a.md)
        docs/b/b.md:
outputs:
  docs/b/b.json: |
    {"_tocRel": "toc.json"}
  docs/a/toc.json: |
    {"items": [{"name": "reference a", "href": "a"}]}
---
# loc build with xref map, loc file has higher priority
locale: zh-cn
repos:
  https://docs.com/xref1#master:
    - files:
        docs/a.md: |
          ---
          uid: c
          ---
        docfx.yml:
  https://docs.com/xref1.zh-cn#master:
    - files:
        docfx.yml:
        docs/a.md: |
          ---
          uid: a
          ---
        docs/b.md: |
          link to @c
outputs:
  docs/a.json:
  docs/b.json:
---
# loc build with mixed xref map
locale: zh-cn
repos:
  https://docs.com/xref2#master:
    - files:
        docs/c.md: |
          ---
          uid: c
          ---
        docfx.yml:
  https://docs.com/xref2.zh-cn#master:
    - files:
        docfx.yml:
        docs/a.md: |
          ---
          uid: a
          ---
        docs/b.md: |
          link to @a
          link to @c
outputs:
  docs/a.json:
  docs/b.json: |
    {"conceptual":"<p>link to <a href=\"a\">a</a>\nlink to <a href=\"c\">c</a></p>\n"}
  .xrefmap.json: |
    {"references":[{"uid":"a","href":"https://docs.com/docs/a?branch=master","name":"a"},{"uid":"c","href":"https://docs.com/docs/c?branch=master","name":"c"}]}
---
# built metadata for loc files 1
locale: zh-cn
repos:
  https://docs.com/metadata1#master:
    - files:
        docfx.yml: |
          hostName: docs.microsoft.com
  https://docs.com/metadata1.zh-cn#master:
    - files:
        docfx.yml: |
          hostName: docs.microsoft.com
        docs/a.md:
outputs:
  docs/a.json: |
    {"locale": "zh-cn", "canonical_url": "https://docs.microsoft.com/zh-cn/docs/a", "document_id": "fa697b4e-3e52-77f6-2219-39040f6070da", "document_version_independent_id": "7c88e748-ed5e-a29a-c057-6f89857c3591",}
---
# bilingual build 1
locale: zh-cn
repos:
  https://github.com/ss/c:
    - files:
        docs/b.md: |
          [link to a](a.md)
        docs/a.md: a
        docfx.yml:
  https://github.com/ss/c.zh-cn#master-sxs:
    - files:
        docfx.yml:
        docs/a.md: |
          sxs content
          [link to b](b.md)
          [!include[include b](b.md)]
  https://github.com/ss/c.zh-cn#master:
    - files:
        docs/a.md:
outputs:
  docs/a.json: |
    {
      "conceptual": "
        <p>sxs content\n<a href=\"b\">link to b</a></p>\n<p><a href=\"a\">link to a</a></p>\n",
      "enable_loc_sxs": true
    }
---
# bilingual page's `gitcommit` url follows sxs content's commit history
locale: zh-cn
repos:
  https://github.com/bilingual/a:
    - files:
        docs/a.md: a
        docfx.yml:
  https://github.com/bilingual/a.zh-cn#master-sxs:
    - files:
        docfx.yml:
        docs/a.md: |
          loc sxs content
  https://github.com/bilingual/a.zh-cn#master:
    - files:
        docs/a.md: |
          loc content
outputs:
  docs/a.json: |
    {"gitcommit":"https://github.com/bilingual/a.zh-cn/blob/6f4caab6b2c06f7a47cdb2d77de54e917f6e80b1/docs/a.md"}
---
# conflicted toc files(source and loc)
# 1. should not report warning
# 2. `_tocRel` should be resolved to loc toc
locale: zh-cn
repos:
  https://github.com/conflictedtoc/a:
    - files:
        docs/a/TOC.md: |
          # [md reference a](a.md)
        docfx.yml:
  https://github.com/conflictedtoc/a.zh-cn:
    - files:
        docfx.yml:
        docs/a/TOC.yml: |
          - href: a.md
            name: yml reference a
        docs/a/a.md:
outputs:
  docs/a/a.json: |
    {"_tocRel": "toc.json"}
  docs/a/toc.json: |
    {"items":[{"name": "yml reference a"}]}
---
# fallback to deleted token/codesnippet
locale: zh-cn
repos:
  https://github.com/deletedtoken/a:
    - files:
        docsets.yml:
        a/docfx.yml:
      author: a
    - files:
        a/docfx.yml:
        a/docs/tokena.md: |
          [!include[include deleted tokenb](tokenb.md)]
          [!code-csharp[Main](program.cs)]
        a/docs/tokenb.md: b
        a/docs/program.cs:
      author: b
  https://github.com/deletedtoken/a.zh-cn:
    - files:
        docsets.yml:
        a/docfx.yml:
        a/docs/a.md: |
          [!include[include deleted tokena](tokena.md)]
outputs:
  a/docs/a.json: |
    {"conceptual":"<p>b</p>\n<pre><code class=\"lang-csharp\" name=\"Main\"></code></pre>"}
  a/.dependencymap.json: |
    {"dependencies": {"a/docs/tokena.md": undefined}}
---
# fallback to deleted resource
locale: zh-cn
repos:
  https://github.com/deletedres/a:
    - files:
        docfx.yml:
      author: a
    - files:
        docfx.yml:
        docs/resource.png:
        docs/b.md:
      author: b
  https://github.com/deletedres/a.zh-cn:
    - files:
        docfx.yml:
        docs/a.md: |
          [link to deleted resource](resource.png)
          [link to deleted markdown doesn't work](b.md)
outputs:
  docs/a.json: |
    {"conceptual":"<p><a href=\"resource.png\">link to deleted resource</a>\n<a href=\"b.md\">link to deleted markdown doesn't work</a></p>\n"}
  .errors.log: |
    {"message_severity":"warning","code":"file-not-found","message":"Invalid file link: 'b.md'.","file":"docs/a.md","line":2,"column":1}
  .dependencymap.json: |
    {
      "dependencies": {
        "docs/a.md": [{ "source":"docs/resource.png","type":"file" }]
      }
    }
---
# fallback to deleted toc
locale: zh-cn
repos:
  https://github.com/deletedtoc/a:
    - files:
        docfx.yml:
      author: a
    - files:
        docfx.yml:
        docs/a/TOC.yml: |
          - href: a.md
            name: reference markdown a
      author: b
  https://github.com/deletedtoc/a.zh-cn:
    - files:
        docfx.yml:
        docs/b/TOC.yml: |
          - href: ../a/TOC.yml
            name: reference toc a
        docs/a/a.md:
outputs:
  docs/a/a.json:
  docs/b/toc.json: |
    {"items":[{"name":"reference toc a","items":[{"name":"reference markdown a","href":"../a/a"}]}]}
---
# fallback to deleted toc only works for localization docset build
repos:
  https://github.com/onlyloc/a:
    - files:
        docfx.yml:
        docs/b/TOC.yml: |
          - href: ../a/TOC.yml
            name: reference toc a
        docs/a/a.md:
    - files:
        docfx.yml:
        docs/a/TOC.yml: |
          - href: a.md
            name: reference markdown a
outputs:
  docs/a/a.json:
  docs/b/toc.json: |
    {"items":[{"name":"reference toc a"}]}
---
# fallback to deleted token/codesnippet/resource only works for loc docset build
repos:
  https://github.com/onlyloc/b:
    - files:
        docfx.yml:
        docs/a.md: |
          [!include[include deleted tokena](tokena.md)]
          [link to deleted resource](resource.png)
    - files:
        docfx.yml:
        docs/tokena.md: |
          [!include[include deleted tokenb](tokenb.md)]
          [!code-csharp[Main](program.cs)]
        docs/tokenb.md: b
        docs/program.cs:
        docs/resource.png:
outputs:
  .errors.log: |
    {"message_severity":"warning","code":"file-not-found","message":"Invalid file link: 'resource.png'.","file":"docs/a.md","line":2,"column":1}
    {"message_severity":"error","code":"include-not-found","message":"Invalid include link: 'tokena.md'.","file":"docs/a.md","line":1,"column":1}
---
# fallback to inclusion parent toc
locale: zh-cn
repos:
  https://github.com/inclusiontoc/a:
    - files:
        docfx.yml:
        docs/b/TOC.yml: |
          - href: ../a/TOC.yml
            name: reference toc a
        docs/a/TOC.yml: |
          - href: b.md
            name: reference markdown b
  https://github.com/inclusiontoc/a.zh-cn:
    - files:
        docfx.yml:
        docs/a/TOC.yml: |
          - href: a.md
            name: reference markdown a
        docs/a/a.md:
        docs/a/b.md:
outputs:
  docs/a/a.json:
  docs/a/b.json:
  docs/b/toc.json: |
    {"items":[{"name":"reference toc a","items":[{"name":"reference markdown a","href":"../a/a"}]}]}
---
# loc build with different dependency git repository 1
# bilingual
locale: zh-cn
repos:
  https://github.com/locconfig2/c:
    - files:
        docfx.yml: |
          dependencies:
            child1: https://github.com/locconfig2/d#live
        docs/a.md:
  https://github.com/locconfig2/c.zh-cn#master-sxs:
    - files:
        docs/a.md: |
          [!include[include child](~/child1/token.md)]
        docfx.yml: |
          dependencies:
            child1: https://github.com/locconfig2/d#live
  https://github.com/locconfig2/c.zh-cn:
    - files:
        docs/a.md:
  https://github.com/locconfig2/d#live:
    - files:
        token.md: |
          live branch
  https://github.com/locconfig2/d#master:
    - files:
        token.md: |
          master branch
outputs:
  docs/a.json: |
    { "conceptual": "<p>live branch</p>\n" }
---
# Apply &lrm; for right to left languages
locale: ar-sa
repos:
  https://docs.com/lrm#master:
    - files:
        docfx.yml:
  https://docs.com/lrm.ar-sa#master:
    - files:
        docfx.yml:
        docs/a.md: |
          Learn c#.
outputs:
  docs/a.json: |
    { "conceptual": "<p>Learn c#&lrm;.</p>" }
---
# VSTS localized repo
locale: zh-cn
repos:
  https://docascode.visualstudio.com/repo/_git/a#live:
    - files:
        docfx.yml:
        docs/b.md: |
          [link in a](a.md)
  https://docascode.visualstudio.com/repo/_git/a.zh-cn#live:
    - files:
        docfx.yml:
        docs/a.md: |
          [link in b](b.md)
          [!include[](b.md)]
outputs:
  docs/a.json: |
    { "conceptual":"<p><a href=\"b\">link in b</a></p>\n<p><a href=\"a\">link in a</a></p>\n"}
---
# VSTS localized repo with bilingual
locale: zh-cn
repos:
  https://docascode.visualstudio.com/repo/_git/b#live:
    - files:
        docfx.yml:
        docs/b.md: |
          [link in a](a.md)
  https://docascode.visualstudio.com/repo/_git/b.zh-cn#live-sxs:
    - files:
        docfx.yml:
        docs/a.md: |
          [link in b](b.md)
          [!include[](b.md)]
  https://docascode.visualstudio.com/repo/_git/b.zh-cn#live:
    - files:
        docs/a.md: "not used"
outputs:
  docs/a.json: |
    { "conceptual":"<p><a href=\"b\">link in b</a></p>\n<p><a href=\"a\">link in a</a></p>\n"}
---
# fallback to never existing token in multiple files
locale: zh-cn
repos:
  https://github.com/neverexist/a:
    - files:
        docfx.yml:
      author: a
  https://github.com/neverexist/a.zh-cn:
    - files:
        docfx.yml:
        docs/1.md: |
          [!include[include deleted tokena](tokenx.md)]
        docs/2.md: |
          [!include[include deleted tokena](tokenx.md)]
        docs/3.md: |
          [!include[include deleted tokena](tokenx.md)]
outputs:
  .errors.log: |
    {"message_severity":"error","code":"include-not-found","message":"Invalid include link: 'tokenx.md'.","file":"docs/1.md","line":1,"column":1}
    {"message_severity":"error","code":"include-not-found","message":"Invalid include link: 'tokenx.md'.","file":"docs/2.md","line":1,"column":1}
    {"message_severity":"error","code":"include-not-found","message":"Invalid include link: 'tokenx.md'.","file":"docs/3.md","line":1,"column":1}
---
# fallback to corresponding source branch 1
locale: zh-cn
repos:
  https://docs.com/branch-fallback1#test:
    - files:
        docfx.yml:
        docs/b.md: |
          test
  https://docs.com/branch-fallback1#master:
    - files:
        docfx.yml:
        docs/b.md: |
          master
  https://docs.com/branch-fallback1.zh-cn#test:
    - files:
        docfx.yml:
        docs/a.md: |
          [!include[](b.md)]
outputs:
  docs/a.json: |
    { "conceptual":"<p>test</p>"}
---
# fallback to corresponding source branch 2
# [bilingual]
locale: zh-cn
repos:
  https://docs.com/branch-fallback2#test:
    - files:
        docfx.yml:
        docs/b.md: |
          test
  https://docs.com/branch-fallback2#master:
    - files:
        docfx.yml:
        docs/b.md: |
          master
  https://docs.com/branch-fallback2.zh-cn#test-sxs:
    - files:
        docfx.yml:
        docs/a.md: |
          [!include[](b.md)]
  https://docs.com/branch-fallback2.zh-cn#test:
    - files:
        docs/a.md:
outputs:
  docs/a.json: |
    { "conceptual":"<p>test</p>"}
---
# Do not validate bookmark for fallback content
locale: zh-cn
repos:
  https://docs.com/fallback-content-bookmark-validation#master:
    - files:
        docfx.yml:
        a.md:
  https://docs.com/fallback-content-bookmark-validation.zh-cn#master:
    - files:
        docfx.yml:
        b.md: '[](a.md#invalid-bookmark)'
outputs:
  b.json:
---
# Loc with multiple docsets
locale: zh-cn
repos:
  https://docs.com/config-not-root#test:
    - files:
        docsets.yml:
        docs/docfx.yml:
        docs/c/b.md: |
          test
  https://docs.com/config-not-root#master:
    - files:
        docsets.yml:
        docs/docfx.yml:
        docs/c/b.md: |
          master
  https://docs.com/config-not-root.zh-cn#test:
    - files:
        docsets.yml:
        docs/docfx.yml:
        docs/a.md: |
          [!include[](./c/b.md)]
outputs:
  docs/a.json: |
    { "conceptual":"<p>test</p>"}
---
# should fallback to deleted TOC.md not TOC.json
locale: zh-cn
repos:
  https://github.com/deletedtoc-1/a:
    - files:
        docfx.yml:
        docs/b.md:
        docs/c.md:
    - files:
        docfx.yml:
        docs/dir/TOC.json: |
          {"items":[{"name":"reference c", "href":"../c.md"}]}
        docs/dir/TOC.md: |
          # [reference b.md](../b.md)
        docs/b.md:
        docs/c.md:
  https://github.com/deletedtoc-1/a.zh-cn:
    - files:
        docfx.yml:
        docs/TOC.yml: |
          - name: name
            href: dir/
outputs:
  docs/toc.json: |
    {"items":[{"href":"b"}]}
---
# should not fallback to deleted TOC.md if TOC.yml exists
locale: zh-cn
repos:
  https://github.com/deletedtoc-2/a:
    - files:
        docfx.yml:
        docs/dir/TOC.yml: |
          - name: toc existed
            href: ../a.md
        docs/a.md:
        docs/b.md:
    - files:
        docfx.yml:
        docs/dir/TOC.md: |
          # [reference b.md](../b.md)
        docs/b.md:
  https://github.com/deletedtoc-2/a.zh-cn:
    - files:
        docfx.yml:
        docs/TOC.yml: |
          - name: name
            href: dir/
outputs:
  docs/toc.json: |
    {"items":[{"href":"a"}]}
