# restore loc repo with dependencies
# [repository mapping] 
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/a#master1:
    - files:
        docfx.yml: |
          dependencies:
            restore-child: https://docs.com/a#child1
  https://docs.com/a#child1:
    - files:
        docs/child.md:
  https://docs.com/a.zh-cn#master1:
    - files:
        docs/loc.md: |
          [link to restore-child](~/restore-child/docs/child.md)
outputs:
  docs/loc.json:
  build.log: |
    ["warning","link-is-dependency","File 'docs/child.md' referenced by link '~/restore-child/docs/child.md' will not be built because it is from a dependency docset","docs/loc.md"]
---
# restore loc repo, all loc files are in one repo
# [repository + folder mapping]
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/b#master2:
    - files:
        docfx.yml: |
          localization:
            mapping: RepositoryAndFolder
  https://docs.com/b.localization#master2:
    - files:
        zh-cn/docs/dep.md: loc-DEP
outputs:
  docs/dep.json:
---
# loc docset share the source docset's restore map
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://github.com/docascode/c#share-restore-map:
    - files:
        docfx.yml: |
          github:
            userCache: github-user.json
            resolveUsers: true
          dependencies:
            child1: https://docs.com/docascode/d
        github-user.json: |
          {
            "users": [
              {
                "name": "Osmond Jiang",
                "login": "OsmondJiang",
                "id": 19990166,
                "expiry":"2099-01-01T00:00:00.00000Z",
                "emails": [
                  "xinjiang@microsoft.com"
                ]
              },
              {
                "name": "Renze Yu",
                "login": "superyyrrzz",
                "id": 3831744,
                "expiry":"2099-01-01T00:00:00.00000Z",
                "emails": [
                  "renzeyu@microsoft.com",
                  "superyyrrzz@gmail.com"
                ]
              },
              {
                "name": "Yufei Huang",
                "login": "yufeih",
                "id": 511355,
                "expiry":"2099-01-01T00:00:00.00000Z",
                "emails": [
                  "yufeih@users.noreply.github.com",
                  "yufeih@live.com"
                ]
              }
            ]
          }
  https://github.com/docascode/c.zh-cn#share-restore-map:
    - files:
        docs/a.md: a
      author: yufeih
      email: yufeih@live.com
    - files:
        docs/a.md: |
          [link to dependency](~/child1/docs/d.md)
      author: OsmondJiang
      email: xinjiang@microsoft.com
  https://docs.com/docascode/d:
    - files:
        docs/d.md:
outputs:
  docs/a.json: |
    {"author":{"display_name":"Osmond Jiang","id":"19990166"},"contributors":[{"display_name":"Yufei Huang","id":"511355"}]}
---
# loc config convention without source locale
# [repository mapping] 
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos: 
  https://docfx.com/abc#loc-contribution1:
    - files:
        docfx.yml: |
          contribution:
            repository: https://github.com/dotnet/docfx
  https://docfx.com/abc.zh-cn#loc-contribution1:
    - files:
        docs/a.md:
outputs:
  docs/a.json: |
    { "content_git_url": "*dotnet/docfx.zh-cn*"}
---
# loc config convention with source locale
# [repository mapping] 
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos: 
  https://docfx.com/abc.en-us#loc-contribution2:
    - files:
        docfx.yml: |
          contribution:
            repository: https://github.com/dotnet/docfx.en-us
  https://docfx.com/abc.zh-cn#loc-contribution2:
    - files:
        docs/a.md:
outputs:
  docs/a.json: |
    { "content_git_url": "*dotnet/docfx.zh-cn*"}
---
# loc config convention with source locale, all loc files are in one repo
# [repository + folder mapping] 
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos: 
  https://docfx.com/abc.en-us#loc-contribution3:
    - files:
        docfx.yml: |
          contribution:
            repository: https://github.com/dotnet/docfx.en-us
          localization:
            mapping: RepositoryAndFolder
  https://docfx.com/abc.localization#loc-contribution3:
    - files:
        zh-cn/docs/a.md:
outputs:
  docs/a.json: |
    { "content_git_url": "*dotnet/docfx.localization/blob/master/zh-cn*"}
---
# loc config convention with source locale, all loc files are in source repo under different locale folder
# [folder mapping] 
commands:
  - restore
  - build --locale zh-cn
inputs:
  docfx.yml: |
    contribution:
      repository: https://github.com/dotnet/docfx.en-us
    localization:
      mapping: Folder
  localization/zh-cn/docs/a.md:
outputs:
  docs/a.json: |
    { "content_git_url": "*dotnet/docfx.en-us/blob/master/*"}
---
# loc file contributor info 1
# [repository mapping] 
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos: 
  https://github.com/docascode/abc#loc-contribution5:
    - files:
        docfx.yml:
  https://github.com/docascode/abc.zh-cn#loc-contribution5:
    - files:
        docs/a.md:
inputs:
  docfx.yml:
outputs:
  docs/a.json: |
    { "content_git_url":"https://github.com/docascode/abc.zh-cn/blob/loc-contribution5/docs/a.md","original_content_git_url":"https://github.com/docascode/abc.zh-cn/blob/loc-contribution5/docs/a.md", "gitcommit":"https://github.com/docascode/abc.zh-cn/blob/f35b220adadfe88d1d4f1b043c8dc55db491c83e/docs/a.md"}
---
# loc file contributor info 2
# all loc files are in one repo
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos: 
  https://github.com/docascode/abc#loc-contribution6:
    - files:
        docfx.yml: |
          localization:
            mapping: RepositoryAndFolder
  https://github.com/docascode/abc.localization#loc-contribution6:
    - files:
        zh-cn/docs/a.md:
outputs:
  docs/a.json: |
    { "content_git_url":"https://github.com/docascode/abc.localization/blob/loc-contribution6/zh-cn/docs/a.md","original_content_git_url":"https://github.com/docascode/abc.localization/blob/loc-contribution6/zh-cn/docs/a.md", "gitcommit":"https://github.com/docascode/abc.localization/blob/c4e050bdaa03a863e0c9b274af6c0ddafa1b8189/zh-cn/docs/a.md"}
---
# loc file contributor info 3
# all loc file are in source repo under different locale folder
commands:
  - restore
  - build --locale zh-cn
repos:
  https://github.com/docascode/a#loc-contribution-folder:
    - files:
        docfx.yml: |
          localization:
            mapping: Folder
        localization/zh-cn/docs/a.md:
outputs:
  docs/a.json: |
    { "content_git_url":"https://github.com/docascode/a/blob/loc-contribution-folder/localization/zh-cn/docs/a.md","original_content_git_url":"https://github.com/docascode/a/blob/loc-contribution-folder/localization/zh-cn/docs/a.md", "gitcommit":"https://github.com/docascode/a/blob/ffb8cfa5f33566a83770b90d647577a58e1d662d/localization/zh-cn/docs/a.md"}
---
# loc page link and content fallback
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/test#fallback1:
    - files:
        docfx.yml:
        docs/b.md: |
          [link in a](a.md)
  https://docs.com/test.zh-cn#fallback1:
    - files:
        docs/a.md: |
          [link in b](b.md)
          [!include[](b.md)]
outputs:
  docs/a.json: |
    { "content":"<p><a href=\"b\">link in b</a></p>\n<p><a href=\"a\">link in a</a></p>\n"}
---
# loc page fallback, all loc files are in one repo
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/test#fallback2:
    - files:
        docs/b.md: |
          [link to a](a.md)
        docfx.yml: |
          localization:
            mapping: RepositoryAndFolder
  https://docs.com/test.localization#fallback2:
    - files:
        zh-cn/docs/a.md: |
          [link to b](b.md)
          [!include[include b](b.md)
outputs:
  docs/a.json: |
    { "content":"<p><a href=\"b\">link to b</a></p>\n<p><a href=\"a\">link to a</a></p>\n"}
---
# loc resource fallback
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/test#fallback3:
    - files:
        docs/b.png:
        docfx.yml:
  https://docs.com/test.zh-cn#fallback3:
    - files:
        docs/a.md: |
          [link to b](b.png)
outputs:
  docs/a.json: |
    { "content":"<p><a href=\"b.png\">link to b</a></p>"}
---
# loc token fallback, all loc files are in source repo under different locale folder
commands:
  - restore
  - build --locale zh-cn
inputs:
  docfx.yml: |
    localization:
      mapping: Folder
  docs/b.md: |
    [link to a](a.md)
  docs/a.md: a
  localization/zh-cn/docs/a.md: |
    [link to b](b.md)
    [!include[include b](b.md)
outputs:
  docs/a.json: |
    { "content":"<p><a href=\"b\">link to b</a></p>\n<p><a href=\"a\">link to a</a></p>\n"}
---
# loc build with TOC map, loc TOC has higher priority
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/test#toc1:
    - files:
        docs/TOC.md: |
          # [reference a](a.md)
        docs/b/TOC.md: |
          # [reference b](../b.md)
        docfx.yml:
  https://docs.com/test.zh-cn#toc1:
    - files:
        docs/a.md:
        docs/b.md:
        docs/TOC.md: |
          # [reference a](a.md)
          # [reference b](b.md)
outputs:
  docs/a.json: |
    {"toc_rel": "toc.json"}
  docs/b.json: |
    {"toc_rel": "toc.json"}
  docs/toc.json: |
    {"items": [{"toc_title": "reference a", "href": "a"},{"toc_title": "reference b", "href": "b"}]}
---
# loc build with mixed toc map
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/test#toc2:
    - files:
        docs/a/a.md:
        docs/b/TOC.md: |
          # [reference b](b.md)
        docfx.yml:
  https://docs.com/test.zh-cn#toc2:
    - files:
        docs/a/TOC.md: |
          # [reference a](a.md)
        docs/b/b.md:
outputs:
  docs/b/b.json: |
    {"toc_rel": "toc.json"}
  docs/a/toc.json: |
    {"items": [{"toc_title": "reference a", "href": "a"}]}
---
# loc build with mixed toc map, all loc files are in source repo under different locale folder
commands:
  - restore
  - build --locale zh-cn
inputs:
  docfx.yml: |
    localization:
      mapping: Folder
  docs/b/TOC.md: |
    # [reference b](b.md)
  docs/a/a.md:
  localization/zh-cn/docs/b/b.md:
  localization/zh-cn/docs/a/TOC.md: |
    # [reference a](a.md)
outputs:
  docs/b/b.json: |
    {"toc_rel": "toc.json"}
  docs/a/toc.json: |
    {"items": [{"toc_title": "reference a", "href": "a"}]}
---
# loc build with xref map, loc file has higher priority
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/test#xref1:
    - files:
        docs/a.md: |
          ---
          uid: c
          ---
        docfx.yml:
  https://docs.com/test.zh-cn#xref1:
    - files:
        docs/a.md: |
          ---
          uid: a
          ---
        docs/b.md: |
          link to @c
outputs:
  build.log: |
    ["info","at-uid-not-found","Cannot find uid 'c' using xref '@c'","docs/b.md"]
  docs/a.json:
  docs/b.json:
---
# loc build with xref map, all locale files are in source repo under different locale folder, loc file has higher priority
commands:
  - restore
  - build --locale zh-cn
inputs:
  docfx.yml: |
    localization:
      mapping: Folder
  docs/a.md: |
    ---
    uid: c
    ---
  localization/zh-cn/docs/a.md: |
    ---
    uid: a
    ---
  localization/zh-cn/docs/b.md: link to @c
outputs:
  build.log: |
    ["info","at-uid-not-found","Cannot find uid 'c' using xref '@c'","docs/b.md"]
  docs/a.json:
  docs/b.json:
---
# loc build with mixed xref map
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/test#xref2:
    - files:
        docs/c.md: |
          ---
          uid: c
          ---
        docfx.yml:
  https://docs.com/test.zh-cn#xref2:
    - files:
        docs/a.md: |
          ---
          uid: a
          ---
        docs/b.md: |
          link to @a
          link to @c
outputs:
  docs/a.json:
  docs/b.json: |
    {"content":"<p>link to <a href=\"/docs/a\">a</a>\nlink to <a href=\"/docs/c\">c</a></p>\n"}
  xrefmap.json: |
    {"references":[{"uid":"a","href":"/docs/a","name":"a"},{"uid":"c","href":"/docs/c","name":"c"}]}
---
# loc folder should be excluded from source docset during loc docset build
commands:
  - restore
  - build --locale zh-cn
inputs:
  docfx.yml: |
    files: '**/*.md'
    localization:
      mapping: Folder
  localization/zh-cn/docs/a.md: |
    [link to a](~/localization/zh-cn/docs/a.md)
    [link to a](~/docs/a.md)
outputs:
  docs/a.json:
  build.log: |
    ["warning","link-out-of-scope","File 'localization/zh-cn/docs/a.md' referenced by link '~/localization/zh-cn/docs/a.md' will not be built because it is not included in docfx.yml","docs/a.md"]
---
# loc folder should be excluded from source docset during source docset build
inputs:
  docfx.yml: |
    files: '**/*.md'
    localization:
      mapping: Folder
  localization/zh-cn/docs/a.md:
  docs/b.md:
outputs:
  docs/b.json:
---
# built metadata for loc files
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/test#metadata1:
    - files:
        docfx.yml: |
          baseUrl: https://docs.microsoft.com
  https://docs.com/test.zh-cn#metadata1:
    - files:
        docs/a.md:
outputs:
  docs/a.json: |
    {"locale": "zh-cn", "canonical_url": "https://docs.microsoft.com/zh-cn/docs/a", "document_id": "fa697b4e-3e52-77f6-2219-39040f6070da", "document_version_independent_id": "7c88e748-ed5e-a29a-c057-6f89857c3591",}
---
# built metadata for loc files, all loc files are in same repo
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/test#metadata2:
    - files:
        docfx.yml: |
          baseUrl: https://docs.microsoft.com
          localization:
            mapping: RepositoryAndFolder
  https://docs.com/test.localization#metadata2:
    - files:
        zh-cn/docs/a.md:
outputs:
  docs/a.json: |
    {"locale": "zh-cn", "canonical_url": "https://docs.microsoft.com/zh-cn/docs/a", "document_id": "fa697b4e-3e52-77f6-2219-39040f6070da", "document_version_independent_id": "7c88e748-ed5e-a29a-c057-6f89857c3591"}
---
# built metadata for loc files, all loc files are in source repo under different locale folder
commands:
  - restore
  - build --locale zh-cn
inputs:
  docfx.yml: |
    baseUrl: https://docs.microsoft.com
    localization:
      mapping: Folder
  localization/zh-cn/docs/a.md:
outputs:
  docs/a.json: |
    {"locale": "zh-cn", "canonical_url": "https://docs.microsoft.com/zh-cn/docs/a", "document_id": "fa697b4e-3e52-77f6-2219-39040f6070da", "document_version_independent_id": "7c88e748-ed5e-a29a-c057-6f89857c3591"}
---
# bilingual build
# [repository mapping]
# loc repo[master-sxs]:
#   docs/a.md: |
#     sxs content
#     [link to b](b.md)
#     [!include[include b](b.md)
# source repo[master]:
#   docs/b.md: |
#     [link to a](a.md)
#   docs/a.md: a
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repo: https://github.com/docascode/docfx-test-dependencies
inputs:
  docfx.yml: |
    localization:
      bilingual: true
  docs/b.md: |
    [link to a](a.md)
  docs/a.md: a
outputs:
  docs/a.json: |
    {"content":"<p>sxs content\n<a href=\"b\">link to b</a></p>\n<p><a href=\"a\">link to a</a></p>\n", "bilingual": true}
---
# bilingual build, all loc files are in one loc repo under different locale folder
# [repository + folder mapping]
# loc repo[master-sxs]:
#   zh-cn/docs/a.md: |
#     sxs content
#     [link to b](b.md)
#     [!include[include b](b.md)
# source repo[master]:
#   docs/b.md: |
#     [link to a](a.md)
#   docs/a.md: a
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repo: https://github.com/docascode/docfx-test-dependencies
inputs:
  docfx.yml: |
    localization:
      mapping: RepositoryAndFolder
      bilingual: true
  docs/b.md: |
    [link to a](a.md)
  docs/a.md: a
outputs:
  docs/a.json: |
    {"content":"<p>sxs content\n<a href=\"b\">link to b</a></p>\n<p><a href=\"a\">link to a</a></p>\n", "bilingual": true}
---
# bilingual page's contributor info is extracted from non-sxs branch 
# loc repo:
#   loc-bilingual branch(sxs branch):
#     zh-cn/docs/a.md(modified by A and B)
#   loc-bilingual-sxs branch(non-sxs branch):
#     zh-cn/docs/a.md(modified by B and C)
# for above case, the a.md's contributors are A and B
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repo: https://github.com/docascode/docfx-test-dependencies#loc-bilingual
inputs:
  docfx.yml: |
    localization:
      mapping: RepositoryAndFolder
      bilingual: true
    github:
      userCache: github-user.json
  github-user.json: |
    {
      "users": [
        {
          "name": "Osmond Jiang",
          "login": "OsmondJiang",
          "id": 19990166,
          "expiry":"2099-01-01T00:00:00.00000Z",
          "emails": [
            "xinjiang@microsoft.com"
          ]
        },
        {
          "name": "Wei Hu",
          "login": "live1206",
          "id": 1234567,
          "expiry":"2099-01-01T00:00:00.00000Z",
          "emails": [
            "live1206@microsoft.com",
          ]
        },
        {
          "name": "Yufei Huang",
          "login": "yufeih",
          "id": 511355,
          "expiry":"2099-01-01T00:00:00.00000Z",
          "emails": [
            "yufeih@users.noreply.github.com",
            "yufeih@live.com"
          ]
        }
      ]
    }
outputs:
  build.manifest:
  docs/a.json: |
    {"author":{"display_name":"Osmond Jiang","id":"xinjiang@microsoft.com"},"contributors":[{"display_name":"Wei Hu","id":"huwe@microsoft.com"}],"bilingual": true}
---
# bilingual page's `gitcommit` url follows sxs content's commit history
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://github.com/bilingual/a:
    - files:
        docs/a.md: a
        docfx.yml: |
          localization:
            bilingual: true
  https://github.com/bilingual/a.zh-cn#master-sxs:
    - files:
        docs/a.md: |
          loc sxs content
  https://github.com/bilingual/a.zh-cn#master:
    - files:
        docs/a.md: |
          loc content
outputs:
  docs/a.json: |
    {"gitcommit":"https://github.com/bilingual/a.zh-cn/blob/b1990a2c68f76bcf400e766c38480834a40e80fc/docs/a.md"}
---
# conflicted toc files(source and loc)
# 1. should not report warning
# 2. `toc_rel` should be resolved to loc toc
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://github.com/conflictedtoc/a:
    - files:
        docs/a/TOC.md: |
          # [md reference a](a.md)
        docfx.yml:
  https://github.com/conflictedtoc/a.zh-cn:
    - files:
        docs/a/TOC.yml: |
          - href: a.md
            name: yml reference a
        docs/a/a.md:
outputs:
  docs/a/a.json: |
    {"toc_rel": "toc.json"}
  docs/a/toc.json: |
    {"items":[{"toc_title": "yml reference a"}]}
