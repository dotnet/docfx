# restore loc repo with dependencies 1
# [repository mapping] 
repos:
  https://docs.com/restore1.zh-cn#master:
    - files:
        docfx.yml: |
          dependencies:
            restore-child: https://docs.com/restore-child1#child
        docs/loc.md: |
          [link to restore-child](~/restore-child/docs/child.md)
  https://docs.com/restore1#master:
    - files:
  https://docs.com/restore-child1#child:
    - files:
        docs/child.md:
outputs:
  docs/loc.json:
  .errors.log: |
    ["warning","link-out-of-scope","File 'restore-child/docs/child.md [restore-child]' referenced by link '~/restore-child/docs/child.md' will not be built because it is not included in build scope","docs/loc.md",1,1]
---
# restore loc repo with dependencies 2
# [repository mapping & bilingual]
repos:
  https://docs.com/restore2.zh-cn#master-sxs:
    - files:
        docs/loc.md: |
          [link to restore-child](~/restore-child/docs/child.md)
        docfx.yml: |
          localization:
            bilingual: true
          dependencies:
            restore-child: https://docs.com/restore-child2#child
  https://docs.com/restore2#master:
    - files:
  https://docs.com/restore2.zh-cn#master:
    - files:
        docs/loc.md:
  https://docs.com/restore-child2#child:
    - files:
        docs/child.md:
outputs:
  docs/loc.json:
  .errors.log: |
    ["warning","link-out-of-scope","File 'restore-child/docs/child.md [restore-child]' referenced by link '~/restore-child/docs/child.md' will not be built because it is not included in build scope","docs/loc.md",1,1]
---
# restore loc repo without dependencies 1
# [branch mapping]
repos:
  https://docs.com/restore3.loc#master.zh-cn:
    - files:
        docfx.yml: |
          localization:
            mapping: Branch
        docs/dep.md: loc-DEP
  https://docs.com/restore3#master:
    - files:
outputs:
  docs/dep.json:
---
# restore loc repo  without dependencies 2
# [branch mapping & bilingual]
repos:
  https://docs.com/restore4.loc#master-sxs.zh-cn:
    - files:
        docfx.yml: |
          localization:
            mapping: Branch
            bilingual: true
        docs/dep.md: loc-DEP-sxs
  https://docs.com/restore4.loc#master.zh-cn:
    - files:
        docs/dep.md: loc-DEP
  https://docs.com/restore4#master:
    - files:
outputs:
  docs/dep.json: |
    {"conceptual": "<p>loc-DEP-sxs</p>"}
---
# loc docset share the source docset's restore map 1
# [repository mapping]
repos:
  https://github.com/d/restore5.zh-cn#master:
    - files:
        docfx.yml: |
          xref: xrefmap.json
          dependencies:
            child1: https://docs.com/d/restore5
        a.md: |
          @System.String [!include[](~/child1/d.md)]
  https://github.com/d/restore5#master:
    - files:
        xrefmap.json: |
          { "references": [{ "uid": "System.String", "name": "String", "href": "//docs.com" }] }
  https://docs.com/d/restore5:
    - files:
        d.md: d
outputs:
  a.json: |
    { "conceptual":"<p><a href=\"//docs.com\">String</a> d </p>" }
---
# loc docset share the source docset's restore map 2
# [branch mapping] & bilingual
repos:
  https://github.com/d/restore6.loc#master-sxs.zh-cn:
    - files:
        docfx.yml: |
          localization:
            bilingual: true
            mapping: Branch
          xref: xrefmap.json
          dependencies:
            child1: https://docs.com/d/restore6
        a.md: |
          @System.String [!include[](~/child1/d.md)]
  https://github.com/d/restore6#master:
    - files:
        xrefmap.json: |
          { "references": [{ "uid": "System.String", "name": "String", "href": "//docs.com" }] }
  https://github.com/d/restore6.loc#master.zh-cn:
    - files:
        a.md: '@System.String'
  https://docs.com/d/restore6#master:
    - files:
        d.md: d
outputs:
  a.json: |
    { "conceptual":"<p><a href=\"//docs.com\">String</a> d </p>" }
---
# edit url convention without source locale 1
# [repository mapping] 
repos: 
  https://docfx.com/edit-url1.zh-cn#live:
    - files:
        docfx.yml: |
          contribution:
            repository: https://github.com/dotnet/docfx
        docs/a.md:
  https://docfx.com/edit-url1#live:
    - files:
outputs:
  docs/a.json: |
    { "content_git_url": "*dotnet/docfx.zh-cn/blob/live/*"}
---
# edit url convention without source locale 2
# [branch mapping]
repos: 
  https://docfx.com/edit-url2.loc#live.zh-cn:
    - files:
        docfx.yml: |
          localization:
            mapping: Branch
          contribution:
            repository: https://github.com/dotnet/docfx
        docs/a.md:
  https://docfx.com/edit-url2#live:
    - files:
outputs:
  docs/a.json: |
    { "content_git_url": "*dotnet/docfx.loc/blob/live.zh-cn*"}
---
# edit url convention with source locale 1
# [repository mapping]
repos: 
  https://docfx.com/edit-url3.zh-cn#live:
    - files:
        docfx.yml: |
          contribution:
            repository: https://github.com/dotnet/docfx.en-us
        docs/a.md:
  https://docfx.com/edit-url3#live:
    - files:
outputs:
  docs/a.json: |
    { "content_git_url": "*dotnet/docfx.en-us.zh-cn/blob/live/*"}
---
# edit url convention with source locale 2
# all loc files are in one repo under different branch
# [branch mapping]
repos: 
  https://docfx.com/edit-url4.loc#live.zh-cn:
    - files:
        docfx.yml: |
          contribution:
            repository: https://github.com/dotnet/docfx
          localization:
            mapping: Branch
        docs/a.md:
  https://docfx.com/edit-url4#live:
    - files:
outputs:
  docs/a.json: |
    { "content_git_url": "*dotnet/docfx.loc/blob/live.zh-cn/docs/*"}
---
# edit url convention with branch
# all loc files are in one repo under different branch
# [branch mapping] & bilingual
repos:
  https://docfx.com/edit-url5.loc#live-sxs.zh-cn:
    - files:
        docfx.yml: |
          contribution:
            repository: https://github.com/dotnet/docfx#master
          localization:
            mapping: Branch
        docs/a.md:
  https://docfx.com/edit-url5.loc#live.zh-cn:
    - files:
        docs/a.md:
  https://docfx.com/edit-url5#live:
    - files:
outputs:
  docs/a.json: |
    { "content_git_url": "*dotnet/docfx.loc/blob/master.zh-cn/docs/*"}
---
# loc file contributor info 1
# [repository mapping]
repos: 
  https://github.com/c/contribution1.zh-cn#master:
    - files:
        docfx.yml:
        docs/a.md:
  https://github.com/c/contribution1#master:
    - files:
outputs:
  docs/a.json: |
    { "content_git_url":"https://github.com/c/contribution1.zh-cn/blob/master/docs/a.md","original_content_git_url":"https://github.com/c/contribution1.zh-cn/blob/master/docs/a.md", "gitcommit":"https://github.com/c/contribution1.zh-cn/blob/81c533a0b7cc78260c82fb4e3b878f66158a9aca/docs/a.md"}
---
# loc file contributor info 3
# [branch mapping]
repos: 
  https://github.com/c/contribution3.loc#master.zh-cn:
    - files:
        docfx.yml: |
          localization:
            mapping: Branch
        docs/a.md:
  https://github.com/c/contribution3#master:
    - files:
outputs:
  docs/a.json: |
    { "content_git_url":"https://github.com/c/contribution3.loc/blob/master.zh-cn/docs/a.md","original_content_git_url":"https://github.com/c/contribution3.loc/blob/master.zh-cn/docs/a.md", "gitcommit":"https://github.com/c/contribution3.loc/blob/920e86f61c36833c2bde899880f15329a5ecdfaf/docs/a.md"}
---
# loc file contributor info 4
# [repository mapping] & bilingual
repos: 
  https://github.com/c/contribution4.zh-cn#master-sxs:
    - files:
        docfx.yml: |
          localization:
            bilingual: true
        docs/a.md:
  https://github.com/c/contribution4#master:
    - files:
  https://github.com/c/contribution4.zh-cn#master:
    - files:
        docs/a.md:
outputs:
  docs/a.json: |
    { "content_git_url":"https://github.com/c/contribution4.zh-cn/blob/master/docs/a.md","original_content_git_url":"https://github.com/c/contribution4.zh-cn/blob/master-sxs/docs/a.md", "gitcommit":"https://github.com/c/contribution4.zh-cn/blob/812100656057e8d5916a844565a7a9ef79462152/docs/a.md"}
---
# loc file contributor info 5
# [branch mapping] & bilingual
repos: 
  https://github.com/c/contribution5.loc#master-sxs.zh-cn:
    - files:
        docfx.yml: |
          localization:
            bilingual: true
            mapping: Branch
        docs/a.md:
  https://github.com/c/contribution5.loc#master.zh-cn:
    - files:
        docs/a.md:
  https://github.com/c/contribution5#master:
    - files:
outputs:
  docs/a.json: |
    { "content_git_url":"https://github.com/c/contribution5.loc/blob/master.zh-cn/docs/a.md","original_content_git_url":"https://github.com/c/contribution5.loc/blob/master-sxs.zh-cn/docs/a.md", "gitcommit":"https://github.com/c/contribution5.loc/blob/16537a7ca422b81ba2e1a97b6f58bf3a6c5890cf/docs/a.md"}
---
# loc page link and content fallback 1
# [repository mapping]
repos:
  https://docs.com/page-fallback1.zh-cn#master:
    - files:
        docfx.yml:
        docs/a.md: |
          [link in b](b.md)
          [!include[](b.md)]
  https://docs.com/page-fallback1#master:
    - files:
        docs/b.md: |
          [link in a](a.md)
outputs:
  docs/a.json: |
    { "conceptual":"<p><a href=\"b\">link in b</a></p>\n<p><a href=\"a\">link in a</a></p>\n"}
---
# loc page link and content fallback 2
# [branch mapping]
repos:
  https://docs.com/page-fallback2.loc#master.zh-cn:
    - files:
        docfx.yml: |
          localization:
            mapping: Branch
        docs/a.md: |
          [link in b](b.md)
          [!include[](b.md)]
  https://docs.com/page-fallback2#master:
    - files:
        docs/b.md: |
          [link in a](a.md)
outputs:
  docs/a.json: |
    { "conceptual":"<p><a href=\"b\">link in b</a></p>\n<p><a href=\"a\">link in a</a></p>\n"}
---
# loc page link and content fallback 3
# [branch mapping] & bilingual
repos:
  https://docs.com/page-fallback3.loc#master-sxs.zh-cn:
    - files:
        docfx.yml: |
          localization:
            mapping: Branch
            bilingual: true
        docs/a.md: |
          [link in b](b.md)
          [!include[](b.md)]
  https://docs.com/page-fallback3.loc#master.zh-cn:
    - files:
        docs/a.md:
  https://docs.com/page-fallback3#master:
    - files:
        docs/b.md: |
          [link in a](a.md)
outputs:
  docs/a.json: |
    { "conceptual":"<p><a href=\"b\">link in b</a></p>\n<p><a href=\"a\">link in a</a></p>\n"}
---
# loc resource fallback 1
# [repository mapping]
repos:
  https://docs.com/resource-fallback1.zh-cn#master:
    - files:
        docfx.yml:
        docs/a.md: |
          [link to b](b.png)
  https://docs.com/resource-fallback1#master:
    - files:
        docs/b.png:
outputs:
  docs/a.json: |
    { "conceptual":"<p><a href=\"b.png\">link to b</a></p>"}
---
# loc resource fallback 2
# [branch mapping]
repos:
  https://docs.com/resource-fallback2.loc#live.zh-cn:
    - files:
        docfx.yml: |
          localization:
            mapping: Branch
        docs/a.md: |
          [link to b](b.png)
  https://docs.com/resource-fallback2#live:
    - files:
        docs/b.png:
outputs:
  docs/a.json: |
    { "conceptual":"<p><a href=\"b.png\">link to b</a></p>"}
---
# loc resource fallback 3
# [repository mapping] & bilingual
repos:
  https://docs.com/resource-fallback3.zh-cn#master-sxs:
    - files:
        docfx.yml: |
          localization:
            bilingual: true
        docs/a.md: |
          [link to b](b.png)
  https://docs.com/resource-fallback3.zh-cn#master:
    - files:
        docs/a.md:
  https://docs.com/resource-fallback3#master:
    - files:
        docs/b.png:
outputs:
  docs/a.json: |
    { "conceptual":"<p><a href=\"b.png\">link to b</a></p>"}
---
# loc build with TOC map, loc TOC has higher priority
repos:
  https://docs.com/toc1.zh-cn#master:
    - files:
        docfx.yml:
        docs/a.md:
        docs/b.md:
        docs/TOC.md: |
          # [reference a](a.md)
          # [reference b](b.md)
  https://docs.com/toc1#master:
    - files:
        docs/TOC.md: |
          # [reference a](a.md)
        docs/b/TOC.md: |
          # [reference b](../b.md)
outputs:
  docs/a.json: |
    {"_tocRel": "toc.json"}
  docs/b.json: |
    {"_tocRel": "toc.json"}
  docs/toc.json: |
    {"items": [{"name": "reference a", "href": "a"},{"name": "reference b", "href": "b"}]}
---
# loc build with mixed toc map
repos:
  https://docs.com/toc2.zh-cn#master:
    - files:
        docfx.yml:
        docs/a/TOC.md: |
          # [reference a](a.md)
        docs/b/b.md:
  https://docs.com/toc2#master:
    - files:
        docs/a/a.md:
        docs/b/TOC.md: |
          # [reference b](b.md)
outputs:
  docs/b/b.json: |
    {"_tocRel": "toc.json"}
  docs/a/toc.json: |
    {"items": [{"name": "reference a", "href": "a"}]}
---
# loc build with xref map, loc file has higher priority
repos:
  https://docs.com/xref1.zh-cn#master:
    - files:
        docfx.yml:
        docs/a.md: |
          ---
          uid: a
          ---
        docs/b.md: |
          link to @c
  https://docs.com/xref1#master:
    - files:
        docs/a.md: |
          ---
          uid: c
          ---
outputs:
  docs/a.json:
  docs/b.json:
---
# loc build with mixed xref map
repos:
  https://docs.com/xref2.zh-cn#master:
    - files:
        docfx.yml:
        docs/a.md: |
          ---
          uid: a
          ---
        docs/b.md: |
          link to @a
          link to @c
  https://docs.com/xref2#master:
    - files:
        docs/c.md: |
          ---
          uid: c
          ---
outputs:
  docs/a.json:
  docs/b.json: |
    {"conceptual":"<p>link to <a href=\"a\">a</a>\nlink to <a href=\"c\">c</a></p>\n"}
  .xrefmap.json: |
    {"references":[{"uid":"a","href":"https://docs.com/docs/a?branch=master","name":"a"},{"uid":"c","href":"https://docs.com/docs/c?branch=master","name":"c"}]}
---
# built metadata for loc files 1
repos:
  https://docs.com/metadata1.zh-cn#master:
    - files:
        docfx.yml: |
          baseUrl: https://docs.microsoft.com
        docs/a.md:
  https://docs.com/metadata1#master:
    - files:
outputs:
  docs/a.json: |
    {"locale": "zh-cn", "canonical_url": "https://docs.microsoft.com/zh-cn/docs/a", "document_id": "fa697b4e-3e52-77f6-2219-39040f6070da", "document_version_independent_id": "7c88e748-ed5e-a29a-c057-6f89857c3591",}
---
# built metadata for loc files 2
# all loc files are in same repo under different branch
repos:
  https://docs.com/metadata2.loc#live.zh-cn:
    - files:
        docfx.yml: |
          baseUrl: https://docs.microsoft.com
          localization:
            mapping: Branch
        docs/a.md:
  https://docs.com/metadata2#live:
    - files:
outputs:
  docs/a.json: |
    {"locale": "zh-cn", "canonical_url": "https://docs.microsoft.com/zh-cn/docs/a", "document_id": "fa697b4e-3e52-77f6-2219-39040f6070da", "document_version_independent_id": "7c88e748-ed5e-a29a-c057-6f89857c3591"}
---
# built metadata for loc files 4
# all loc files are in same repo under different branch
# bilingual
repos:
  https://docs.com/metadata4.loc#master.zh-cn:
    - files:
        docfx.yml: |
          baseUrl: https://docs.microsoft.com
          localization:
            mapping: Branch
            bilingual: true
        docs/a.md:
  https://docs.com/metadata4.loc#master-sxs.zh-cn:
    - files:
        docs/a.md:
  https://docs.com/metadata4#master:
    - files:
outputs:
  docs/a.json: |
    {"locale": "zh-cn", "canonical_url": "https://docs.microsoft.com/zh-cn/docs/a", "document_id": "fa697b4e-3e52-77f6-2219-39040f6070da", "document_version_independent_id": "7c88e748-ed5e-a29a-c057-6f89857c3591"}
---
# bilingual build 1
# [repository mapping]
repos:
  https://github.com/ss/c.zh-cn#master-sxs:
    - files:
        docfx.yml: |
          localization:
            bilingual: true
        docs/a.md: |
          sxs content
          [link to b](b.md)
          [!include[include b](b.md)]
  https://github.com/ss/c.zh-cn#master:
    - files:
        docs/a.md:
  https://github.com/ss/c:
    - files:
        docs/b.md: |
          [link to a](a.md)
        docs/a.md: a
outputs:
  docs/a.json: |
    {
      "conceptual": "
        <p>sxs content\n<a href=\"b\">link to b</a></p>\n<p><a href=\"a\">link to a</a></p>\n",
      "enable_loc_sxs": true
    }
---
# bilingual build 2
# [branch mapping]
repos:
  https://github.com/ss/a.loc#master-sxs.zh-cn:
    - files:
        docfx.yml: |
          localization:
            mapping: Branch
            bilingual: true
        docs/a.md: |
          sxs content
          [link to b](b.md)
          [!include[include b](b.md)]
  https://github.com/ss/a.loc#master.zh-cn:
    - files:
        docs/a.md: a
  https://github.com/ss/a:
     - files:
         docs/b.md: |
           [link to a](a.md)
         docs/a.md: abc
outputs:
  docs/a.json: |
    {"conceptual":"<p>sxs content\n<a href=\"b\">link to b</a></p>\n<p><a href=\"a\">link to a</a></p>\n", "enable_loc_sxs": true}
---
# bilingual page's contributor info is extracted from non-sxs branch
# loc repo:
#   loc-bilingual branch(sxs branch):
#     zh-cn/docs/a.md(modified by A and B)
#   loc-bilingual-sxs branch(non-sxs branch):
#     zh-cn/docs/a.md(modified by B and C)
# for above case, the a.md's contributors are A and B
repos:
  https://github.com/ss/b.loc#master-sxs.zh-cn:
    - files:
        docfx.yml: |
          localization:
            mapping: Branch
            bilingual: true
        docs/a.md: a
      author: Alice
      email: alice@contoso.com
  https://github.com/ss/b.loc#master.zh-cn:
    - files:
        docs/a.md: ab
      author: Bob
      email: bob@contoso.com
    - files:
        docs/a.md: cd
      author: Terry
      email: terry@contoso.com
  https://github.com/ss/b:
    - files:
cache:
  github-users.json: |
    { "users": [
        {"name": "Alice", "login": "alice", "id": 1, "emails": ["alice@contoso.com"]},
        {"name": "Bob", "login": "bob", "id": 2, "emails": ["bob@contoso.com"]},
        {"name": "Terry", "login": "terry", "id": 3, "emails": ["terry@contoso.com"]},
      ]
    }
outputs:
  docs/a.json: |
    {
      "_op_gitContributorInformation":
      {
        "author":{"display_name":"Terry","id": "3"},
        "contributors":[{"display_name":"Bob","id":"2"}],
      },
      "enable_loc_sxs": true}
---
# bilingual page's `gitcommit` url follows sxs content's commit history
repos:
  https://github.com/bilingual/a.zh-cn#master-sxs:
    - files:
        docfx.yml: |
          localization:
            bilingual: true
        docs/a.md: |
          loc sxs content
  https://github.com/bilingual/a.zh-cn#master:
    - files:
        docs/a.md: |
          loc content
  https://github.com/bilingual/a:
    - files:
        docs/a.md: a
outputs:
  docs/a.json: |
    {"gitcommit":"https://github.com/bilingual/a.zh-cn/blob/427086f2a28561ea018e74d0d95e99ab63399cc7/docs/a.md"}
---
# conflicted toc files(source and loc)
# 1. should not report warning
# 2. `_tocRel` should be resolved to loc toc
repos:
  https://github.com/conflictedtoc/a.zh-cn:
    - files:
        docfx.yml:
        docs/a/TOC.yml: |
          - href: a.md
            name: yml reference a
        docs/a/a.md:
  https://github.com/conflictedtoc/a:
    - files:
        docs/a/TOC.md: |
          # [md reference a](a.md)
outputs:
  docs/a/a.json: |
    {"_tocRel": "toc.json"}
  docs/a/toc.json: |
    {"items":[{"name": "yml reference a"}]}
---
# fallback to deleted token/codesnippet
repos:
  https://github.com/deletedtoken/a.zh-cn:
    - files:
        docfx.yml:
        docs/a.md: |
          [!include[include deleted tokena](tokena.md)]
  https://github.com/deletedtoken/a:
    - files:
      author: a
    - files:
        docs/tokena.md: |
          [!include[include deleted tokenb](tokenb.md)]
          [!code-csharp[Main](program.cs)]
        docs/tokenb.md: b
        docs/program.cs:
      author: b
outputs:
  docs/a.json: |
    {"conceptual":"<p>b</p>\n<pre><code class=\"lang-csharp\" name=\"Main\"></code></pre>"}
  .dependencymap.json: |
    {"dependencies": {"docs/tokena.md": undefined}}
---
# fallback to deleted resource
repos:
  https://github.com/deletedres/a.zh-cn:
    - files:
        docfx.yml:
        docs/a.md: |
          [link to deleted resource](resource.png)
          [link to deleted markdown doesnt work](b.md)
  https://github.com/deletedres/a:
    - files:
      author: a
    - files:
        docs/resource.png:
        docs/b.md:
      author: b
outputs:
  docs/a.json: |
    {"conceptual":"<p><a href=\"resource.png\">link to deleted resource</a>\n<a href=\"b.md\">link to deleted markdown doesnt work</a></p>\n"}
  .errors.log: |
    ["warning","file-not-found","Invalid file link: 'b.md'.","docs/a.md",2,1]
  .dependencymap.json: |
    {"dependencies":{"docs/a.md":[{"source":"docs/resource.png","type":"link"}]}}
---
# fallback to deleted toc
repos:
  https://github.com/deletedtoc/a.zh-cn:
    - files:
        docfx.yml:
        docs/b/TOC.yml: |
          - href: ../a/TOC.yml
            name: reference toc a
        docs/a/a.md:
  https://github.com/deletedtoc/a:
    - files:
      author: a
    - files:
        docs/a/TOC.yml: |
          - href: a.md
            name: reference markdown a
      author: b
outputs:
  docs/a/a.json:
  docs/b/toc.json: |
    {"items":[{"name":"reference toc a","items":[{"name":"reference markdown a","href":"../a/a"}]}]}
---
# fallback to deleted toc only works for localization docset build
repos:
  https://github.com/onlyloc/a:
    - files:
        docfx.yml:
        docs/b/TOC.yml: |
          - href: ../a/TOC.yml
            name: reference toc a
        docs/a/a.md:
      author: a
    - files:
        docfx.yml:
        docs/a/TOC.yml: |
          - href: a.md
            name: reference markdown a
      author: b
outputs:
  docs/a/a.json:
  docs/b/toc.json: |
    {"items":[{"name":"reference toc a"}]}
---
# fallback to deleted token/codesnippet/resource only works for loc docset build
repos:
  https://github.com/onlyloc/b:
    - files:
        docfx.yml:
        docs/a.md: |
          [!include[include deleted tokena](tokena.md)]
          [link to deleted resource](resource.png)
    - files:
        docfx.yml:
        docs/tokena.md: |
          [!include[include deleted tokenb](tokenb.md)]
          [!code-csharp[Main](program.cs)]
        docs/tokenb.md: b
        docs/program.cs:
        docs/resource.png:
outputs:
  docs/a.json:
  .errors.log: |
    ["warning","file-not-found","Invalid file link: 'resource.png'.","docs/a.md",2,1]
    ["warning","include-not-found","Cannot resolve 'tokena.md' relative to 'docs/a.md'.","docs/a.md",1,1]
---
# fallback to inclusion parent toc
repos:
  https://github.com/inclusiontoc/a.zh-cn:
    - files:
        docfx.yml:
        docs/a/TOC.yml: |
          - href: a.md
            name: reference markdown a
        docs/a/a.md:
        docs/a/b.md:
  https://github.com/inclusiontoc/a:
    - files:
        docs/b/TOC.yml: |
          - href: ../a/TOC.yml
            name: reference toc a
        docs/a/TOC.yml: |
          - href: b.md
            name: reference markdown b
outputs:
  docs/a/a.json:
  docs/a/b.json:
  docs/b/toc.json: |
    {"items":[{"name":"reference toc a","items":[{"name":"reference markdown a","href":"../a/a"}]}]}
---
# loc build gets restored files
# from current docset firestly, then from fallback docset if has
repos:
  https://github.com/buildhistory/a.zh-cn:
    - files:
        docfx.yml: |
          monikerDefinition: monikers.json
        docs/a.md:
  https://github.com/buildhistory/a:
    - files:
        docs/a.md:
        monikers.json: |
          {}
outputs:
  docs/a.json:
---
# loc build gets docfx config 1
# from current docset firstly, then from fallback docset
# [repo mapping]
repos:
  https://github.com/locconfig/a.zh-cn:
    - files:
        docs/a.md:
        docfx.yml: |
          contribution:
            repository: https://github.com/dotnet/docfx.zh-cn
  https://github.com/locconfig/a:
    - files:
        docfx.yml: |
          contribution:
            repository: https://github.com/dotnet/docfx
        docs/a.md:
outputs:
  docs/a.json: |
    { "content_git_url": "*dotnet/docfx.zh-cn/blob/master/*"}
---
# loc build gets docfx config 2
# from current docset firstly, then from fallback docset
# [branch mapping]
repos:
  https://github.com/locconfig/b.loc#master.zh-cn:
    - files:
        docs/a.md:
        docfx.yml: |
          contribution:
            repository: https://github.com/dotnet/docfx.loc#live
          localization:
            mapping: Branch
  https://github.com/locconfig/b:
    - files:
        docfx.yml: |
          contribution:
            repository: https://github.com/dotnet/docfx#live
          localization:
            mapping: Branch
        docs/a.md:
outputs:
  docs/a.json: |
    { "content_git_url": "*dotnet/docfx.loc/blob/live.zh-cn/*"}
---
# loc build gets docfx config 3
# from current docset firstly, then from fallback docset
# [repo mapping] & bilingual
repos:
  https://github.com/locconfig/c.zh-cn#master-sxs:
    - files:
        docs/a.md:
        docfx.yml: |
          contribution:
            repository: https://github.com/dotnet/docfx.zh-cn
          localization:
            bilingual: true
  https://github.com/locconfig/c:
    - files:
        docfx.yml: |
          contribution:
            repository: https://github.com/dotnet/docfx
          localization:
            bilingual: true
        docs/a.md:
  https://github.com/locconfig/c.zh-cn:
    - files:
        docs/a.md:
outputs:
  docs/a.json: |
    { "content_git_url": "*dotnet/docfx.zh-cn/blob/master/*"}
---
# loc build gets docfx config 4
# from current docset firstly, then from fallback docset
# [branch mapping] & bilingual
repos:
  https://github.com/locconfig/d.loc#master-sxs.zh-cn:
    - files:
        docs/a.md:
        docfx.yml: |
          contribution:
            repository: https://github.com/dotnet/docfx.loc#live
          localization:
            mapping: Branch
            bilingual: true
  https://github.com/locconfig/d:
    - files:
        docfx.yml: |
          contribution:
            repository: https://github.com/dotnet/docfx#live
          localization:
            mapping: Branch
            bilingual: true
        docs/a.md:
  https://github.com/locconfig/d.loc#master.zh-cn:
    - files:
        docs/a.md:
outputs:
  docs/a.json: |
    { "content_git_url": "*dotnet/docfx.loc/blob/live.zh-cn/*"}
---
# loc build with different dependency git repository 1
# [repo mapping] & bilingual
repos:
  https://github.com/locconfig2/c.zh-cn#master-sxs:
    - files:
        docs/a.md: |
          [!include[include child](~/child1/token.md)]
        docfx.yml: |
          dependencies:
            child1: https://github.com/locconfig2/d#live
          localization:
            bilingual: true
  https://github.com/locconfig2/c:
    - files:
        docfx.yml: |
          dependencies:
            child1: https://github.com/locconfig2/d#master
          localization:
            bilingual: true
          "locales: [zh-cn]":
            dependencies:
              child1: https://github.com/locconfig2/d#live
        docs/a.md:
  https://github.com/locconfig2/c.zh-cn:
    - files:
        docs/a.md:
  https://github.com/locconfig2/d#live:
    - files:
        token.md: |
          live branch
  https://github.com/locconfig2/d#master:
    - files:
        token.md: |
          master branch
outputs:
  docs/a.json: |
    { "conceptual": "<p>live branch</p>\n" }
---
# loc build with different dependency git repository 2
# [branch mapping] & bilingual
repos:
  https://github.com/locconfig3/c.loc#master-sxs.zh-cn:
    - files:
        docs/a.md: |
          [!include[include child](~/child1/token.md)]
        docfx.yml: |
          dependencies:
            child1: https://github.com/locconfig3/f#live
          localization:
            bilingual: true
            mapping: Branch
  https://github.com/locconfig3/c:
    - files:
        docfx.yml: |
          dependencies:
            child1: https://github.com/locconfig3/f#master
          localization:
            bilingual: true
            mapping: Branch
          "locales: [zh-cn]":
            dependencies:
              child1: https://github.com/locconfig3/f#live
        docs/a.md:
  https://github.com/locconfig3/c.loc#master.zh-cn:
    - files:
        docs/a.md:
  https://github.com/locconfig3/f#live:
    - files:
        token.md: |
          live branch
  https://github.com/locconfig3/f#master:
    - files:
        token.md: |
          master branch
outputs:
  docs/a.json: |
    { "conceptual": "<p>live branch</p>\n" }
---
# Apply &lrm; for right to left languages
repos:
  https://docs.com/lrm.ar-sa#master:
    - files:
        docfx.yml:
        docs/a.md: |
          Learn c#.
  https://docs.com/lrm#master:
    - files:
outputs:
  docs/a.json: |
    { "conceptual": "<p>Learn c#&lrm;.</p>" }
---
# VSTS localized repo with branch mapping
repos:
  https://docascode.visualstudio.com/branch/_git/a.loc#live.zh-cn:
    - files:
        docfx.yml: |
          localization:
            mapping: Branch
        docs/a.md: |
          [link in b](b.md)
          [!include[](b.md)]
  https://docascode.visualstudio.com/branch/_git/a#live:
    - files:
        docs/b.md: |
          [link in a](a.md)
outputs:
  docs/a.json: |
    { "conceptual":"<p><a href=\"b\">link in b</a></p>\n<p><a href=\"a\">link in a</a></p>\n"}
---
# VSTS localized repo with branch mapping & bilingual
repos:
  https://docascode.visualstudio.com/branch/_git/b.loc#live-sxs.zh-cn:
    - files:
        docfx.yml: |
          localization:
            mapping: Branch
            bilingual: true
        docs/a.md: |
          [link in b](b.md)
          [!include[](b.md)]
  https://docascode.visualstudio.com/branch/_git/b.loc#live.zh-cn:
    - files:
        docs/a.md: "not used"
  https://docascode.visualstudio.com/branch/_git/b#live:
    - files:
        docs/b.md: |
          [link in a](a.md)
outputs:
  docs/a.json: |
    { "conceptual":"<p><a href=\"b\">link in b</a></p>\n<p><a href=\"a\">link in a</a></p>\n"}
---
# VSTS localized repo with repo mapping
repos:
  https://docascode.visualstudio.com/repo/_git/a.zh-cn#live:
    - files:
        docfx.yml:
        docs/a.md: |
          [link in b](b.md)
          [!include[](b.md)]
  https://docascode.visualstudio.com/repo/_git/a#live:
    - files:
        docs/b.md: |
          [link in a](a.md)
outputs:
  docs/a.json: |
    { "conceptual":"<p><a href=\"b\">link in b</a></p>\n<p><a href=\"a\">link in a</a></p>\n"}
---
# VSTS localized repo with repo mapping & bilingual
repos:
  https://docascode.visualstudio.com/repo/_git/b.zh-cn#live-sxs:
    - files:
        docfx.yml: |
          localization:
            bilingual: true
        docs/a.md: |
          [link in b](b.md)
          [!include[](b.md)]
  https://docascode.visualstudio.com/repo/_git/b.zh-cn#live:
    - files:
        docs/a.md: "not used"
  https://docascode.visualstudio.com/repo/_git/b#live:
    - files:
        docs/b.md: |
          [link in a](a.md)
outputs:
  docs/a.json: |
    { "conceptual":"<p><a href=\"b\">link in b</a></p>\n<p><a href=\"a\">link in a</a></p>\n"}
---
# fallback to never existing token in multiple files
repos:
  https://github.com/neverexist/a.zh-cn:
    - files:
        docfx.yml:
        docs/1.md: |
          [!include[include deleted tokena](tokenx.md)]
        docs/2.md: |
          [!include[include deleted tokena](tokenx.md)]
        docs/3.md: |
          [!include[include deleted tokena](tokenx.md)]
  https://github.com/neverexist/a:
    - files:
      author: a
outputs:
  docs/1.json:
  docs/2.json:
  docs/3.json:
  .errors.log:
---
# fallback to corresponding source branch 1
# [repo mapping]
repos:
  https://docs.com/branch-fallback1.zh-cn#test:
    - files:
        docfx.yml:
        docs/a.md: |
          [!include[](b.md)]
  https://docs.com/branch-fallback1#test:
    - files:
        docs/b.md: |
          test
  https://docs.com/branch-fallback1#master:
    - files:
        docs/b.md: |
          master
outputs:
  docs/a.json: |
    { "conceptual":"<p>test</p>"}
---
# fallback to corresponding source branch 2
# [repo mapping & bilingual]
repos:
  https://docs.com/branch-fallback2.zh-cn#test-sxs:
    - files:
        docfx.yml: |
          localization:
            bilingual: true
        docs/a.md: |
          [!include[](b.md)]
  https://docs.com/branch-fallback2#test:
    - files:
        docs/b.md: |
          test
  https://docs.com/branch-fallback2#master:
    - files:
        docfx.yml:
        docs/b.md: |
          master
  https://docs.com/branch-fallback2.zh-cn#test:
    - files:
        docs/a.md:
outputs:
  docs/a.json: |
    { "conceptual":"<p>test</p>"}
---
# fallback to master if corresponding source branch doesn't exists
# [branch mapping]
repos:
  https://docs.com/branch-fallback3.loc#test.zh-cn:
    - files:
        docfx.yml:
        docs/a.md: |
          [!include[](b.md)]
  https://docs.com/branch-fallback3#master:
    - files:
        docs/b.md: master
outputs:
  docs/a.json: |
    { "conceptual":"<p>master</p>"}
---
# Do not validate bookmark for fallback content
repos:
  https://docs.com/fallback-content-bookmark-validation.zh-cn#master:
    - files:
        docfx.yml:
        b.md: '[](a.md#invalid-bookmark)'
  https://docs.com/fallback-content-bookmark-validation#master:
    - files:
        a.md:
outputs:
  b.json:
