# restore loc repo with dependencies 1
# [repository mapping] 
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/restore1#master:
    - files:
        docfx.yml: |
          dependencies:
            restore-child: https://docs.com/restore1#child
  https://docs.com/restore1#child:
    - files:
        docs/child.md:
  https://docs.com/restore1.zh-cn#master:
    - files:
        docs/loc.md: |
          [link to restore-child](~/restore-child/docs/child.md)
outputs:
  docs/loc.json:
  .errors.log: |
    ["warning","link-is-dependency","File 'docs/child.md' referenced by link '~/restore-child/docs/child.md' will not be built because it is from a dependency docset","docs/loc.md",1,1]
---
# restore loc repo with dependencies 2
# [repository mapping & bilingual]
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/restore2#master:
    - files:
        docfx.yml: |
          localization:
            bilingual: true
          dependencies:
            restore-child: https://docs.com/restore2#child
  https://docs.com/restore2.zh-cn#master-sxs:
    - files:
        docs/loc.md: |
          [link to restore-child](~/restore-child/docs/child.md)
  https://docs.com/restore2.zh-cn#master:
    - files:
        docs/loc.md:
  https://docs.com/restore2#child:
    - files:
        docs/child.md:
outputs:
  docs/loc.json:
  .errors.log: |
    ["warning","link-is-dependency","File 'docs/child.md' referenced by link '~/restore-child/docs/child.md' will not be built because it is from a dependency docset","docs/loc.md",1,1]
---
# restore loc repo without dependencies 1
# [branch mapping]
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/restore3#master:
    - files:
        docfx.yml: |
          localization:
            mapping: Branch
  https://docs.com/restore3.loc#master.zh-cn:
    - files:
        docs/dep.md: loc-DEP
outputs:
  docs/dep.json:
---
# restore loc repo  without dependencies 2
# [branch mapping & bilingual]
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/restore4#master:
    - files:
        docfx.yml: |
          localization:
            mapping: Branch
            bilingual: true
  https://docs.com/restore4.loc#master-sxs.zh-cn:
    - files:
        docs/dep.md: loc-DEP-sxs
  https://docs.com/restore4.loc#master.zh-cn:
    - files:
        docs/dep.md: loc-DEP
outputs:
  docs/dep.json: |
    {"content": "<p>loc-DEP-sxs</p>"}
---
# loc docset share the source docset's restore map 1
# [repository mapping]
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://github.com/d/restore5#master:
    - files:
        docfx.yml: |
          gitHub:
            userCache: github-user.json
            resolveUsers: true
          dependencies:
            child1: https://docs.com/d/restore5
        github-user.json: |
          {
            "users": [
              {
                "name": "Osmond Jiang",
                "login": "OsmondJiang",
                "id": 19990166,
                "expiry":"2099-01-01T00:00:00.00000Z",
                "emails": [
                  "xinjiang@microsoft.com"
                ]
              },
              {
                "name": "Renze Yu",
                "login": "superyyrrzz",
                "id": 3831744,
                "expiry":"2099-01-01T00:00:00.00000Z",
                "emails": [
                  "renzeyu@microsoft.com",
                  "superyyrrzz@gmail.com"
                ]
              },
              {
                "name": "Yufei Huang",
                "login": "yufeih",
                "id": 511355,
                "expiry":"2099-01-01T00:00:00.00000Z",
                "emails": [
                  "yufeih@users.noreply.github.com",
                  "yufeih@live.com"
                ]
              }
            ]
          }
  https://github.com/d/restore5.zh-cn#master:
    - files:
        docs/a.md: |
          [!include[](~/child1/docs/d.md)]
      author: yufeih
      email: yufeih@live.com
    - files:
        docs/a.md: a
      author: OsmondJiang
      email: xinjiang@microsoft.com
  https://docs.com/d/restore5:
    - files:
        docs/d.md: d
outputs:
  docs/a.json: |
    {
      "content":"<p>d</p>\n",
      "_op_gitContributorInformation":
      {
        "author":
          {"display_name":"Osmond Jiang","id":"19990166"},
        "contributors":
          [{"display_name":"Yufei Huang","id":"511355"}],
      }
    }
---
# loc docset share the source docset's restore map 2
# [branch mapping] & bilingual
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://github.com/d/restore6#master:
    - files:
        docfx.yml: |
          localization:
            bilingual: true
            mapping: Branch
          gitHub:
            userCache: github-user.json
            resolveUsers: true
          dependencies:
            child1: https://docs.com/d/restore6
        github-user.json: |
          {
            "users": [
              {
                "name": "Osmond Jiang",
                "login": "OsmondJiang",
                "id": 19990166,
                "expiry":"2099-01-01T00:00:00.00000Z",
                "emails": [
                  "xinjiang@microsoft.com"
                ]
              },
              {
                "name": "Renze Yu",
                "login": "superyyrrzz",
                "id": 3831744,
                "expiry":"2099-01-01T00:00:00.00000Z",
                "emails": [
                  "renzeyu@microsoft.com",
                  "superyyrrzz@gmail.com"
                ]
              },
              {
                "name": "Yufei Huang",
                "login": "yufeih",
                "id": 511355,
                "expiry":"2099-01-01T00:00:00.00000Z",
                "emails": [
                  "yufeih@users.noreply.github.com",
                  "yufeih@live.com"
                ]
              }
            ]
          }
  https://github.com/d/restore6.loc#master-sxs.zh-cn:
    - files:
        docs/a.md: |
          [!include[](~/child1/docs/d.md)]
  https://github.com/d/restore6.loc#master.zh-cn:
    - files:
        docs/a.md: |
          [!include[](~/child1/docs/d.md)]
      author: yufeih
      email: yufeih@live.com
    - files:
        docs/a.md: a
      author: OsmondJiang
      email: xinjiang@microsoft.com
  https://docs.com/d/restore6:
    - files:
        docs/d.md: d
outputs:
  docs/a.json: |
    {
      "content":"<p>d</p>\n",
      "_op_gitContributorInformation":
      {
        "author":
          {"display_name":"Osmond Jiang","id":"19990166"},
        "contributors":
          [{"display_name":"Yufei Huang","id":"511355"}],
      }
    }
---
# edit url convention without source locale 1
# [repository mapping] 
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos: 
  https://docfx.com/edit-url1#live:
    - files:
        docfx.yml: |
          contribution:
            repository: https://github.com/dotnet/docfx
  https://docfx.com/edit-url1.zh-cn#live:
    - files:
        docs/a.md:
outputs:
  docs/a.json: |
    { "content_git_url": "*dotnet/docfx.zh-cn/blob/live/*"}
---
# edit url convention without source locale 2
# [branch mapping]
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos: 
  https://docfx.com/edit-url2#live:
    - files:
        docfx.yml: |
          localization:
            mapping: Branch
          contribution:
            repository: https://github.com/dotnet/docfx
  https://docfx.com/edit-url2.loc#live.zh-cn:
    - files:
        docs/a.md:
outputs:
  docs/a.json: |
    { "content_git_url": "*dotnet/docfx.loc/blob/live.zh-cn*"}
---
# edit url convention with source locale 1
# [repository mapping]
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos: 
  https://docfx.com/edit-url3#live:
    - files:
        docfx.yml: |
          contribution:
            repository: https://github.com/dotnet/docfx.en-us
  https://docfx.com/edit-url3.zh-cn#live:
    - files:
        docs/a.md:
outputs:
  docs/a.json: |
    { "content_git_url": "*dotnet/docfx.en-us.zh-cn/blob/live/*"}
---
# edit url convention with source locale 2
# all loc files are in one repo under different branch
# [branch mapping]
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos: 
  https://docfx.com/edit-url4#live:
    - files:
        docfx.yml: |
          contribution:
            repository: https://github.com/dotnet/docfx
          localization:
            mapping: Branch
  https://docfx.com/edit-url4.loc#live.zh-cn:
    - files:
        docs/a.md:
outputs:
  docs/a.json: |
    { "content_git_url": "*dotnet/docfx.loc/blob/live.zh-cn/docs/*"}
---
# edit url convention with source locale 3
# all loc files are in source repo under different locale folder
# [folder mapping]
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://github.com/folder-maping/a:
  - files:
      docfx.yml: |
        contribution:
          repository: https://github.com/dotnet/docfx.en-us
        localization:
          mapping: Folder
      localization/zh-cn/docs/a.md:
      docs/a.md:
outputs:
  docs/a.json: |
    { "content_git_url": "*dotnet/docfx.en-us/blob/master/*"}
---
# edit url convention with branch
# all loc files are in one repo under different branch
# [branch mapping] & bilingual
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docfx.com/edit-url5#live:
    - files:
        docfx.yml: |
          contribution:
            repository: https://github.com/dotnet/docfx#master
          localization:
            mapping: Branch
  https://docfx.com/edit-url5.loc#live-sxs.zh-cn:
    - files:
        docs/a.md:
  https://docfx.com/edit-url5.loc#live.zh-cn:
    - files:
        docs/a.md:
outputs:
  docs/a.json: |
    { "content_git_url": "*dotnet/docfx.loc/blob/master.zh-cn/docs/*"}
---
# loc file contributor info 1
# [repository mapping]
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos: 
  https://github.com/c/contribution1#master:
    - files:
        docfx.yml:
  https://github.com/c/contribution1.zh-cn#master:
    - files:
        docs/a.md:
outputs:
  docs/a.json: |
    { "content_git_url":"https://github.com/c/contribution1.zh-cn/blob/master/docs/a.md","original_content_git_url":"https://github.com/c/contribution1.zh-cn/blob/master/docs/a.md", "gitcommit":"https://github.com/c/contribution1.zh-cn/blob/f35b220adadfe88d1d4f1b043c8dc55db491c83e/docs/a.md"}
---
# loc file contributor info 2
# [folder mapping]
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://github.com/contribution/a#master3:
    - files:
        docfx.yml: |
          localization:
            mapping: Folder
        localization/zh-cn/docs/a.md:
outputs:
  docs/a.json: |
    { "content_git_url":"https://github.com/contribution/a/blob/master3/localization/zh-cn/docs/a.md","original_content_git_url":"https://github.com/contribution/a/blob/master3/localization/zh-cn/docs/a.md", "gitcommit":"https://github.com/contribution/a/blob/ffb8cfa5f33566a83770b90d647577a58e1d662d/localization/zh-cn/docs/a.md"}
---
# loc file contributor info 3
# [branch mapping]
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos: 
  https://github.com/c/contribution3#master:
    - files:
        docfx.yml: |
          localization:
            mapping: Branch
  https://github.com/c/contribution3.loc#master.zh-cn:
    - files:
        docs/a.md:
outputs:
  docs/a.json: |
    { "content_git_url":"https://github.com/c/contribution3.loc/blob/master.zh-cn/docs/a.md","original_content_git_url":"https://github.com/c/contribution3.loc/blob/master.zh-cn/docs/a.md", "gitcommit":"https://github.com/c/contribution3.loc/blob/f35b220adadfe88d1d4f1b043c8dc55db491c83e/docs/a.md"}
---
# loc file contributor info 4
# [repository mapping] & bilingual
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos: 
  https://github.com/c/contribution4#master:
    - files:
        docfx.yml: |
          localization:
            bilingual: true
  https://github.com/c/contribution4.zh-cn#master:
    - files:
        docs/a.md:
  https://github.com/c/contribution4.zh-cn#master-sxs:
    - files:
        docs/a.md:
outputs:
  docs/a.json: |
    { "content_git_url":"https://github.com/c/contribution4.zh-cn/blob/master/docs/a.md","original_content_git_url":"https://github.com/c/contribution4.zh-cn/blob/master-sxs/docs/a.md", "gitcommit":"https://github.com/c/contribution4.zh-cn/blob/f35b220adadfe88d1d4f1b043c8dc55db491c83e/docs/a.md"}
---
# loc file contributor info 5
# [branch mapping] & bilingual
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos: 
  https://github.com/c/contribution5#master:
    - files:
        docfx.yml: |
          localization:
            bilingual: true
            mapping: Branch
  https://github.com/c/contribution5.loc#master.zh-cn:
    - files:
        docs/a.md:
  https://github.com/c/contribution5.loc#master-sxs.zh-cn:
    - files:
        docs/a.md:
outputs:
  docs/a.json: |
    { "content_git_url":"https://github.com/c/contribution5.loc/blob/master.zh-cn/docs/a.md","original_content_git_url":"https://github.com/c/contribution5.loc/blob/master-sxs.zh-cn/docs/a.md", "gitcommit":"https://github.com/c/contribution5.loc/blob/f35b220adadfe88d1d4f1b043c8dc55db491c83e/docs/a.md"}
---
# loc page link and content fallback 1
# [repository mapping]
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/page-fallback1#master:
    - files:
        docfx.yml:
        docs/b.md: |
          [link in a](a.md)
  https://docs.com/page-fallback1.zh-cn#master:
    - files:
        docs/a.md: |
          [link in b](b.md)
          [!include[](b.md)]
outputs:
  docs/a.json: |
    { "content":"<p><a href=\"b\">link in b</a></p>\n<p><a href=\"a\">link in a</a></p>\n"}
---
# loc page link and content fallback 2
# [branch mapping]
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/page-fallback2#master:
    - files:
        docfx.yml: |
          localization:
            mapping: Branch
        docs/b.md: |
          [link in a](a.md)
  https://docs.com/page-fallback2.loc#master.zh-cn:
    - files:
        docs/a.md: |
          [link in b](b.md)
          [!include[](b.md)]
outputs:
  docs/a.json: |
    { "content":"<p><a href=\"b\">link in b</a></p>\n<p><a href=\"a\">link in a</a></p>\n"}
---
# loc page link and content fallback 3
# [branch mapping] & bilingual
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/page-fallback3#master:
    - files:
        docfx.yml: |
          localization:
            mapping: Branch
            bilingual: true
        docs/b.md: |
          [link in a](a.md)
  https://docs.com/page-fallback3.loc#master.zh-cn:
    - files:
        docs/a.md:
  https://docs.com/page-fallback3.loc#master-sxs.zh-cn:
    - files:
        docs/a.md: |
          [link in b](b.md)
          [!include[](b.md)]
outputs:
  docs/a.json: |
    { "content":"<p><a href=\"b\">link in b</a></p>\n<p><a href=\"a\">link in a</a></p>\n"}
---
# loc resource fallback 1
# [repository mapping]
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/resource-fallback1#master:
    - files:
        docs/b.png:
        docfx.yml:
  https://docs.com/resource-fallback1.zh-cn#master:
    - files:
        docs/a.md: |
          [link to b](b.png)
outputs:
  docs/a.json: |
    { "content":"<p><a href=\"b.png\">link to b</a></p>"}
---
# loc resource fallback 2
# [branch mapping]
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/resource-fallback2#live:
    - files:
        docs/b.png:
        docfx.yml: |
          localization:
            mapping: Branch
  https://docs.com/resource-fallback2.loc#live.zh-cn:
    - files:
        docs/a.md: |
          [link to b](b.png)
outputs:
  docs/a.json: |
    { "content":"<p><a href=\"b.png\">link to b</a></p>"}
---
# loc resource fallback 3
# [repository mapping] & bilingual
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/resource-fallback3#master:
    - files:
        docs/b.png:
        docfx.yml: |
          localization:
            bilingual: true
  https://docs.com/resource-fallback3.zh-cn#master:
    - files:
        docs/a.md:
  https://docs.com/resource-fallback3.zh-cn#master-sxs:
    - files:
        docs/a.md: |
          [link to b](b.png)
outputs:
  docs/a.json: |
    { "content":"<p><a href=\"b.png\">link to b</a></p>"}
---
# loc token fallback, all loc files are in source repo under different locale folder
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
inputs:
  docfx.yml: |
    localization:
      mapping: Folder
  docs/b.md: |
    [link to a](a.md)
  docs/a.md: a
  localization/zh-cn/docs/a.md: |
    [link to b](b.md)
    [!include[include b](b.md)
outputs:
  docs/a.json: |
    { "content":"<p><a href=\"b\">link to b</a></p>\n<p><a href=\"a\">link to a</a></p>\n"}
---
# loc build with TOC map, loc TOC has higher priority
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/toc1#master:
    - files:
        docs/TOC.md: |
          # [reference a](a.md)
        docs/b/TOC.md: |
          # [reference b](../b.md)
        docfx.yml:
  https://docs.com/toc1.zh-cn#master:
    - files:
        docs/a.md:
        docs/b.md:
        docs/TOC.md: |
          # [reference a](a.md)
          # [reference b](b.md)
outputs:
  docs/a.json: |
    {"toc_rel": "toc.json"}
  docs/b.json: |
    {"toc_rel": "toc.json"}
  docs/toc.json: |
    {"items": [{"name": "reference a", "href": "a"},{"name": "reference b", "href": "b"}]}
---
# loc build with mixed toc map
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/toc2#master:
    - files:
        docs/a/a.md:
        docs/b/TOC.md: |
          # [reference b](b.md)
        docfx.yml:
  https://docs.com/toc2.zh-cn#master:
    - files:
        docs/a/TOC.md: |
          # [reference a](a.md)
        docs/b/b.md:
outputs:
  docs/b/b.json: |
    {"toc_rel": "toc.json"}
  docs/a/toc.json: |
    {"items": [{"name": "reference a", "href": "a"}]}
---
# loc build with mixed toc map, all loc files are in source repo under different locale folder
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
inputs:
  docfx.yml: |
    localization:
      mapping: Folder
  docs/b/TOC.md: |
    # [reference b](b.md)
  docs/a/a.md:
  localization/zh-cn/docs/b/b.md:
  localization/zh-cn/docs/a/TOC.md: |
    # [reference a](a.md)
outputs:
  docs/b/b.json: |
    {"toc_rel": "toc.json"}
  docs/a/toc.json: |
    {"items": [{"name": "reference a", "href": "a"}]}
---
# loc build with xref map, loc file has higher priority
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/xref1#master:
    - files:
        docs/a.md: |
          ---
          uid: c
          ---
        docfx.yml:
  https://docs.com/xref1.zh-cn#master:
    - files:
        docs/a.md: |
          ---
          uid: a
          ---
        docs/b.md: |
          link to @c
outputs:
  .errors.log: |
    ["info","at-uid-not-found","Cannot find uid 'c' using xref '@c'","docs/b.md",1,10]
  docs/a.json:
  docs/b.json:
---
# loc build with xref map, all locale files are in source repo under different locale folder, loc file has higher priority
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
inputs:
  docfx.yml: |
    localization:
      mapping: Folder
  docs/a.md: |
    ---
    uid: c
    ---
  localization/zh-cn/docs/a.md: |
    ---
    uid: a
    ---
  localization/zh-cn/docs/b.md: link to @c
outputs:
  .errors.log: |
    ["info","at-uid-not-found","Cannot find uid 'c' using xref '@c'","docs/b.md",1,10]
  docs/a.json:
  docs/b.json:
---
# loc build with mixed xref map
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/xref2#master:
    - files:
        docs/c.md: |
          ---
          uid: c
          ---
        docfx.yml:
  https://docs.com/xref2.zh-cn#master:
    - files:
        docs/a.md: |
          ---
          uid: a
          ---
        docs/b.md: |
          link to @a
          link to @c
outputs:
  docs/a.json:
  docs/b.json: |
    {"content":"<p>link to <a href=\"a\">a</a>\nlink to <a href=\"c\">c</a></p>\n"}
  xrefmap.json: |
    {"references":[{"uid":"a","href":"https://docs.com/docs/a","name":"a"},{"uid":"c","href":"https://docs.com/docs/c","name":"c"}]}
---
# loc folder should be excluded from source docset during loc docset build
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
inputs:
  docfx.yml: |
    files: '**/*.md'
    localization:
      mapping: Folder
  localization/zh-cn/docs/a.md: |
    [link to a](~/localization/zh-cn/docs/a.md)
    [link to a](~/docs/a.md)
outputs:
  docs/a.json:
  .errors.log: |
    ["warning","link-out-of-scope","File 'localization/zh-cn/docs/a.md' referenced by link '~/localization/zh-cn/docs/a.md' will not be built because it is not included in docfx.yml","docs/a.md",1,1]
---
# loc folder should be excluded from source docset during source docset build
inputs:
  docfx.yml: |
    files: '**/*.md'
    localization:
      mapping: Folder
  localization/zh-cn/docs/a.md:
  docs/b.md:
outputs:
  docs/b.json:
---
# built metadata for loc files 1
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/metadata1#master:
    - files:
        docfx.yml: |
          baseUrl: https://docs.microsoft.com
  https://docs.com/metadata1.zh-cn#master:
    - files:
        docs/a.md:
outputs:
  docs/a.json: |
    {"locale": "zh-cn", "canonical_url": "https://docs.microsoft.com/zh-cn/docs/a", "document_id": "fa697b4e-3e52-77f6-2219-39040f6070da", "document_version_independent_id": "7c88e748-ed5e-a29a-c057-6f89857c3591",}
---
# built metadata for loc files 2
# all loc files are in same repo under different branch
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/metadata2#live:
    - files:
        docfx.yml: |
          baseUrl: https://docs.microsoft.com
          localization:
            mapping: Branch
  https://docs.com/metadata2.loc#live.zh-cn:
    - files:
        docs/a.md:
outputs:
  docs/a.json: |
    {"locale": "zh-cn", "canonical_url": "https://docs.microsoft.com/zh-cn/docs/a", "document_id": "fa697b4e-3e52-77f6-2219-39040f6070da", "document_version_independent_id": "7c88e748-ed5e-a29a-c057-6f89857c3591"}
---
# built metadata for loc files 3
# all loc files are in source repo under different locale folder
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
inputs:
  docfx.yml: |
    baseUrl: https://docs.microsoft.com
    localization:
      mapping: Folder
  localization/zh-cn/docs/a.md:
outputs:
  docs/a.json: |
    {"locale": "zh-cn", "canonical_url": "https://docs.microsoft.com/zh-cn/docs/a", "document_id": "fa697b4e-3e52-77f6-2219-39040f6070da", "document_version_independent_id": "7c88e748-ed5e-a29a-c057-6f89857c3591"}
---
# built metadata for loc files 4
# all loc files are in same repo under different branch
# bilingual
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/metadata4#master:
    - files:
        docfx.yml: |
          baseUrl: https://docs.microsoft.com
          localization:
            mapping: Branch
            bilingual: true
  https://docs.com/metadata4.loc#master.zh-cn:
    - files:
        docs/a.md:
  https://docs.com/metadata4.loc#master-sxs.zh-cn:
    - files:
        docs/a.md:
outputs:
  docs/a.json: |
    {"locale": "zh-cn", "canonical_url": "https://docs.microsoft.com/zh-cn/docs/a", "document_id": "fa697b4e-3e52-77f6-2219-39040f6070da", "document_version_independent_id": "7c88e748-ed5e-a29a-c057-6f89857c3591"}
---
# bilingual build 1
# [repository mapping]
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://github.com/ss/c:
    - files:
        docs/b.md: |
          [link to a](a.md)
        docs/a.md: a
        docfx.yml: |
          localization:
            bilingual: true
  https://github.com/ss/c.zh-cn#master-sxs:
    - files:
        docs/a.md: |
          sxs content
          [link to b](b.md)
          [!include[include b](b.md)
  https://github.com/ss/c.zh-cn#master:
    - files:
        docs/a.md:
outputs:
  docs/a.json: |
    {"content":"<p>sxs content\n<a href=\"b\">link to b</a></p>\n<p><a href=\"a\">link to a</a></p>\n", "enable_loc_sxs": true}
---
# bilingual build 2
# [branch mapping]
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://github.com/ss/a:
     - files:
         docfx.yml: |
           localization:
             mapping: Branch
             bilingual: true
         docs/b.md: |
           [link to a](a.md)
         docs/a.md: abc
  https://github.com/ss/a.loc#master-sxs.zh-cn:
    - files:
        docs/a.md: |
          sxs content
          [link to b](b.md)
          [!include[include b](b.md)
  https://github.com/ss/a.loc#master.zh-cn:
    - files:
        docs/a.md: a
outputs:
  docs/a.json: |
    {"content":"<p>sxs content\n<a href=\"b\">link to b</a></p>\n<p><a href=\"a\">link to a</a></p>\n", "enable_loc_sxs": true}
---
# bilingual page's contributor info is extracted from non-sxs branch
# loc repo:
#   loc-bilingual branch(sxs branch):
#     zh-cn/docs/a.md(modified by A and B)
#   loc-bilingual-sxs branch(non-sxs branch):
#     zh-cn/docs/a.md(modified by B and C)
# for above case, the a.md's contributors are A and B
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://github.com/ss/b:
    - files:
        docfx.yml: |
          localization:
            mapping: Branch
            bilingual: true
          gitHub:
            userCache: github-user.json
            resolveUsers: true
        github-user.json: |
          { "users": [
              {"name": "Alice", "login": "alice", "id": 1, "emails": ["alice@contoso.com"]},
              {"name": "Bob", "login": "bob", "id": 2, "emails": ["bob@contoso.com"]},
              {"name": "Terry", "login": "terry", "id": 3, "emails": ["terry@contoso.com"]},
            ]
          }
  https://github.com/ss/b.loc#master-sxs.zh-cn:
    - files:
        docs/a.md: a
      author: Alice
      email: alice@contoso.com
  https://github.com/ss/b.loc#master.zh-cn:
    - files:
        docs/a.md: ab
      author: Bob
      email: bob@contoso.com
    - files:
        docs/a.md: cd
      author: Terry
      email: terry@contoso.com
outputs:
  docs/a.json: |
    {
      "_op_gitContributorInformation":
      {
        "author":{"display_name":"Terry","id": "3"},
        "contributors":[{"display_name":"Bob","id":"2"}],
      },
      "enable_loc_sxs": true}
---
# bilingual page's `gitcommit` url follows sxs content's commit history
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://github.com/bilingual/a:
    - files:
        docs/a.md: a
        docfx.yml: |
          localization:
            bilingual: true
  https://github.com/bilingual/a.zh-cn#master-sxs:
    - files:
        docs/a.md: |
          loc sxs content
  https://github.com/bilingual/a.zh-cn#master:
    - files:
        docs/a.md: |
          loc content
outputs:
  docs/a.json: |
    {"gitcommit":"https://github.com/bilingual/a.zh-cn/blob/b1990a2c68f76bcf400e766c38480834a40e80fc/docs/a.md"}
---
# conflicted toc files(source and loc)
# 1. should not report warning
# 2. `toc_rel` should be resolved to loc toc
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://github.com/conflictedtoc/a:
    - files:
        docs/a/TOC.md: |
          # [md reference a](a.md)
        docfx.yml:
  https://github.com/conflictedtoc/a.zh-cn:
    - files:
        docs/a/TOC.yml: |
          - href: a.md
            name: yml reference a
        docs/a/a.md:
outputs:
  docs/a/a.json: |
    {"toc_rel": "toc.json"}
  docs/a/toc.json: |
    {"items":[{"name": "yml reference a"}]}
---
# fallback to deleted token/codesnippet
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://github.com/deletedtoken/a:
    - files:
        docfx.yml:
      author: a
    - files:
        docfx.yml:
        docs/tokena.md: |
          [!include[include deleted tokenb](tokenb.md)
          [!code-csharp[Main](program.cs)]
        docs/tokenb.md: b
        docs/program.cs:
      author: b
  https://github.com/deletedtoken/a.zh-cn:
    - files:
        docs/a.md: |
          [!include[include deleted tokena](tokena.md)
outputs:
  docs/a.json: |
    {"content":"<p>b</p>\n<pre><code class=\"lang-csharp\" name=\"Main\"></code></pre>"}
  .dependencymap.json: |
    {"dependencies": {"!docs/tokena.md": null}}
---
# fallback to deleted resource
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://github.com/deletedres/a:
    - files:
        docfx.yml:
      author: a
    - files:
        docfx.yml:
        docs/resource.png:
        docs/b.md:
      author: b
  https://github.com/deletedres/a.zh-cn:
    - files:
        docs/a.md: |
          [link to deleted resource](resource.png)
          [link to deleted markdown doesnt work](b.md)
outputs:
  docs/a.json: |
    {"content":"<p><a href=\"resource.png\">link to deleted resource</a>\n<a href=\"b.md\">link to deleted markdown doesnt work</a></p>\n"}
  .errors.log: |
    ["warning","file-not-found","Cannot find file 'b.md' relative to 'docs/a.md'","docs/a.md",2,1]
  .dependencymap.json: |
    {"dependencies":{"docs/a.md":[{"source":"docs/resource.png","type":"link"}]}}
---
# fallback to deleted toc
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://github.com/deletedtoc/a:
    - files:
        docfx.yml:
      author: a
    - files:
        docfx.yml:
        docs/a/TOC.yml: |
          - href: a.md
            name: reference markdown a
      author: b
  https://github.com/deletedtoc/a.zh-cn:
    - files:
        docs/b/TOC.yml: |
          - href: ../a/TOC.yml
            name: reference toc a
        docs/a/a.md:
outputs:
  docs/a/a.json:
  docs/b/toc.json: |
    {"items":[{"name":"reference toc a","items":[{"name":"reference markdown a","href":"../a/a"}]}]}
---
# fallback to deleted toc only works for localization docset build
commands:
  - build
repos:
  https://github.com/onlyloc/a:
    - files:
        docfx.yml:
        docs/b/TOC.yml: |
          - href: ../a/TOC.yml
            name: reference toc a
        docs/a/a.md:
      author: a
    - files:
        docfx.yml:
        docs/a/TOC.yml: |
          - href: a.md
            name: reference markdown a
      author: b
outputs:
  docs/a/a.json:
  docs/b/toc.json: |
    {"items":[{"name":"reference toc a"}]}
---
# fallback to deleted token/codesnippet/resource only works for loc docset build
commands:
  - build
repos:
  https://github.com/onlyloc/b:
    - files:
        docfx.yml:
        docs/a.md: |
          [!include[include deleted tokena](tokena.md)
          [link to deleted resource](resource.png)
    - files:
        docfx.yml:
        docs/tokena.md: |
          [!include[include deleted tokenb](tokenb.md)
          [!code-csharp[Main](program.cs)]
        docs/tokenb.md: b
        docs/program.cs:
        docs/resource.png:
outputs:
  docs/a.json:
  .errors.log: |
    ["warning","file-not-found","Cannot find file 'resource.png' relative to 'docs/a.md'","docs/a.md",2,1]
    ["warning","include-not-found","Cannot resolve 'tokena.md' relative to 'docs/a.md'.","docs/a.md",1,1]
---
# fallback to inclusion parent toc
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://github.com/inclusiontoc/a:
    - files:
        docfx.yml:
        docs/b/TOC.yml: |
          - href: ../a/TOC.yml
            name: reference toc a
        docs/a/TOC.yml: |
          - href: b.md
            name: reference markdown b
  https://github.com/inclusiontoc/a.zh-cn:
    - files:
        docs/a/TOC.yml: |
          - href: a.md
            name: reference markdown a
        docs/a/a.md:
        docs/a/b.md:
outputs:
  docs/a/a.json:
  docs/a/b.json:
  docs/b/toc.json: |
    {"items":[{"name":"reference toc a","items":[{"name":"reference markdown a","href":"../a/a"}]}]}
---
# loc build gets restored files
# from current docset firestly, then from fallback docset if has
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://github.com/buildhistory/a:
    - files:
        docfx.yml: |
          monikerDefinition: monikers.json
        docs/a.md:
        monikers.json: |
          {}
  https://github.com/buildhistory/a.zh-cn:
    - files:
        docs/a.md:
outputs:
  docs/a.json:
---
# build from loc folder for folder mapping is not supported
commands:
  - build
cwd: localization/zh-cn/
repos:
  https://github.com/buildfromlocfolder/a:
    - files:
        docfx.yml: |
          localization:
            mapping: Folder
        localization/zh-cn/docs/a/a.md:
outputs:
  .errors.log: |
    ["error","config-not-found","Can't find config file 'docfx.yml/docfx.json' at *"]
---
# loc build gets docfx config 1
# from current docset firstly, then from fallback docset
# [repo mapping]
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://github.com/locconfig/a:
    - files:
        docfx.yml: |
          contribution:
            repository: https://github.com/dotnet/docfx
        docs/a.md:
  https://github.com/locconfig/a.zh-cn:
    - files:
        docs/a.md:
        docfx.yml: |
          contribution:
            repository: https://github.com/dotnet/docfx.zh-cn
outputs:
  docs/a.json: |
    { "content_git_url": "*dotnet/docfx.zh-cn/blob/master/*"}
---
# loc build gets docfx config 2
# from current docset firstly, then from fallback docset
# [branch mapping]
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://github.com/locconfig/b:
    - files:
        docfx.yml: |
          contribution:
            repository: https://github.com/dotnet/docfx#live
          localization:
            mapping: Branch
        docs/a.md:
  https://github.com/locconfig/b.loc#master.zh-cn:
    - files:
        docs/a.md:
        docfx.yml: |
          contribution:
            repository: https://github.com/dotnet/docfx.loc#live
          localization:
            mapping: Branch
outputs:
  docs/a.json: |
    { "content_git_url": "*dotnet/docfx.loc/blob/live.zh-cn/*"}
---
# loc build gets docfx config 3
# from current docset firstly, then from fallback docset
# [repo mapping] & bilingual
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://github.com/locconfig/c:
    - files:
        docfx.yml: |
          contribution:
            repository: https://github.com/dotnet/docfx
          localization:
            bilingual: true
        docs/a.md:
  https://github.com/locconfig/c.zh-cn#master-sxs:
    - files:
        docs/a.md:
        docfx.yml: |
          contribution:
            repository: https://github.com/dotnet/docfx.zh-cn
          localization:
            bilingual: true
  https://github.com/locconfig/c.zh-cn:
    - files:
        docs/a.md:
outputs:
  docs/a.json: |
    { "content_git_url": "*dotnet/docfx.zh-cn/blob/master/*"}
---
# loc build gets docfx config 4
# from current docset firstly, then from fallback docset
# [branch mapping] & bilingual
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://github.com/locconfig/d:
    - files:
        docfx.yml: |
          contribution:
            repository: https://github.com/dotnet/docfx#live
          localization:
            mapping: Branch
            bilingual: true
        docs/a.md:
  https://github.com/locconfig/d.loc#master-sxs.zh-cn:
    - files:
        docs/a.md:
        docfx.yml: |
          contribution:
            repository: https://github.com/dotnet/docfx.loc#live
          localization:
            mapping: Branch
            bilingual: true
  https://github.com/locconfig/d.loc#master.zh-cn:
    - files:
        docs/a.md:
outputs:
  docs/a.json: |
    { "content_git_url": "*dotnet/docfx.loc/blob/live.zh-cn/*"}
---
# loc build with different dependency git repository 1
# [repo mapping] & bilingual
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://github.com/locconfig2/c:
    - files:
        docfx.yml: |
          dependencies:
            child1: https://github.com/locconfig2/d#master
          localization:
            bilingual: true
          "locales: [zh-cn]":
            dependencies:
              child1: https://github.com/locconfig2/d#live
        docs/a.md:
  https://github.com/locconfig2/c.zh-cn#master-sxs:
    - files:
        docs/a.md: |
          [!include[include child](~/child1/token.md)
        docfx.yml: |
          dependencies:
            child1: https://github.com/locconfig2/d#live
          localization:
            bilingual: true
  https://github.com/locconfig2/c.zh-cn:
    - files:
        docs/a.md:
  https://github.com/locconfig2/d#live:
    - files:
        token.md: |
          live branch
  https://github.com/locconfig2/d#master:
    - files:
        token.md: |
          master branch
outputs:
  docs/a.json: |
    { "content": "<p>live branch</p>\n" }
---
# loc build with different dependency git repository 2
# [branch mapping] & bilingual
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://github.com/locconfig3/c:
    - files:
        docfx.yml: |
          dependencies:
            child1: https://github.com/locconfig3/f#master
          localization:
            bilingual: true
            mapping: Branch
          "locales: [zh-cn]":
            dependencies:
              child1: https://github.com/locconfig3/f#live
        docs/a.md:
  https://github.com/locconfig3/c.loc#master-sxs.zh-cn:
    - files:
        docs/a.md: |
          [!include[include child](~/child1/token.md)
        docfx.yml: |
          dependencies:
            child1: https://github.com/locconfig3/f#live
          localization:
            bilingual: true
            mapping: Branch
  https://github.com/locconfig3/c.loc#master.zh-cn:
    - files:
        docs/a.md:
  https://github.com/locconfig3/f#live:
    - files:
        token.md: |
          live branch
  https://github.com/locconfig3/f#master:
    - files:
        token.md: |
          master branch
outputs:
  docs/a.json: |
    { "content": "<p>live branch</p>\n" }
---
# Apply &lrm; for right to left languages
commands:
  - restore --locale ar-sa
  - build --locale ar-sa
repos:
  https://docs.com/lrm#master:
    - files:
        docfx.yml:
  https://docs.com/lrm.ar-sa#master:
    - files:
        docs/a.md: |
          Learn c#.
outputs:
  docs/a.json: |
    content: <p>Learn c#&lrm;.</p>
---
# VSTS localized repo with folder mapping
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docascode.visualstudio.com/folder/_git/a:
    - files:
        docfx.yml: |
          localization:
            mapping: Folder
        docs/b.md: |
          [link in a](a.md)
        localization/zh-cn/docs/a.md: |
          [link in b](b.md)
          [!include[](b.md)]
outputs:
  docs/a.json: |
    { "content":"<p><a href=\"b\">link in b</a></p>\n<p><a href=\"a\">link in a</a></p>\n"}
---
# VSTS localized repo with branch mapping
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docascode.visualstudio.com/branch/_git/a#live:
    - files:
        docfx.yml: |
          localization:
            mapping: Branch
        docs/b.md: |
          [link in a](a.md)
  https://docascode.visualstudio.com/branch/_git/a.loc#live.zh-cn:
    - files:
        docs/a.md: |
          [link in b](b.md)
          [!include[](b.md)]
outputs:
  docs/a.json: |
    { "content":"<p><a href=\"b\">link in b</a></p>\n<p><a href=\"a\">link in a</a></p>\n"}
---
# VSTS localized repo with branch mapping & bilingual
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docascode.visualstudio.com/branch/_git/b#live:
    - files:
        docfx.yml: |
          localization:
            mapping: Branch
            bilingual: true
        docs/b.md: |
          [link in a](a.md)
  https://docascode.visualstudio.com/branch/_git/b.loc#live.zh-cn:
    - files:
        docs/a.md: "not used"
  https://docascode.visualstudio.com/branch/_git/b.loc#live-sxs.zh-cn:
    - files:
        docs/a.md: |
          [link in b](b.md)
          [!include[](b.md)]
outputs:
  docs/a.json: |
    { "content":"<p><a href=\"b\">link in b</a></p>\n<p><a href=\"a\">link in a</a></p>\n"}
---
# VSTS localized repo with repo mapping
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docascode.visualstudio.com/repo/_git/a#live:
    - files:
        docfx.yml:
        docs/b.md: |
          [link in a](a.md)
  https://docascode.visualstudio.com/repo/_git/a.zh-cn#live:
    - files:
        docs/a.md: |
          [link in b](b.md)
          [!include[](b.md)]
outputs:
  docs/a.json: |
    { "content":"<p><a href=\"b\">link in b</a></p>\n<p><a href=\"a\">link in a</a></p>\n"}
---
# VSTS localized repo with repo mapping & bilingual
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docascode.visualstudio.com/repo/_git/b#live:
    - files:
        docfx.yml: |
          localization:
            bilingual: true
        docs/b.md: |
          [link in a](a.md)
  https://docascode.visualstudio.com/repo/_git/b.zh-cn#live:
    - files:
        docs/a.md: "not used"
  https://docascode.visualstudio.com/repo/_git/b.zh-cn#live-sxs:
    - files:
        docs/a.md: |
          [link in b](b.md)
          [!include[](b.md)]
outputs:
  docs/a.json: |
    { "content":"<p><a href=\"b\">link in b</a></p>\n<p><a href=\"a\">link in a</a></p>\n"}
---
# fallback to never existing token in multiple files
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://github.com/neverexist/a:
    - files:
        docfx.yml:
      author: a
  https://github.com/neverexist/a.zh-cn:
    - files:
        docs/1.md: |
          [!include[include deleted tokena](tokenx.md)
        docs/2.md: |
          [!include[include deleted tokena](tokenx.md)
        docs/3.md: |
          [!include[include deleted tokena](tokenx.md)
outputs:
  docs/1.json:
  docs/2.json:
  docs/3.json:
  .errors.log:
---
# fallback to corresponding source branch 1
# [repo mapping]
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/branch-fallback1#test:
    - files:
        docfx.yml:
        docs/b.md: |
          test
  https://docs.com/branch-fallback1#master:
    - files:
        docfx.yml:
        docs/b.md: |
          master
  https://docs.com/branch-fallback1.zh-cn#test:
    - files:
        docs/a.md: |
          [!include[](b.md)]
outputs:
  docs/a.json: |
    { "content":"<p>test</p>"}
---
# fallback to corresponding source branch 2
# [repo mapping & bilingual]
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/branch-fallback2#test:
    - files:
        docfx.yml: |
          localization:
            bilingual: true
        docs/b.md: |
          test
  https://docs.com/branch-fallback2#master:
    - files:
        docfx.yml:
        docs/b.md: |
          master
  https://docs.com/branch-fallback2.zh-cn#test:
    - files:
        docs/a.md:
  https://docs.com/branch-fallback2.zh-cn#test-sxs:
    - files:
        docs/a.md: |
          [!include[](b.md)]
outputs:
  docs/a.json: |
    { "content":"<p>test</p>"}
---
# [from loc] fallback to master if corresponding source branch doesn't exists
# [branch mapping]
commands:
  - restore --locale zh-cn
  - build --locale zh-cn
repos:
  https://docs.com/branch-fallback3#master:
    - files:
        docfx.yml: |
          localization:
            mapping: Branch
        docs/b.md: |
          master
  https://docs.com/branch-fallback3.loc#test.zh-cn:
    - files:
        docs/a.md: |
          [!include[](b.md)]
outputs:
  docs/a.json: |
    { "content":"<p>master</p>"}
