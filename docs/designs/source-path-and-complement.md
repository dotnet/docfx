# Source Path

In `.publish.json file`,`source_path` represents the source file's relative path to docset root.

It will be used in PR comments to indicate the path of the files containing errors/warnings/suggestions.


# Design of SourceMap

## Definition

|  Name  |   Concept   |
|-|-|
| _raw source file_   | the files in content repository, e.g. https://github.com/Azure/azure-docs-sdk-dotnet/blob/main/xml/Azure.AI.FormRecognizer/FormRecognizerLanguage.xml | 
| _build source file_ | the files are to be built by DoxFX, which may be the raw source file or the **preprocessed result** files of raw source files | 
| source_path | the property in .publish.json file | 


For most cases, the same source_path corresponds to the same _raw source file_ file (i.e. One-To-One). And the source_path value is the _raw source file_'s physical file path.

For some special cases, it is allowed to config mappings to resolve source_path values, named **SourceMap**  

|  key                          |  Value            |
|-------------------------------|-------------------|
| _build source file_ file path | source_path value |

Due to **SourceMap**, multiple _build source file_  may have the same source_path (i.e. **Many-To-One**). And the source_path value may be NOT equal to the _raw source file_ 's physical file path.

## Usage Examples

For non-standard yml files or markdown files (e.g. MonoDocXml, MAML files), before executing DocFX build, **OpsPreProcessor** will pre-process the raw files.
And multiple standard yml files may be generated for single raw file, i.e. multiple  _build source files_ for single _raw source file_  
And **SourceMap**s will be auto generated by **OpsPreProcessor** to record the mapping relationship between raw files and generated yml files.



# Source Path Complement

**Requirement**:   
In localization pipeline, the generated files (i.e. _build source file_ ) will be localized separately.   

**Challenge**:   
It is not possible to distinguish published files via the source_path value due to **SourceMap** design for DotNet language repos (use MonoDocXML as source format).

**Design**:    
Add complement for source_path, i.e. add new property in .publish.json named `source_path_complement` for those entries containing the same `source_path` values.


```json
  .publish.json: |
    {
          "files": [
        {
            "url": "/api/catlibrary.cat-2",
            "source_path": "xml/CatLibrary/Cat`2.xml",
            "source_path_complement": "some-uid1",            
        },     
        {
            "url": "/api/catlibrary.cat-2.-ctor",            
            "source_path": "xml/CatLibrary/Cat`2.xml",
            "source_path_complement": "some-uid2",           
        }
    }
```

The values of `source_path_complement` are actually the **hash** values of the source file's file path (the generated standard yaml files in MonoDocXML case)

Optional:    
Use config to enable `source_path_complement` so that XliffBuild could get the `source_path_complement` while OPS build will not be affected.


**Note**: For those _build source file_ not in **SourceMap**, the `source_path_complement` is null (i.e. not exist in .publish.json) because they don't need the complement.  
It is consistent and safe to construct a unique id by author code like  
```csharp
var uid = item.SourcePath + item.SourcePathComplement ?? "";
```



<hr/>

# Questions

# Q1: What about Service Page case ? 
Ans: Service pages are generated when build from multiple source files (i.e. Toc files). Virtual file paths are generated for them, refer to code https://github.com/dotnet/docfx/blob/0db0fef6a31cdb5a6cb366abc81922e9df201508/src/docfx/build/toc/ServicePageGenerator.cs#L82 and https://github.com/dotnet/docfx/blob/0db0fef6a31cdb5a6cb366abc81922e9df201508/src/docfx/build/toc/ServicePageGenerator.cs#L167 

